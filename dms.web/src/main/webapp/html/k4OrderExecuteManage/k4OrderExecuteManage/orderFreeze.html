<div class="dms-search">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row ">
				
					<!-- 国产车 -->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">品牌</label>
								<div class="col-xs-8">
									<select id="brandId"
										class="bs-select form-control" name="brandCode"
										data-url="/basedata/material/brand/90081001"
										data-model="manage" data-labelValue="BRAND_ID"
										data-lableDesc="BRAND_NAME">
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车系</label>
								<div class="col-xs-8">
									<select id="seriesId" parent="brandId"
										class="bs-select form-control" name="seriesName"
										data-url="/basedata/material/series/90081001/{[brandId]}"
										data-model="manage" data-labelValue="SERIES_ID"
										data-lableDesc="SERIES_NAME">
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车款</label>
								<div class="col-xs-8">
									<select id="groupId" parent="seriesId"
										class="bs-select form-control" name="groupName"
										data-url="/basedata/material/group/90081001/{[seriesId]}"
										data-model="manage" data-labelValue="GROUP_ID"
										data-lableDesc="GROUP_NAME" >
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">年款</label>
								<div class="col-xs-8">
									<select id="modelId" parent="groupId"
										class="bs-select form-control" name="modelYear"
										data-url="/basedata/material/modelYear/90081001/{[groupId]}"
										data-model="manage" data-labelValue="MODEL_YEAR"
										data-lableDesc="MODEL_YEAR">
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">颜色</label>
								<div class="col-xs-8">
									<select id="colorId" parent="modelId"
										class="bs-select form-control" name="colorName"
										data-url="/basedata/material/color/90081001/{[groupId]}/{[modelId]}"
										data-model="manage" data-labelValue="COLOR_CODE"
										data-lableDesc="COLOR_NAME" >
									</select>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">内饰</label>
								<div class="col-xs-8">
									<select id="trimId" parent="colorId"
										class="bs-select form-control" name="trimName"
										data-url="/basedata/material/trim/90081001/{[groupId]}/{[modelId]}/{[colorId]}"
										data-model="manage" data-labelValue="TRIM_CODE"
										data-lableDesc="TRIM_NAME" >
									</select>
									
								</div>
							</div>
						</div> 
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">订单年</label>
							<div class="col-xs-8">
								<select id="orderYearId" class="bs-select form-control"
									name="workYearName" 
									data-url="/orderTopMaintain/queryYear"
									 data-model="vehicle"
									data-labelValue="WORK_YEAR" data-lableDesc="WORK_YEAR"
									data-alwaysRefresh="true">
								</select>
								
							</div>
						</div>
					</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">订单月</label>
							<div class="col-xs-8">
								<select id="orderMonthId" class="bs-select form-control"
									name="orderMonthName" parent="orderYearId"  data-dictCode="9009">
								</select>
							</div>
						</div>
					</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">订单周</label>
							<div class="col-xs-8">
								<select id="orderWeekId" class="bs-select form-control"
									name="orderWeekName" parent="orderMonthId"
									data-url="/confirmOrderModify/queryWeek/{[orderYearId]}/{[orderMonthId]}"
									 data-model="vehicle"
									data-labelValue="WORK_WEEK" data-lableDesc="WORK_WEEK"
									data-alwaysRefresh="true">
								</select>
							</div>
						</div>
					</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">订单号</label>
							<div class="col-xs-8">
								<input id="orderNoId" name="orderNoName" class="form-control"
								 type="text" />
							</div>
						</div>
					</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">订单类型</label>
								<div class="col-xs-8">
									<select id="orderTypeId" class="bs-select form-control"
										name="orderTypeName"  data-type="oemDict"
										   data-dictCode="9016">
									</select>
								</div>
							</div>
						</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">订单状态</label>
								<div class="col-xs-8">
									<select id="orderTypeId" class="bs-select form-control"
										name="orderTypeName"  data-type="oemDict"
										   data-dictCode="7003">
									</select>
								</div>
							</div>
						</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">付款方式</label>
								<div class="col-xs-8">
									<select id="paymentTypeId" class="bs-select form-control"
										name="paymentTypeName" data-type="oemDict"
										 data-dictCode="9018" >
									</select>
									<input type="hidden" id="orderNos" name="orderNos" >
								</div>
							</div>
						</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">大区</label>
							<div class="col-xs-8">
								<select id="bigOrg"
									class="bs-select form-control" name="bigOrgName"
									data-url="/basedata/orgManage/bigOrg"
									data-model="manage" data-labelValue="BIG_ORG"
									data-lableDesc="BIG_ORG_NAME" multiple data-live-search="fales" data-size="5" data-existsDefault = "false" >
								</select>
								
							</div>
						</div>
					</div>
						
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">小区</label>
								<div class="col-xs-8">
									<select id="smallOrg" parent="bigOrg"
										class="bs-select form-control" name="smallOrgName"
										data-url="/basedata/orgManage/{[bigOrg]}/smallOrg"
										data-model="manage" data-labelValue="SMALL_ORG"
										data-lableDesc="SMALL_ORG_NAME" multiple data-live-search="fales" data-size="5" data-existsDefault = "false" >
									</select>
									
								</div>
							</div>
						</div>	
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">提报日期</label>
							<div class="col-xs-8 ">
								<div class="input-group input-daterange">
									<input type="text" class="form-control" 
										name="beginDate" id="beginDate">
										<span class="input-group-addon">至</span>
									 <input type="text" class="form-control"  
									 	name="endDate"
										id="endDate"> <span class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">确认日期</label>
							<div class="col-xs-8">
								<div class="input-group input-daterange">
									<input type="text" class="form-control" 
										name="arStartDate" id="arStartDate">
										<span class="input-group-addon">至</span>
									 <input type="text" class="form-control"  
									 	name="arEndDate"
										id="arEndDate"> <span class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车辆用途</label>
								<div class="col-xs-8">
									<select id="vehicleUseId" class="bs-select form-control"
										name="vehicleUseName" data-type="oemDict"
										 data-dictCode="2084" >
									</select>
									<input type="hidden" id="orderNos" name="orderNos" >
								</div>
							</div>
						</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3" data-tableSelect="true">
							<div class="form-group">
									<label class="control-label col-xs-4">选择经销商</label>
									<div class="col-xs-8">
										<div class="input-group">
										<input id="dealerCode" readonly
											name="dealerCode" class="form-control" type="text"
											data-fieldName="dealer_code" /> <span
												class="input-group-btn" >
												<button class="btn default btn-sm" type="button"
													data-url="manage/basedata/dealers/searchDealers.html"
													data-toggle="modal" data-width="modal-lg">
													<i class="fa fa-list-alt"></i>
												</button>
												<button class="btn default input-clear" type="button">
													<i class="fa fa-close"></i>
												</button>
											</span>
										</div>
									</div>
								</div>
							</div>	

						
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">是否截停</label>
								<div class="col-xs-8">
									<select id="isFreezeId" class="bs-select form-control"
										name="isFreezeName"  data-type="oemDict"
										   data-dictCode="1004" data-value="10041002" >
									</select>
								</div>
							</div>
						</div>
			</div>
			
			<div class="row" > 
					<div class="center-block" style="width:200px;">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue" data-onclickEvent="true"> <i
								class="fa fa-search" ></i> 查询
							</a> 
							<a href="javascript:;" class="btn blue"><i
								class="fa fa-undo"></i> 重置
							</a>
						</div>
					</div>
				</div>
			
		</div>
	
	
	<div class="panel panel-default table-panel">
		<div class="panel-heading">
			<div class="pannel-name" >订单截停明细</div>
		</div>
		<div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive"
				id="order_freeze_table"></table>
		</div>
	</div>
	
	
	<div class="panel panel-default">
			<div class="panel-body">
				<div class="row ">
					<input type="hidden" id="orderNos" name="orderNos" >
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">截停原因</label>
							<div class="col-xs-8">
								<select id="freezeReasonId" 
									class="bs-select form-control" name="freezeReasonName"
									data-url="/orderFreeze/findFreezeReason"
									data-model="vehicle" data-labelValue="FREEZE_CODE"
									data-lableDesc="FREEZE_REASON"   >
								</select>
							</div>
						</div>
					</div>
					
			</div>
			
				<div class="row">
					<div class="form-actions">
						<a class="btn blue"  id="buttonYes"
						data-url="/orderFreeze/doOrderFreeze/1"
						 data-model="vehicle" data-toggle="confirmation"
						 data-callBack="true"  data-beforeRequest="true"
						 data-errorCallBack="true" data-method="PUT">
							<i class="fa fa-save"></i>截停
						</a>
						<a class="btn blue"  style="display:none ;" id="buttonNo"
						data-url="/orderFreeze/doOrderFreeze/2"
						 data-model="vehicle" data-toggle="confirmation"
						 data-callBack="true"  data-beforeRequest="true"
						 data-errorCallBack="true" data-method="PUT">
							<i class="fa fa-save"></i>解除截停
						</a>
					</div>
				</div>
				
			</div>
		</div>
		
		<div class="panel panel-default table-panel" id="orderfreezeInfoPanpel">
			<div class="panel-heading">
				<div class="pannel-name">订单截停明细</div>
			</div>
			<div class="panel-body">
				<table
					class="table table-striped table-bordered table-hover table-responsive"
					id="order_freeze_finish_table"></table>
			</div>
		</div>
	</form>
</div>

	
<script type="text/javascript">

    $(document).one("onload.dms",function(event,container){
    	new Datatable().initPagination({
    		src : "order_freeze_table",
    		container:container,
    		   url : dmsCommon.getDmsPath()["vehicle"] + "/orderFreeze/orderFreezeQuery",
    		   checkboxHeader:true,
    		   selectItemName:"orderNos",
    			columns : [ 
    			    {checkbox:true,sortable : false},
    			    {field : "ORDER_NO",title : "订单号"},
                    {field : "ORDER_YEAR_MONTH",title : "订单年月"},
                    {field : "ORDER_WEEK",title : "执行周"},
                    {field : "ORDER_TYPE",title : "订单类型"},
                    {field : "EC_ORDER_NO",title : "官网订单号"},
                    {field : "ORDER_STATUS",title : "订单状态"},
                    {field : "BIG_AREA",title : "大区"},
                    {field : "SMALL_AREA",title : "小区"},
                    {field : "DEALER_CODE",title : "经销商代码"},
                    {field : "DEALER_SHORTNAME",title : "经销商名称"},
                    {field : "BRAND_NAME",title : "品牌"},
                    {field : "SERIES_NAME",title : "车系"},//
                    {field : "MODEL_NAME",title : "CPOS"},//
                    {field : "MODEL_YEAR",title : "年款"},
                    {field : "GROUP_NAME",title : "车款"},
                    {field : "COLOR_NAME",title : "颜色"},
                    {field : "TRIM_NAME",title : "内饰"},
                    {field : "VEHICLE_USE",title : "车辆用途"},
                    {field : "PAYMENT_TYPE",title : "付款方式"},
                    {field : "IS_FREEZE",title : "是否截停",codeFormat : {type:"oemDict",codeType:"1004"}},
                    {field : "FREEZE_REASON",title : "截停原因"},
                    {field : "FREEZE_DATE",title : "截停日期"},
                    {field : "UNFREEZE_DATE",title : "解除截停日期"},
                    {field : "ORDER_DATE",title : "提报日期"},
                    {field : "DEAL_ORDER_AFFIRM_DATE",title : "确认日期"}
    			],
    		});
    	
    	//创建表格
		new Datatable().initLocale({
			src : "order_freeze_finish_table",
			container:container,
			columns : [ 
			            {field : "orderNo",title : "订单号"},
			            {field : "msg",title : "截停/解除截停详情 "}
			         ]
		});
		$("#orderfreezeInfoPanpel",container).hide();
		
		//绑定onchange 事件
		$("[name='isFreezeName']",container).bindChange(function(obj){
			var isFreeze  = $("#isFreezeId").val();
			var flag = "10041001";
			if(isFreeze == flag){
				document.getElementById("buttonYes").style.display = "none";
				document.getElementById("freezeReasonId").disabled="disabled";
				document.getElementById("buttonNo").style.display = "";
			}else{
				document.getElementById("buttonYes").style.display = "";
				document.getElementById("freezeReasonId").disabled="";
				document.getElementById("buttonNo").style.display = "none";
			}
			//刷新表格
			$("#order_freeze_table",getElementContext()).dmsTable().refreshTableWithForm();
		});
    	
    	//绑定查询按钮回调
    	$("a[data-onclickEvent='true']",container).on("dms.click",function(event){
    	});
    	
    	//执行前的函数
		$("a[data-beforeRequest='true']",container).on("beforeRequest.dms",function(event,returnResult){
				var flag  = true ;
				//获取选中下拉框
    			var orderNos = "";
    			var selectRow = $("#order_freeze_table",container).dmsTable().getSelections();
    			if(selectRow != null){
    				for(var i = 0 ;i<selectRow.length;i++){
    					if(orderNos=="" ){ //第一次循环为空值
    						orderNos = selectRow[i]["ORDER_NO"];
    					}else{
    						orderNos = orderNos+","+selectRow[i]["ORDER_NO"];
    					}
    				}
    			 	$("#orderNos",getElementContext()).setDmsValue(orderNos);
    			 	var freezeReson = $("#freezeReasonId").val();
    				if(freezeReson==""){
    					dmsCommon.tip({status:"warning",msg:"请选择截停原因！"});
    					flag  = false ;
    	//				return;
    				}
    				var text = "确定选择的订单吗?";
    				if (confirm(text)) {
    					document.getElementById("buttonYes").disabled="none";
    					document.getElementById("buttonNo").disabled="none";
    				 }
    			}else{
    			//	dmsCommon.tip({status:"warning",msg:"请选择要截停的订单！"}); //总共的状态类型：info、success、error、warning
    		//		returnResult.status = false; 
    				flag  = false ;
    		//		return ;
    			}
    			var isFreeze  = $("#isFreezeId").val();
    			var fl = "10041001";
    			if(fl==isFreeze){
    				var flag  = true ;
    			}
    			returnResult.status = flag ;
		});
    	
		//截停回调函数
		$("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
			$("#orderfreezeInfoPanpel",container).show();
			//刷新表格
			$("#order_freeze_table",getElementContext()).dmsTable().refreshTableWithForm();
			$("#order_freeze_finish_table",getElementContext()).dmsTable().refreshLocalData(response);
		}); 
    	
    	
    });

</script>

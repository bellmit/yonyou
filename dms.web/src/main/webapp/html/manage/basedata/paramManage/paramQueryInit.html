<div class="dms-search">
 <form class="form-horizontal form-row-seperated">
   	<div class="panel panel-default">
   	  <div class="panel-heading">
	   </div>
   	   <div class="panel-body">
   	   		<div class="row">
			      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 ">
			         <div class="form-group">
			             <label class="control-label col-xs-4">业务参数类型</label>
			             <div class="col-xs-8">
							<select id="paramType" data-fieldName="paramType"
								class="bs-select form-control" name="paramType"
								data-url="/basedata/params/getParamType" data-value="1"
								data-model="manage" data-labelValue="code"
								data-lableDesc="data" data-existsDefault="false">
							</select>							
						</div>
			         </div>
			      </div>			      	   			
   	   		</div>
			<div class="row ">
			    <div class="col-xs-12 " >
			      <div class="query-btn">
	                  <a href="javascript:;" class="btn blue" data-onclickEvent="true" id="query"> <i class="fa fa-select"></i>查询</a>
	                  <!-- <a href="javascript:;" class="btn blue"><i class="fa fa-undo"></i>重置</a> -->
			      </div>
			    </div>
			</div>
   	   </div>
   	</div>
   	<div class="panel panel-default table-panel">
	   <div class="panel-body">
		   	<div id = "panel1">
				<table class="table table-striped table-bordered table-hover table-responsive"
					id="table1"></table>
			</div>
			<div id = "panel2">
			<div class="portlet light form-fit bordered">
				<div class="rows">
					<div class="col-xs-6" style="text-align:center;">
						<label  class="control-label">［待选择经销商］</label>
					</div>
					<div class="col-xs-6" style="text-align:center;">
						<label  class="control-label">［已选择经销商］</label>
					</div>
				</div>
				<div class="rows">
					<div class="col-xs-4">
						<div class="form-group">
							<div class="col-xs-8">
								<input type="text" class="form-control" id="codeLeft" name="codeLeft">
							</div>
							<div class="col-xs-4">
								<a data-onclickEvent='true' href="javascript:;" class="btn blue codeQuery" data-value="codeleft"> <i class="fa fa-search"></i> 查询</a>
							</div>
						</div>
					</div>
					<div class="col-xs-4"></div>
					<div class="col-xs-4" >
						<div class="form-group">
							<div class="col-xs-8">
								<input type="text" class="form-control" id="codeRight" name="codeRight">
							</div>
							<div class="col-xs-4">
								<a data-onclickEvent='true' href="javascript:;" class="btn blue codeQuery" data-value="coderight"> <i class="fa fa-search"></i> 查询</a>
							</div>
						</div>
					</div>			
				</div>
               <div class="portlet-body form">
				<div class="form-body">
	                <div class="form-group">
	                    <div class="col-xs-12">
							<table class="table table-bordered dchannel-table">
							     <tbody>
							      <tr class="item-default">
							          <td align="right" style="width: 50%;">
							              <select id="sel_all_area" name="sel_all_area" multiple="multiple" size="10" style="width:100%;" data-url="/basedata/params/getDealerLeft"
											data-model="manage" data-labelValue="code" data-lableDesc="data" data-existsDefault="false">
							              </select>
							              <input type="hidden" id="dealerLeft" name="dealerLeft">
							         </td>
							         <td style="width: 50px;" valign="middle">
							            <button type="button" class="btn btn-default btn-small" id="btn_select_all_area"><span class="glyphicon glyphicon-forward"></span></button>
							            <button type="button" class="btn btn-default btn-small" id="btn_choose_selected_area"><span class="glyphicon glyphicon-chevron-right"></span></button>
							            <button type="button" class="btn btn-default btn-small" id="btn_remove_selected_area"><span class="glyphicon glyphicon-chevron-left"></span></button>
							           <button type="button" class="btn btn-default btn-small" id="btn_remove_all_area"><span class="glyphicon glyphicon-backward"></span></button>
							        </td>
							        <td style="width: 50%;">
							              <select id="sel_selected_areas" name="sel_selected_areas" multiple="multiple" size="10" style="width:100%;" data-url="/basedata/params/getDealerRight"
											data-model="manage" data-labelValue="code" data-lableDesc="data" data-existsDefault="false">
							              </select>
							              <input type="hidden" id="dealerRight" name="dealerRight">
							     	 </td>
							    </tr>
							   </tbody>
						    </table>
	                    </div>
			            <div class="rows">
							<div class="col-xs-6">
								<div class="form-group">
									<label class="control-label col-xs-4">预测提前月数：</label>
									<div class="col-xs-4" >
										<input class="form-control numberOnly" type="text" id="forceMonth" name="forceMonth" data-fieldName="forceMonth" maxlength="2" min="0" max="12"/>
									</div>
									<label class="control-label col-xs-1">月</label>
								</div>
							</div>
							<div class="col-xs-6">
								<div class="form-group">
									<label class="control-label col-xs-2">预测日期：</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="startDay" name="startDay" data-fieldName="startDay" maxlength="2" min="1" max="31"/>
									</div>
									<label class="control-label col-xs-1">号</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="startHour" name="startHour" data-fieldName="startHour" maxlength="2" min="0" max="24"/>
									</div>
									<label class="control-label col-xs-1">时~</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="endDay" name="endDay" data-fieldName="endDay" maxlength="2" min="1" max="31"/>
									</div>
									<label class="control-label col-xs-1">号</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="endHour" name="endHour" data-fieldName="endHour" maxlength="2" min="0" max="24"/>
									</div>
									<label class="control-label col-xs-1">时</label>
								</div>
							</div>
							
						</div>
	                </div>
	              </div>
	             </div>
				<div class="row" style="text-align:center;">
					<a  data-errorCallBack="true" data-onclickEvent="true" id="btn1" data-info="saveBefore"  data-callBack="true"   class="btn blue" data-toggle="confirmation" data-model="manage" data-method="GET" ><i class="fa fa-save"></i> 保存
					</a>
					<a id="dateSave" data-info="saveBeforeUrl" data-saveBeforeEvent="true" data-model="manage" data-beforeRequest='true'
						class="btn blue ajaxrest hidden" data-callBack="true"><i class="fa fa-save"></i>保存</a>
				</div>
	            </div>
			</div>
			<!--<div id = "panel3">
			<div class="portlet light form-fit bordered">
			   <div class="rows">
					<div class="col-xs-6" style="text-align:center;">
						<label  class="control-label">［待选择大区］</label>
					</div>
					<div class="col-xs-6" style="text-align:center;">
						<label  class="control-label">［已选择大区］</label>
					</div>
			   </div>
			   <div class="rows">
					<div class="col-xs-4">
						<div class="form-group">
							<div class="col-xs-8">
								<input type="text" class="form-control" id="orgleft" name="orgleft">
							</div>
							<div class="col-xs-4">
								<a data-onclickEvent='true' href="javascript:;" class="btn blue codeQuery" data-value="orgleft"> <i class="fa fa-search"></i> 查询</a>
							</div>
						</div>
					</div>
					<div class="col-xs-4"></div>
					<div class="col-xs-4" >
						<div class="form-group">
							<div class="col-xs-8">
								<input type="text" class="form-control" id="orgright" name="orgright">
							</div>
							<div class="col-xs-4">
								<a data-onclickEvent='true' href="javascript:;" class="btn blue codeQuery" data-value="orgright"> <i class="fa fa-search"></i> 查询</a>
							</div>
						</div>
					</div>			
				</div>
               <div class="portlet-body form">
				<div class="form-body">
	                <div class="form-group">
	                    <div class="col-xs-12">
							<table class="table table-bordered dchannel-table">
							     <tbody>
							      <tr class="item-default">
							          <td align="right" style="width: 50%;">
							              <select id="orgLeft" name="orgLeft" multiple="multiple" size="10" style="width:100%;" data-url="/basedata/params/getOrgLeft"
											data-model="manage" data-labelValue="code" data-lableDesc="data" data-existsDefault="false">
							              </select>
							         </td>
							         <td style="width: 50px;" valign="middle">
							            <button type="button" class="btn btn-default btn-small" id="btn_select_all_org"><span class="glyphicon glyphicon-forward"></span></button>
							            <button type="button" class="btn btn-default btn-small" id="btn_choose_selected_org"><span class="glyphicon glyphicon-chevron-right"></span></button>
							            <button type="button" class="btn btn-default btn-small" id="btn_remove_selected_org"><span class="glyphicon glyphicon-chevron-left"></span></button>
							           <button type="button" class="btn btn-default btn-small" id="btn_remove_all_org"><span class="glyphicon glyphicon-backward"></span></button>
							        </td>
							        <td style="width: 50%;">
							              <select id="orgRight" name="orgRight" multiple="multiple" size="10" style="width:100%;" data-url="/basedata/params/getOrgRight"
											data-model="manage" data-labelValue="code" data-lableDesc="data" data-existsDefault="false">
							              </select>
							     	 </td>
							    </tr>
							   </tbody>
						    </table>
	                    </div>
			            <div class="rows">
							<div class="col-xs-6">
								<div class="form-group">
									<label class="control-label col-xs-4">配额提前分配月数：</label>
									<div class="col-xs-4" >
										<input class="form-control numberOnly" type="text" id="forceMonth1" name="forceMonth1" data-fieldName="forceMonth1" maxlength="2" min="0" max="12"/>
									</div>
									<label class="control-label col-xs-1">月</label>
								</div>
							</div>
							<div class="col-xs-6">
								<div class="form-group">
									<label class="control-label col-xs-2">配额分配日期：</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="startDay1" name="startDay1" data-fieldName="startDay1" maxlength="2" min="1" max="31"/>
									</div>
									<label class="control-label col-xs-1">号</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="startHour1" name="startHour1" data-fieldName="startHour1" maxlength="2" min="0" max="24"/>
									</div>
									<label class="control-label col-xs-1">时~</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="endDay1" name="endDay1" data-fieldName="endDay1" maxlength="2" min="1" max="31"/>
									</div>
									<label class="control-label col-xs-1">号</label>
									<div class="col-xs-1" >
										<input class="form-control numberOnly" type="text" id="endHour1" name="endHour1" data-fieldName="endHour1" maxlength="2" min="0" max="24"/>
									</div>
									<label class="control-label col-xs-1">时</label>
								</div>
							</div>
							
						</div>
	                </div>
					<div class="row" style="text-align:center;">
						<a  data-errorCallBack="true" data-onclickEvent="true" id="btn2" data-info="saveBefore"  data-callBack="true"   class="btn blue" data-toggle="confirmation" data-model="manage" data-method="GET" ><i class="fa fa-save"></i> 保存
						</a>
						<a id="btn2Save" data-onclickEvent="true" data-info="saveBeforeUrl" data-saveBeforeEvent="true" data-model="manage" data-beforeRequest='true'
							class="btn blue ajaxrest hidden" data-callBack="true"><i class="fa fa-save"></i>保存</a>
					</div>
	              </div>
	             </div>
	            </div>
			</div>
			<div id = "panel4">
				<table class="table table-striped table-bordered table-hover table-responsive"
					id="table4"></table>
			</div>
			<div id = "panel5">
				<div class="row">
					<div class="col-xs-4">
						<div class="form-group">
							<label class="control-label col-xs-4">订单价格比例：</label>
							<div class="col-xs-8" >
								<input class="form-control numberOnly" type="text" id="orderRate" name="orderRate" data-fieldName="MACHT_UPPER" maxlength="3" min="0" max="100"/>
							</div>
						</div>
					</div>
				</div>
				<div class="row" style="text-align:center;">
					<a data-url="/basedata/params/saveOrderRate" data-model="manage" data-method="GET"
						class="btn blue" data-toggle="confirmation" data-callBack="true"><i class="fa fa-save"></i>保存</a>
				</div>
			</div> -->
	   </div>
	</div>
	
 </form>
</div>
<script type="text/javascript">
$(document).one("onload.dms",function(event,container){
	
	new Datatable().initPagination({
		src : "table1",
		container:container,
	    url : dmsCommon.getDmsPath()["manage"] + "/basedata/params/search",
	    data:{paramType:$("#paramType").val()},
	    rowID:"SERIES_ID",
		columns : [ 
					{field : "SERIES_ID",title : "操作",operateFormat : [
	       		         {type:"edit",url:"manage/basedata/paramManage/forecastProportionEdit.html",openWidth:"modal-lg"}
	       		         ]
                    },
		            {field : "BRAND_NAME",title : "品牌"},
		            {field : "SERIES_CODE",title : "车系代码"},
		            {field : "SERIES_NAME",title : "车系名称"},
		            {field : "MACHT_LOWER",title : "匹配比例下限"},
		            {field : "MACHT_UPPER",title : "匹配比例上限"},
		            {field : "REMARK",title : "备注"},
		            {field : "UPDATE_DATE",title : "更新日期"}
		]
	});
	
	new Datatable().initPagination({
		src : "table4",
		container:container,
	    url : dmsCommon.getDmsPath()["manage"] + "/basedata/params/search",
	    data:{paramType:$("#paramType").val()},
	    rowID:"MODEL_ID",
		columns : [ 
					{field : "MODEL_ID",title : "操作",operateFormat : [
	       		         {type:"edit",url:"manage/basedata/paramManage/conversionRateEdit.html",openWidth:"modal-lg"}
	       		         ]
                    },
		            {field : "BRAND_NAME",title : "品牌"},
		            {field : "SERIES_CODE",title : "车系代码"},
		            {field : "SERIES_NAME",title : "车系名称"},
		            {field : "MODEL_CODE",title : "CPOS"},
		            {field : "MODEL_NAME",title : "CPOS描述"},
		            {field : "TRANS_LOWER_RATE",title : "转换率下限"},
		            {field : "TRANS_UPPER_RATE",title : "转换率上限"},
		            {field : "REMARK",title : "备注"},
		            {field : "UPDATE_DATE",title : "更新日期"}
		]
	});
	
	for(var i = 1; i <= 5; i++){
		var panel = $("#panel"+i,container);
		panel.hide();
	}  
	
	//事件点击
	$("a#query[data-onclickEvent='true']", container).on("dms.click",function(event) {
		var type = $("#paramType").val();
		for(var i = 1; i <= 5; i++){
			var panel = $("#panel"+i,container);
			if(type == i){
				panel.show();
			}else{
				panel.hide();
			}
			if(i == 1){
				//刷新表格1
				$("#table1",container).dmsTable().refreshTableWithForm();
			}
		}
	});
	
	//panel5  panel2数据回显 
	dmsCommon.ajaxRestRequest({
		url:dmsCommon.getDmsPath()["manage"] + "/basedata/params/getOrderRate",
		type:"GET",
		async:false,
		dataType:"json",
		sucessCallBack : function(data) {
			$("#orderRate",container).val(data.orderRate);
			$("#forceMonth",container).val(data.forceMonth);
			$("#startDay",container).val(data.startDay);
			$("#startHour",container).val(data.startHour);
			$("#endDay",container).val(data.endDay);
			$("#endHour",container).val(data.endHour);
			$("#forceMonth1",container).val(data.forceMonth1);
			$("#startDay1",container).val(data.startDay1);
			$("#startHour1",container).val(data.startHour1);
			$("#endDay1",container).val(data.endDay1);
			$("#endHour1",container).val(data.endHour1);
		}
	});
	
	
	$("#saveForPanel5",container).bind("click",function(){
		var data = $("#orderRate",container).val();
		if(data == '' || data > 100){
			dmsCommon.tip({status:"warning",msg:"请输入0到100的数字！"});
		}else{
			dmsCommon.ajaxRestRequest({
    			url:dmsCommon.getDmsPath()["manage"] + "/basedata/params/saveOrderRate",
    			type:"GET",
    			async:false,
    			dataType:"json",
    			data:{orderRate : data},
    			sucessCallBack : function(data) {
    				if(data.code){
    					dmsCommon.tip({status:"success",msg:data.msg});
    				}else{
    					dmsCommon.tip({status:"warning",msg:data.msg});
    				}
    			}
    		});
		}
	});
	
	//输入框只能输入数字 
	$("input.numberOnly",container).bind("keyup",function(){
		var obj = $(this)[0];
		obj.value=obj.value.replace(/[^\d]/g,'');
	}); 
	
	//经销商左右选择框
	var j_all_area = $("#sel_all_area"), j_selected_areas = $("#sel_selected_areas");
	      $("#btn_select_all_area").click(function(){
	         j_all_area.find("option").each(function(){
	             $(this).appendTo(j_selected_areas);
	             $(this).prop("selected",false);
	         });
	         return false;
	     });
	     $("#btn_choose_selected_area").click(function(){
         
	       j_all_area.find("option:selected").each(function(){
	            $(this).appendTo(j_selected_areas);
	            $(this).prop("selected",false);
	        });
	        return false;
	    });
	    $("#btn_remove_selected_area").click(function(){
	         j_selected_areas.find("option:selected").each(function(){
	             $(this).appendTo(j_all_area);
	             $(this).prop("selected",false);
	         });
	         return false;
	     });
	   $("#btn_remove_all_area").click(function(){
	         j_selected_areas.find("option").each(function(){
	             $(this).appendTo(j_all_area);
	             $(this).prop("selected",false);
	         });
	         j_selected_areas.find("option").each(function(){
	             $(this).appendTo(j_all_area);
	             $(this).prop("selected",false);
	         });
	         return false;
	     });
	     j_all_area.find("option").on("dblclick", function(){
	         if ($(this).closest("select").is(j_all_area)) {
	             $("#btn_choose_selected_area").click();
	         }
	         else {
	             $("#btn_remove_selected_area").click();
	         }
	         
	         return false;
	     });
	     j_selected_areas.find("option").on("dblclick", function(){
	         if ($(this).closest("select").is(j_all_area)) {
	             $("#btn_choose_selected_area").click();
	         }
	         else {
	             $("#btn_remove_selected_area").click();
	         }
	         
	         return false;
	     });
	     
	     
	     $("#dateSave").bind("click",function(){
			    var right = "";
			    $("#sel_selected_areas option").each(function(i){
			    	right = right + $(this).val() + ","; 
			    });
			    var forceMonth = $("#forceMonth").val();
			    var startDay = $("#startDay").val();
			    var startHour = $("#startHour").val();
			    var endDay = $("#endDay").val();
			    var endHour = $("#endHour").val();
			    var date = forceMonth + "," + startDay + "," + startHour + "," + endDay + "," + endHour;
			    right = right.substring(0,right.length-1);
			    right = right == "" ? "-1":right;
				dmsCommon.ajaxRestRequest({
					url : dmsCommon.getDmsPath()["manage"] + "/basedata/params/saveDealerAndDate/"+right+"/"+date,
					type : 'POST',
					data : {dealerRight : right},
					sucessCallBack : function(data) {
						dmsCommon.tip({status:"success",msg:"保存成功"});
					}
				});
	     });
	     
	     $("a#btn1[data-onclickEvent='true']", container).on("dms.onConfirm",function(event,returnResult){
	    	 $("#dateSave").click();
	     });
	     
	     
	 	//大小区左右选择框
	 	var orgLeft = $("#orgLeft"), orgRight = $("#orgRight");
	 	      $("#btn_select_all_org").click(function(){
	 	         orgLeft.find("option").each(function(){
	 	             $(this).appendTo(orgRight);
	 	            $(this).prop("selected",false);
	 	         });
	 	         return false;
	 	     });
	 	     $("#btn_choose_selected_org").click(function(){
	          
	 	       orgLeft.find("option:selected").each(function(){
	 	            $(this).appendTo(orgRight);
	 	           $(this).prop("selected",false);
	 	        });
	 	        return false;
	 	    });
	 	    $("#btn_remove_selected_org").click(function(){
	 	         orgRight.find("option:selected").each(function(){
	 	             $(this).appendTo(orgLeft);
	 	            $(this).prop("selected",false);
	 	         });
	 	         return false;
	 	     });
	 	   $("#btn_remove_all_org").click(function(){
	 	         orgRight.find("option").each(function(){
	 	             $(this).appendTo(orgLeft);
	 	            $(this).prop("selected",false);
	 	         });
	 	         orgRight.find("option").each(function(){
	 	             $(this).appendTo(orgLeft);
	 	            $(this).prop("selected",false);
	 	         });
	 	         return false;
	 	     });
	 	     orgLeft.find("option").on("dblclick", function(){
	 	         if ($(this).closest("select").is(orgLeft)) {
	 	             $("#btn_choose_selected_org").click();
	 	         }
	 	         else {
	 	             $("#btn_remove_selected_org").click();
	 	         }
	 	         
	 	         return false;
	 	     });
	 	     orgRight.find("option").on("dblclick", function(){
	 	         if ($(this).closest("select").is(orgLeft)) {
	 	             $("#btn_choose_selected_org").click();
	 	         }
	 	         else {
	 	             $("#btn_remove_selected_org").click();
	 	         }
	 	         
	 	         return false;
	 	     });
	 	     
		     $("#btn2Save").bind("click",function(){
				    var right = "";
				    $("#orgRight option").each(function(i){
				    	right = right + $(this).val() + ","; 
				    });
				    var forceMonth = $("#forceMonth1").val();
				    var startDay = $("#startDay1").val();
				    var startHour = $("#startHour1").val();
				    var endDay = $("#endDay1").val();
				    var endHour = $("#endHour1").val();
				    var date = forceMonth + "," + startDay + "," + startHour + "," + endDay + "," + endHour;
				    right = right.substring(0,right.length-1);
				    right = right == "" ? "-1":right;
					dmsCommon.ajaxRestRequest({
						url : dmsCommon.getDmsPath()["manage"] + "/basedata/params/saveOrgAndDate/"+right+"/"+date,
						type : 'POST',
						data : {dealerRight : right},
						sucessCallBack : function(data) {
							dmsCommon.tip({status:"success",msg:"保存成功"});
						}
					});
		     });
		     
		     $("a#btn2[data-onclickEvent='true']", container).on("dms.onConfirm",function(event,returnResult){
		    	 $("#btn2Save").click();
		     });
		     
		     //选择框查询 
		     $("a.codeQuery[data-onclickEvent='true']",container).on("dms.click",function(event,response){
		    	 	var flag = $(this).attr("data-value");
		    	 	var option,data;
		    	 	if(flag == "codeleft"){
		    	 		data = $("#codeLeft").val();
		    	 		option = $("#sel_all_area option");
		    	 	}else if(flag == "coderight"){
		    	 		data = $("#codeRight").val();
		    	 		option = $("#sel_selected_areas option");
		    	 	}else if(flag == "orgleft"){
		    	 		data = $("#orgleft").val();
		    	 		option = $("#orgLeft option");
		    	 	}else if(flag == "orgleft"){
		    	 		data = $("#codeRight").val();
		    	 		option = $("#orgRight option");
		    	 	}
				    option.each(function(i){
				    	$(this).prop("selected",false);
				    	if($(this).html().includes(data)){
				    		$(this).prop("selected",true);
				    	}
				    });
		     });
	
});
</script>
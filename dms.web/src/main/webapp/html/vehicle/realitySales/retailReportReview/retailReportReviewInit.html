<div class="dms-search">
	<form class="form-horizontal" >
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row ">
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">品牌</label>
							<div class="col-xs-8">
								<select id="brandId"
									class="bs-select form-control" name="brandCode"
									data-url="/basedata/material/brand/2"
									data-model="manage" data-labelValue="BRAND_ID"
									data-lableDesc="BRAND_NAME">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车系</label>
							<div class="col-xs-8">
								<select id="seriesId" parent="brandId"
									class="bs-select form-control" name="seriesName"
									data-url="/basedata/material/series/2/{[brandId]}"
									data-model="manage" data-labelValue="SERIES_ID"
									data-lableDesc="SERIES_NAME">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车款</label>
							<div class="col-xs-8">
								<select id="groupId" parent="seriesId"
									class="bs-select form-control" name="groupName"
									data-url="/basedata/material/group/2/{[seriesId]}"
									data-model="manage" data-labelValue="GROUP_ID"
									data-lableDesc="GROUP_NAME" >
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">年款</label>
							<div class="col-xs-8">
								<select id="modelId" parent="groupId"
									class="bs-select form-control" name="modelYear"
									data-url="/basedata/material/modelYear/2/{[groupId]}"
									data-model="manage" data-labelValue="MODEL_YEAR"
									data-lableDesc="MODEL_YEAR">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">颜色</label>
							<div class="col-xs-8">
								<select id="colorId" parent="modelId"
									class="bs-select form-control" name="colorName"
									data-url="/basedata/material/color/2/{[groupId]}/{[modelId]}"
									data-model="manage" data-labelValue="COLOR_CODE"
									data-lableDesc="COLOR_NAME" >
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">内饰</label>
							<div class="col-xs-8">
								<select id="trimId" parent="colorId"
									class="bs-select form-control" name="trimName"
									data-url="/basedata/material/trim/2/{[groupId]}/{[modelId]}/{[colorId]}"
									data-model="manage" data-labelValue="TRIM_CODE"
									data-lableDesc="TRIM_NAME" >
								</select>
							</div>
						</div>
					</div>	
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">开票状态</label>
							<div class="col-xs-8">
								<select id="reportStatus" name="reportStatus" class="bs-select form-control" data-type="oemDict" data-dictCode="2098" >
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3" data-tableSelect="true">
						<div class="form-group">
							<label class="control-label col-xs-4">选择经销商</label>
							<div class="col-xs-8">
								<div class="input-group">
								<input id="dealerCode" readonly
									name="dealerCode" class="form-control" type="text"
									data-fieldName="dealer_code" /> <span
										class="input-group-btn" >
										<button class="btn default btn-sm" type="button"
											data-url="manage/basedata/dealers/searchDealers.html"
											data-toggle="modal" data-width="modal-lg">
											<i class="fa fa-list-alt"></i>
										</button>
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">零售上报类型</label>
							<div class="col-xs-8">
								<select id="reportType" data-excludeItems="20851003" name="reportType" class="bs-select form-control" data-type="oemDict" data-dictCode="2085" >
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">零售上报日期</label>
							<div class="col-xs-8 col-sm-8">
								<div class="input-group input-daterange" data-opens="right">
									<input type="text" class="form-control" readonly name="beginDate" id="beginDate">
								    <span class="input-group-addon">至</span>
								    <input type="text" class="form-control" readonly name="endDate" id="endDate">
<!-- 								    <input type="text" class="form-control required -- 必填"  name="endDate" id="endDate"> -->
									<span class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>	
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">VIN</label>
							<div class="col-xs-8">
								<textarea class="form-control" id="vin" name="vin" rows="2"></textarea> 
							</div>
						</div>
					</div>		
				</div>
				<input type="hidden" class="form-control" id="nvdrIds" name ="nvdrIds" >
				<input type="hidden" class="form-control" id="flag" name="flag">
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue" id="query"><i class="fa fa-search"></i>查询</a> 
							<a href="javascript:;" class="btn blue"><i class="fa fa-undo"></i>重置</a>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default table-panel">
			<div class="panel-heading">
			<div class="pannel-name" >零售上报审核</div>
				<div class="pannel-button">
					<div class="btn-group btn-group-sm">
						<a href="javascript:;" data-url="/retailReportReview/export/excel" 
							data-model="vehicle" data-method="downLoad" data-toggle="confirmation"
								class="btn btn-outline " >
							<i class="fa fa-download"></i>下载
						</a>
						<a href="javascript:;" class="btn btn-outline" data-url="/retailReportReview/approved" 
							data-model="vehicle" data-method="PUT"
							data-toggle="confirmation" data-callBack="true" data-beforeRequest="true"> <i
							class="fa fa-print" ></i>通过
						</a>
					</div>
				</div>
			</div>
			<div class="panel-body">
				<table class="table table-striped table-bordered table-hover table-responsive"
					id="dms_table"></table>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
	$(document).one("onload.dms",function(event,container){
		new Datatable().initPagination({
			src : "dms_table",
			container:container,
			url : dmsCommon.getDmsPath()["vehicle"] + "/retailReportReview",
			rowID : "",
			sortName : "",
			sortOrder : "asc",
			isQueryFirst: false,
			columns : [ 
				{checkbox:true,sortable : false},
				{field : "NVDR_ID",title : "操作",operateFormat : [
                       {type:"edit",url:"vehicle/realitySales/retailReportReview/retailReportReviewDetail.html",openWidth:"modal-lg"}
                   ]
                },  
				{field : "ORG_DESC2"			,title : "大区"}, 
        		{field : "ORG_DESC3"			,title : "小区"}, 
        		{field : "SWI_CODE"				,title : "SAP代码"}, 
        		{field : "DEALER_CODE"			,title : "经销商代码"}, 
        		{field : "DEALER_NAME"			,title : "经销商名称"}, 
        		{field : "CTM_TYPE"				,title : "客户类型",codeFormat : {type:"oemDict",codeType:"2029"}}, 
        		{field : "BRAND_NAME"			,title : "品牌"}, 
			    {field : "SERIES_NAME"			,title : "车系"}, 
			    {field : "MODEL_NAME"			,title : "车型"}, 
			    {field : "GROUP_NAME"			,title : "车款"}, 
			    {field : "MODEL_YEAR"			,title : "年款"}, 
			    {field : "COLOR_NAME"			,title : "颜色"}, 
			    {field : "TRIM_NAME"			,title : "内饰"}, 
			    {field : "VIN"					,title : "VIN"}, 
			    {field : "REMARK"				,title : "车辆分配备注",codeFormat : {type:"oemDict",codeType:"1121"}}, 
			    {field : "VEHICLE_USAGE"		,title : "车辆用途",codeFormat : {type:"oemDict",codeType:"7010"}}, 
				{field : "STATUS"				,title : "开票状态",codeFormat : {type:"oemDict",codeType:"2098"}}, 
				{field : "INVOICE_DATE"			,title : "开票日期"}, 
				{field : "REPORT_TYPE"			,title : "零售上报类型",codeFormat : {type:"oemDict",codeType:"2085"}}, 
				{field : "CREATE_DATE"			,title : "零售上报日期"}
			]
		});
		
		//批量通过的前执行函数
		$("a[data-beforeRequest='true']",container).on("beforeRequest.dms",function(event,returnResult){
			var selectRow = $("#dms_table",container).dmsTable().getSelections(); // 获取选择行
			if(!selectRow){
				dmsCommon.tip({status:"warning",msg:"请选择审核的车辆"});//总共的状态类型：info、success、error、warning
				returnResult.status = false;
			}else{
				var nvdrIds = "";
				for(var i = 0; i < selectRow.length; i++){
					if(nvdrIds==null){
						nvdrIds = selectRow[i].NVDR_ID;
					}else{
						nvdrIds = selectRow[i].NVDR_ID + "," + nvdrIds;
					}
        		}
				$("#flag",container).setDmsValue("1");
				$("#nvdrIds",container).setDmsValue(nvdrIds);
				returnResult.status = true;
			}
		});
		
		//按钮请求成功回调事件
		$("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
			$("#dms_table",getElementContext()).dmsTable().refreshTableWithForm();
		});
		
	});
</script>
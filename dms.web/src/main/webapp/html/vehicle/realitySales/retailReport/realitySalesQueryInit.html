<div class="dms-search">
	<form class="form-horizontal" >
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row ">
					<div class="col-xs-12 col-sm-8 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">品牌</label>
							<div class="col-xs-8">
								<select id="brandId"
									class="bs-select form-control" name="brandCode"
									data-url="/basedata/material/brand/2"
									data-model="manage" data-labelValue="BRAND_ID"
									data-lableDesc="BRAND_NAME">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-8 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车系</label>
							<div class="col-xs-8">
								<select id="seriesId" parent="brandId"
									class="bs-select form-control" name="seriesName"
									data-url="/basedata/material/series/2/{[brandId]}"
									data-model="manage" data-labelValue="SERIES_ID"
									data-lableDesc="SERIES_NAME">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-8 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车款</label>
							<div class="col-xs-8">
								<select id="groupId" parent="seriesId"
									class="bs-select form-control" name="groupName"
									data-url="/basedata/material/group/2/{[seriesId]}"
									data-model="manage" data-labelValue="GROUP_ID"
									data-lableDesc="GROUP_NAME" >
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-8 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">年款</label>
							<div class="col-xs-8">
								<select id="modelId" parent="groupId"
									class="bs-select form-control" name="modelYear"
									data-url="/basedata/material/modelYear/2/{[groupId]}"
									data-model="manage" data-labelValue="MODEL_YEAR"
									data-lableDesc="MODEL_YEAR">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-8 col-lg-6">
						<div class="form-group">
							<label class="control-label col-xs-4 col-sm-2">车辆发运日期</label>
							<div class="col-xs-8 col-sm-10">
								<div class="input-group input-daterange" data-opens="right">
									<input type="text" class="form-control" readonly name="beginDate" id="beginDate">
								    <span class="input-group-addon">至</span>
								    <input type="text" class="form-control" readonly  name="endDate" id="endDate">
									<span class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-8 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">颜色</label>
							<div class="col-xs-8">
								<select id="colorId" parent="modelId"
									class="bs-select form-control" name="colorName"
									data-url="/basedata/material/color/2/{[groupId]}/{[modelId]}"
									data-model="manage" data-labelValue="COLOR_CODE"
									data-lableDesc="COLOR_NAME" >
								</select>
							</div>
						</div>
					</div>
					<input type="hidden" class="form-control" id="type" name="type">
					<input type="hidden" class="form-control" id="deliveryDate" name="deliveryDate">
					<input type="hidden" class="form-control" id="vins" name="vins">
					<div class="col-xs-12 col-sm-8 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">内饰</label>
							<div class="col-xs-8">
								<select id="trimId" parent="colorId"
									class="bs-select form-control" name="trimName"
									data-url="/basedata/material/trim/2/{[groupId]}/{[modelId]}/{[colorId]}"
									data-model="manage" data-labelValue="TRIM_CODE"
									data-lableDesc="TRIM_NAME" >
								</select>
							</div>
						</div>
					</div>	
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">VIN</label>
							<div class="col-xs-8">
								<textarea class="form-control" id="vin" name="vin" rows="1"></textarea> 
							</div>
						</div>
					</div>
				</div>
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue"><i class="fa fa-search"></i>查询</a> 
							<a href="javascript:;" class="btn blue"><i class="fa fa-undo"></i>重置</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	<div class="panel panel-default table-panel">
		<div class="panel-heading">
			<div class="pannel-button">
				<div class="col-xs-1">
					<div class="btn-group btn-group-sm">
						<a href="javascript:;" class="btn btn-outline" data-url="/realitySalesQuery/approved" 
								data-model="vehicle" data-method="PUT" data-callBack="true"
								data-toggle="confirmation" data-beforeRequest="true"> <i
								class="fa fa-print" ></i>上报
						</a>
					</div>
				</div>
				<div class="col-xs-12 col-sm-6  col-md-4 col-xs-3">
					<div class="form-group">
						<label class="control-label col-xs-3" style="margin-left:-20px; margin-top:5px">交货日期</label>
						<div class="col-xs-4" style="margin-left:-20px;">
							<div class="input-group date date-picker" data-defaultToday="true">
								<input id="deliveryDateTime"  name="deliveryDateTime" 
									class="form-control required" readonly type="text" />
								 <span  class="input-group-btn">
									<button class="btn default date-set" type="button" >
										<i class="fa fa-calendar"></i>
									</button>
								</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive"
				id="dms_table"></table>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).one("onload.dms",function(event,container){
		new Datatable().initPagination({
			src : "dms_table",
			container:container,
			url : dmsCommon.getDmsPath()["vehicle"] + "/realitySalesQuery",
			rowID : "BRAND_NAME",
			sortName : "DEALER_ID",
			sortOrder : "asc",
			autoHeight:false,
			isQueryFirst:false,
			columns : [ 
				{checkbox:true,sortable : false},
				{field : "DEALER_ID",title : "操作",operateFormat : [
							{type:"edit"	,url:"vehicle/realitySales/retailReport/realitySalesApplication.html",openWidth:"modal-lg"}                                              
					]
				},
			    {field : "SERIES_CODE"			,title : "车系"}, 
			    {field : "GROUP_NAME"			,title : "车型名称"}, 
			    {field : "COLOR_NAME"			,title : "颜色描述"}, 
			    {field : "VIN"					,title : "VIN"}, 
			    {field : "STOCKOUT_DEALER_DATE"	,title : "车辆运发日期"}, 
				{field : "LIFE_CYCLE"			,title : "车辆状态",codeFormat : {type:"oemDict",codeType:"1152"}}
			]
		});
		
		//批量操作前执函数
		$("a[data-beforeRequest='true']",container).on("beforeRequest.dms",function(event,returnResult){
			var selectRow = $("#dms_table",container).dmsTable().getSelections(); // 获取选择行
			var deliveryDate = $("#deliveryDateTime",container).val();
			if(deliveryDate == null || deliveryDate == ""){
				dmsCommon.tip({status:"warning",msg:"请选择交货日期"});//总共的状态类型：info、success、error、warning
				returnResult.status = false;
			}else if(!selectRow){
				dmsCommon.tip({status:"warning",msg:"请选择零售上报车辆"});//总共的状态类型：info、success、error、warning
				returnResult.status = false;
			}else{
				var vins = "";
				for(var i = 0; i < selectRow.length; i++){
					if(vins==null){
						vins = selectRow[i].VIN;
					}else{
						vins = selectRow[i].VIN + "," + vins;
					}
        		}
				$("#deliveryDate",container).setDmsValue(deliveryDate);
				$("#type",container).setDmsValue("0");
				$("#vins",container).setDmsValue(vins);
				returnResult.status = true;
			}
		});
		
		//按钮请求成功回调事件
		$("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
			$("#dms_table",getElementContext()).dmsTable().refreshTableWithForm();
		});
		
	});
</script>
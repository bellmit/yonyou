<div class="dms-edit ajaxrest" data-url="/repairClaimCheck/repairClaimApprove/{[dealerCode]}/{[claimNo]}" data-model="vehicle" data-pageInitCallBack="true">
	<form class="form-horizontal" >
		<div class="modal-header">
			<div class="modal-title">索赔申请信息</div>
			
		</div>
		
		<div class="modal-body">
			<div class="panel panel-default">
	    		<div class="panel-body">
	    		<div class="row">
					<div class="col-xs-12 col-sm-6 col-md-4 "> 
							<div class="form-group">
								<label class="control-label col-xs-4">索赔单号</label>
								<div class="col-xs-8">
								<input type="hidden" name="status" id="status" data-fieldName="STATUS"/>
								<input type="hidden" name="claimId" id="claimId" data-fieldName="CLAIM_ID"/>
									<input id="claimNO" readonly name="" class="form-control" type="text" data-fieldName="CLAIM_NO"/> 
									</div>	
							</div>
						</div> 
						<div class="col-xs-12 col-sm-6 col-md-4 "> 
							<div class="form-group">
								<label class="control-label col-xs-4">索赔类型</label>
								<div class="col-xs-8">
									<input id="" name="" readonly="readonly" class="form-control" data-fieldName="CLAIM_TYPE" type="text"   />
								</div>
							</div>
						</div> 
					<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">经销商代码</label>
								<div class="col-xs-8">
								
									<input id="" readonly="readonly" name="" data-fieldName="DEALER_CODE"  class="form-control "  type="text" />
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">经销商名称</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="DEALER_SHORTNAME"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">VIN</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="VIN"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">牌照号</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="PLATE_NO"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">保修开始日期</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="WARRANTY_DATE"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">品牌</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="BRAND"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">车系</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="SERIES"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">车型</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="MODEL"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">工单号</label>
								<div class="col-xs-8">
									<input id="" name="" class=" form-control" data-fieldName="RO_NO" type="text"  readonly="readonly"/>
								</div>
							</div>
						</div>	
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">提交次数</label>
								<div class="col-xs-8">
									<input id="" name="" class=" form-control" data-fieldName="SUBMIT_COUNT" type="text" readonly="readonly"/>
								
								</div>
							</div>
						</div>	
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">工单开始时间</label>
								<div class="col-xs-8">
									<input id="" name="" class="form-control" data-fieldName="RO_STARTDATE" type="text"  readonly="readonly"/>
								
								</div>
							</div>
						</div>	
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">工单结束时间</label>
								<div class="col-xs-8">
									<input id="" name="" class=" form-control" data-fieldName="RO_ENDDATE" type="text" readonly="readonly"/>
								
								</div>
							</div>
						</div>	
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">行驶里程</label>
								<div class="col-xs-8">
									<input id="" name="" class=" form-control" data-fieldName="MILLEAGE"  type="text" readonly="readonly"/>
								
								</div>
							</div>
						</div>	
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">备注</label>
								<div class="col-xs-8">
								<textarea id="remark" name="remark" rows="3" cols="22" disabled="disabled"  data-fieldName="REMARK"></textarea>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		<div class="modal-body">
			<div class="panel panel-default">
	    		<div class="panel-body">
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">配件总金额</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="PART_FEE"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						
						
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">工时金额</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="LABOUR_FEE"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">其它费用金额</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="OTHER_AMOUNT"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">索赔申请金额</label>
								<div class="col-xs-8">
									<input id="" name="" data-fieldName="ALL_AMOUNT"  class="form-control"  type="text" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">抵扣金额</label>
								<div class="col-xs-8">
									<input id="" name="" class=" form-control" data-fieldName="DEDUCT_FEE" type="text"  readonly="readonly"/>
								</div>
							</div>
						</div>	
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">行驶里程</label>
								<div class="col-xs-8">
									<input id="" name="" class=" form-control" data-fieldName="MILLEAGE"  type="text" readonly="readonly"/>
								
								</div>
							</div>
						</div>	
						
						</div>
					</div>
				</div>
			</div>

<div class="panel panel-default table-panel">
			<div class="modal-header">
			<div class="modal-title">工时清单</div>
			
		</div>
		<div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive"
				id="tableList1"></table>
		</div>

	</div>
	<div class="panel panel-default table-panel">
			<div class="modal-header">
			<div class="modal-title">零部件清单</div>
			
		</div>
		<div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive"
				id="tableList2"></table>
		</div>

	</div>
	<div class="panel panel-default table-panel">
			<div class="modal-header">
			<div class="modal-title">其他项目清单</div>
			
		</div>
		<div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive"
				id="tableList3"></table>
		</div>

	</div>
	
	
	<div class="panel panel-default table-panel">
			<div class="modal-header">
			<div class="modal-title">审核项</div>
			<div class="pannel-button" >
				<div class="btn-group btn-group-sm">
					
					<a class="btn btn-outline"  data-url="vehicle/claimApproveMgr/showApproveInfo.html" data-width="modal-lg"
						data-toggle="modal"   > <i class="fa fa-search"></i>审批历史
					</a>
				</div>
			</div>
		</div>
	</div>	
		<div class="modal-body">
				<div class="panel panel-default">
	    			<div class="panel-body">
			    	<div class="row">
			    		<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">抵扣金额</label>
									<div class="col-xs-8">
										<input id="deductFee" name="deductFee" class=" form-control required" data-fieldName="DEDUCT_FEE" type="text" />
									</div>
								</div>
							</div>
							<div class="col-xs-12 col-sm-6 col-md-4 " >
								<div class="form-group">
									<label class="control-label col-xs-4">抵扣意见</label>
									<div class="col-xs-8">
										<textarea id="deductRemark" name="deductRemark" rows="3" cols="40" maxlength="900" data-fieldName="DEDUCT_REMARK" class="form-control "></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
	
		<div style="text-align:center">
			<a id ="save" data-url="/repairClaimCheck/deductDo" data-model="vehicle" data-method="PUT" data-callBack='true'
			class="btn blue" data-toggle="confirmation" data-onclickEvent="true"><i class="fa fa-save"></i>确认抵扣</a> 			
		 	<a data-dismiss="modal" class="btn blue" id="undo2"><i
			class="fa fa-undo"></i>返回</a> 
		
		</div>	
	</form>
		
</div>

<script type="text/javascript">


$(document).one("onload.dms",function(event,container){
	
	$("div[data-pageInitCallBack='true']",container).on("callBack.dms",function(event,response){
		var claimId = document.getElementById("claimId").value;
		
		new Datatable().initPagination({
			src : "tableList",
			container:container,
			url : dmsCommon.getDmsPath()["vehicle"] + "/repairClaimCheck/queryClainCaseList/"+[claimId]+"",
			rowID : "ID",
			sortName : "ID",
			sortOrder : "asc",
			autoHeight:false,
			pageSize:5,
			columns : [ 
						{field : "CASE_CODE",title : "情形"},
						{field : "FAULT_NAME",title : "技术人员"},
						{field : "FAULT_CAUSE",title : "故障说明",sortable :false,maxLengthFormat :{length:10}},
						{field : "APPLY_REMARK",title : "故障备注",sortable :false,maxLengthFormat :{length:10}}
			]

		});
	
	 new Datatable().initPagination({
		src : "tableList1",
		container:container,
		url : dmsCommon.getDmsPath()["vehicle"] + "/repairClaimCheck/queryClainLabourList/"+[claimId]+"",
		rowID : "ACTIVITY_CODE",
		sortName : "ACTIVITY_CODE",
		sortOrder : "asc",
		autoHeight:false,
		pageSize:5,
		columns : [ 
					{field : "IS_MAIN",title : "主因",inputCheckBoxFormat:{type:"dict",codeType:"1057",disabled:true}},
					{field : "LABOUR_CODE",title : "工时代码"},
					{field : "LABOUR_NAME",title : "工时名称"},
					{field : "LABOUR_NUM",title : "标准工时"},
					{field : "FEE",title : "工时单价"},
					{field : "PRICE",title : "工时金额（元）"}
					
		]

	});
	 new Datatable().initPagination({
		src : "tableList2",
		container:container,
		url : dmsCommon.getDmsPath()["vehicle"] + "/repairClaimCheck/queryRepairPartList/"+[claimId]+"",
		rowID : "ACTIVITY_CODE",
		sortName : "ACTIVITY_CODE",
		sortOrder : "asc",
		autoHeight:false,
		pageSize:5,
		columns : [ 
				{field : "IS_MAIN",title : "主因",inputCheckBoxFormat:{type:"dict",codeType:"1057",disabled:true}},
				{field : "PART_CODE",title : "零部件号"},
				{field : "PART_NAME",title : "零部件名称"},
				{field : "PRICE",title : "单价"},
				{field : "QUANTITY",title : "数量"},
				{field : "AMOUNT",title : "配件金额（元）"}
		]

	});
	 new Datatable().initPagination({
		src : "tableList3",
		container:container,
		url : dmsCommon.getDmsPath()["vehicle"] + "/repairClaimCheck/queryOtherItemList/"+[claimId]+"",
		rowID : "OTHER_REL_ID",
		sortName : "OTHER_REL_ID",
		sortOrder : "asc",
		autoHeight:false,
		pageSize:5,
		columns : [ 
		     
		    {field : "OTHER_FEE_CODE",title : "项目代码"}, 
			{field : "OTHER_FEE_NAME",title : "项目名称"},
			{field : "AMOUNT",title : "项目费用（元）"}, 
			{field : "REMARK",title : "说明"}
			
		]

	});
		
	});
	
	 $("a[data-onclickEvent='true']",container).on("dms.click",function(event){
		 if(parseFloat($("DEDUCT_FEE").value)>parseFloat($("allAmount").innerHTML)){
			 dmsCommon.tip({status:"warning",msg:"抵扣金额不能大于索赔单金额!"});
			 return;
		}
     });
	 $("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
		 $("#undo2",container).click();
	 });
	
});

   
</script>

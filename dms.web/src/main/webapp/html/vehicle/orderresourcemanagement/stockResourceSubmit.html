<div class="dms-search">
	<form class="form-horizontal" >
		<div class="panel panel-default">
	     
			<div class="panel-body">
				<div class="row ">
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">品牌</label>
								<div class="col-xs-8">
									<select id="brandId"
										class="bs-select form-control" name="brandId"
										data-url="/basedata/material/brand/90081002"
										data-model="manage" data-labelValue="BRAND_ID"
										data-lableDesc="BRAND_NAME">
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车系</label>
								<div class="col-xs-8">
									<select id="seriesId" parent="brandId"
										class="bs-select form-control" name="seriesName"
										data-url="/basedata/material/series/90081002/{[brandId]}"
										data-model="manage" data-labelValue="SERIES_ID"
										data-lableDesc="SERIES_NAME">
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车款</label>
								<div class="col-xs-8">
									<select id="groupId" parent="seriesId"
										class="bs-select form-control" name="groupName"
										data-url="/basedata/material/group/90081002/{[seriesId]}"
										data-model="manage" data-labelValue="GROUP_ID"
										data-lableDesc="GROUP_NAME" >
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">年款</label>
								<div class="col-xs-8">
									<select id="modelId" parent="groupId"
										class="bs-select form-control" name="modelYear"
										data-url="/basedata/material/modelYear/90081002/{[groupId]}"
										data-model="manage" data-labelValue="MODEL_YEAR"
										data-lableDesc="MODEL_YEAR">
									</select>
									
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">颜色</label>
								<div class="col-xs-8">
									<select id="colorId" parent="modelId"
										class="bs-select form-control" name="colorName"
										data-url="/basedata/material/color/90081002/{[groupId]}/{[modelId]}"
										data-model="manage" data-labelValue="COLOR_CODE"
										data-lableDesc="COLOR_NAME" >
									</select>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">内饰</label>
								<div class="col-xs-8">
									<select id="trimId" parent="colorId"
										class="bs-select form-control" name="trimName"
										data-url="/basedata/material/trim/90081002/{[groupId]}/{[modelId]}/{[colorId]}"
										data-model="manage" data-labelValue="TRIM_CODE"
										data-lableDesc="TRIM_NAME" >
									</select>
									
								</div>
							</div>
						</div>
						<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">VIN</label>
							<div class="col-xs-8">
								<input type="text" class="form-control" id="vin" name="vin">
							</div>
						</div>
					</div>
				
				<input type="hidden"  id="vins" name="vins" data-fieldName="VIN">
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">资源权限</label>
							<div class="col-xs-8">
								<select id="orderType" name="orderType"
									class="bs-select form-control" data-type="oemDict" data-dictCode="2083" data-excludeItems="20831002"
									data-value="20831001" data-existsDefault="false"></select>

							</div>
						</div>
					</div>
				
				
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车辆分配类型</label>
							<div class="col-xs-8">
								<select id="remark" name="remark"
									class="bs-select form-control" data-type="oemDict"  data-dictCode="1121"
									data-value=""></select>

							</div>
						</div>
					</div>
				</div>
				
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue" data-onclickEvent="true"> <i
								class="fa fa-search" ></i> 查询
							</a> 
						<a class=" btn blue " ><i class="fa fa-undo"></i>重置 </a>
						</div>

					</div>
				</div>
				<div class="panel panel-default table-panel" id="countId">
					<div class="panel-heading">
						<div class="pannel-name" >现货车辆预定</div>
					</div>
					<div class="panel-body">
						<table class="form-group  table table-striped table-bordered table-hover table-responsive"
							id="dms_table"></table>
					</div>
	            </div>
				<div class="panel panel-default table-panel hidden" id = "detailId">
					<div class="panel-heading">
						<div class="pannel-name" >现货车辆预定</div>
					</div>
					<div class="panel-body">
						<table class="form-group  table table-striped table-bordered table-hover table-responsive"
							id="dms_table1"></table>
					</div>
	            </div>
			</div>
		</div>
	
	
	
	<div class="modal-body" >
			<div class="panel panel-default hidden" id="findBandResource">
				<div class="panel-body">
					<div class="pannel-name">订单付款信息</div>
					
				</div>
				<div class="modal-body" >
				 
					<div class="row">
						<input type="hidden" id="vins" name="vins"/>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-6">收货方经销商代码：</label>
								<div class="col-xs-4">
									<input id="dealer_code" name="dealer_code"
										class="form-control dmsDisabled" maxlength="30" type="text" data-fieldName="DEALER_CODE" />
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
										<div class="form-group">
											<label class="control-label col-xs-4">收货地址：</label>
											<div class="col-xs-8">
												<input type="text" class="form-control required" id="address" name="address" data-fieldName="ADDRESS"  />
											</div>
										</div>
									</div>
						
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-5">订单付款方式：</label>
							<div class="col-xs-8">
									<input id="orderTypePay" name="orderTypePay" type="radio"
										data-type="oemDict" data-dictCode="2027" data-value="20271001" />
								</div>
						</div>
					</div>
					<input id="common_id" name="common_id" hidden="ture" data-fieldName="COMMON_ID"/>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3" >
						<div class="form-group">
							<label class="control-label col-xs-5">是否使用红票：</label>
							<div class="col-xs-8" id="radio"> 
									<input id="isTicket" name="isTicket" type="radio" 
									data-type="oemDict"	data-dictCode="1004" data-value="10041002"/>
							</div>
								<div class="co-xs-12 col-sm-6  " style="display:none" id="other">
								<div class="form-group">
								红票号码<input type="text" id="ticketNo" class="form-control required"  name="ticketNo">
								</div>
							</div>
						</div>
					</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">订单备注:</label>
								<div class="col-xs-8">
								<textarea rows="1" cols="12" id="remark" name="remark"></textarea>
									<!-- <input id="remark" name="remark"
										class="form-control " maxlength="30" type="" data-fieldName="" /> -->
								</div>
							</div>
						</div>
					</div>
			
				</div>
				</form>	
			<div class="modal-footer">
			
		<a data-url="/stockResource/stockSubmit" data-model="vehicle" data-method="PUT"
		   data-callBack="true" class="btn blue" data-toggle="confirmation" data-beforeRequest="true"> <i class="fa fa-save"></i>预定
		</a> 
		</div>
			</div>
			
		
		</div>

</div>
<script type="text/javascript">
//车辆现货预定

$(document).one("onload.dms",function(event,container){
    	new Datatable().initPagination({
			src : "dms_table",
			container:container,
			url : dmsCommon.getDmsPath()["vehicle"] + "/stockResource/stockResourceQuery",
			isQueryFirst:true,
			pageSize:5,
			columns : [ 
				{field : "COMMON_ID",title : "操作",operateFormat : 
					[            
                	{type:"edit",title : "预定",url:"vehicle/orderresourcemanagement/reserveVehicle.html",openWidth:"modal-lg",openType:"jump"}
                    ]}, 
					
					
					{field : "VIN",title :"VIN"},
					{field : "BRAND_CODE",title :"品牌"}, 
					{field : "SERIES_NAME",title : "车系"}, 
					{field : "GROUP_NAME",title : "车款"}, 
					{field : "MODEL_YEAR",title : "年款"},
					{field : "COLOR_NAME",title : "颜色"}, 
					{field : "TRIM_NAME",title : "内饰"}, 
					{field : "ORDER_TYPE",title : "资源权限",codeFormat : {type:"oemDict",codeType:"2083"}},
					{field : "VEHICLE_USAGE",title : "车辆用途"}, 
					{field : "REMARK",title : "车辆备注",codeFormat : {type:"oemDict",codeType:"1121"}}, 
					{field : "OTHER_REMARK",title : "其它备注"},
					{field : "RETAIL_PRICE",title : "建议零售价"}, 
					
				
			]
			
		});
    	new Datatable().initPagination({
			src : "dms_table1",
			container:container,
			url : dmsCommon.getDmsPath()["vehicle"] + "/stockResource/stockResourceQuery",
			pageSize:5,
			columns : [ 
				{field : "COMMON_ID",title : "操作",operateFormat : 
					[            
                	{type:"edit",title : "预定",url:"vehicle/orderresourcemanagement/reserveVehicle.html",openWidth:"modal-lg",openType:"jump"}
                    ]}, 
					
                    {checkbox:true},
					{field : "VIN",title :"VIN"},
					{field : "BRAND_CODE",title :"品牌"}, 
					{field : "SERIES_NAME",title : "车系"}, 
					{field : "GROUP_NAME",title : "车款"}, 
					{field : "MODEL_YEAR",title : "年款"},
					{field : "COLOR_NAME",title : "颜色"}, 
					{field : "TRIM_NAME",title : "内饰"}, 
					{field : "ORDER_TYPE",title : "资源权限",codeFormat : {type:"oemDict",codeType:"2083"}},
					{field : "VEHICLE_USAGE",title : "车辆用途"}, 
					{field : "REMARK",title : "车辆备注"}, 
					{field : "OTHER_REMARK",title : "其它备注"},
					{field : "RETAIL_PRICE",title : "建议零售价"}, 
					
				
			]
			
		});
    	//事件点击
		$("a[data-onclickEvent='true']",container).on("dms.click",function(event){
			var selectRow = $("#dms_table",container).dmsTable().getFirstSelection();
			
			$("div[data-tableSelect='true']",getElementContext()).initHtmlContent(selectRow);
			//关闭窗口
			$("a[data-dismiss='modal']",container).click();
		}); 
    	
		//绑定onchange 事件
		$("#orderType",container).bindChange(function(obj){
			var	order= obj.value;
			if(order==20831003||order==20831004){
				$("#findBandResource",container).removeClass("hidden");
				$("#detailId",container).removeClass("hidden");
				$("#countId",container).addClass("hidden");
				$("#dms_table1",container).dmsTable().refreshTableWithForm();
				
				dmsCommon.ajaxRestRequest({
					container : container,
					url : dmsCommon.getDmsPath()["vehicle"] + "/stockResource/findBandResource",
					type: 'GET',
					sucessCallBack : function(data) {
						$("#dealer_code",container).setDmsValue(data.DEALER_CODE);
						$("#address",container).setDmsValue(data.ADDRESS);
						//显示
						//$("#resourceInfoPanpel",container).show();
						//$("#table1",getElementContext()).dmsTable().refreshLocalData(data);
					} 
				});
				
			} else{
				$("#countId",container).removeClass("hidden");
				$("#detailId",container).addClass("hidden");
				$("#findBandResource",container).addClass("hidden");
				$("#dms_table",container).dmsTable().refreshTableWithForm();
			}
			
        
		});
    	
    	
		$("a[data-beforeRequest='true']",container)
		.on("beforeRequest.dms",function(event,returnResult){
			// debugger; 
		var selectRow = $("#dms_table1",container).dmsTable().getSelections();
		if(selectRow.length > 0){
		
			var vins = "";
			for(var i = 0 ;i<selectRow.length;i++){
				if(vins=="" ){ //第一次循环为空值
					vins = selectRow[i]["VIN"];
				}else{
					vins = vins+","+selectRow[i]["VIN"];
					
				}
				
				
				
			}
			$("#vins",getElementContext()).setDmsValue(vins);
			
		}else{
			dmsCommon.tip({status:"warning",msg:"请选择至少一条记录"});//总共的状态类型：info、success、error、warning
			returnResult.status = false;
			return ;
		}

		returnResult.status = true; //定义返回值
	});



		//新增页面的回调函数
		$("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
			dmsCommon.refreshPageByUrl("vehicle/orderresourcemanagement/stockResourceSubmit.html",container);
		});
		


    	
    });

</script>

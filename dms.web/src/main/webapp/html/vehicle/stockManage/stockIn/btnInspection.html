<div class="dms-edit ajaxrest"
	data-url="/vehicleStock/stockIn/{[VIN]}/And/{[SE_NO]}" data-model="vehicle">
	<form class="form-horizontal">
		<div class="modal-header">
			<div class="modal-title">验收结果</div>
			<div class="modal-close">
				<a data-dismiss="modal" class="btn btn-lg"> <i
					class="fa fa-remove"></i></a>
			</div>
		</div>
		<div class="modal-body">
			<div class="panel panel-default">
				<div class="panel-heading">
					<div class="pannel-name">入库信息</div>
					<div class="pannel-tools">
						<a href="javascript:;" class="expand"> <i
							class="fa fa-chevron-down"></i></a>
					</div>
				</div>
				<div class="panel-body">
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4">VIN</label>
								<div class="col-xs-8">
									<input type="hidden" name="seNo" data-fieldName="SE_NO"/>
									<input id="vin" name="vin" class="form-control" type="text"
										data-fieldName="VIN" readonly="readonly" />
								</div>
							</div>
						</div>

						<div class="col-xs-4">
							<div class="form-group form-group-xs m-b-xs">
								<label class="control-label col-xs-4 ">发动机号</label>
								<div class="col-xs-8">
									<input id="engineNo" name="engineNo" class="form-control" type="text"
										data-fieldName="ENGINE_NO" readonly="readonly" />
								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4">合格证号</label>
								<div class="col-xs-8">
									<input id="certificateNumber" name="certificateNumber"
										class="form-control" type="text"
										data-fieldName="CERTIFICATE_NUMBER" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4">钥匙编号</label>
								<div class="col-xs-8">
									<input id="keyNumber" name="keyNumber"
										class="form-control" type="text"
										data-fieldName="KEY_NUMBER" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4">送车人姓名</label>
								<div class="col-xs-8">
									<input id="deliverymanName" name="deliverymanName"
										class="form-control" type="text"
										data-fieldName="DELIVERYMAN_NAME" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4">送车人电话</label>
								<div class="col-xs-8">
									<input id="deliverymanPhone" name="deliverymanPhone"
										class="form-control" type="text"
										data-fieldName="DELIVERYMAN_PHONE" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4">承运车牌号</label>
								<div class="col-xs-8">
									<input id="shipperLicense" name="shipperLicense"
										class="form-control" type="text"
										data-fieldName="SHIPPER_LICENSE" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="form-group">
								<label class="control-label col-xs-2">承运商名称</label>
								<div class="col-xs-10">
									<input id="shipperName" name="shipperName"
										class="form-control" type="text"
										data-fieldName="SHIPPER_NAME" readonly="readonly"/>
								</div>
							</div>
						</div>
						<div class="col-xs-8">
							<div class="form-group">
								<label class="control-label col-xs-2">收货地址</label>
								<div class="col-xs-10">
									<input id="shippingAddress" name="shippingAddress"
										class="form-control" type="text" 
										data-fieldName="SHIPPING_ADDRESS" readonly="readonly"/>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4"><span style="color: red;">*</span>验收结果</label>
								<div class="col-xs-8">
									<select id="inspectionResult" name="inspectionResult"
										class="bs-select form-control required" data-fieldName="INSPECTION_RESULT"
										 data-dictCode="1335">
									</select>
								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group form-group-xs m-b-xs">
								<label class="control-label col-xs-4 "><span style="color: red;">*</span>验收人</label>
								<div class="col-xs-8">
									<input type="hidden"  data-fieldName="INSPECTOR" id="ins"/>
									<select id="inspector1" name="inspector"
										class="bs-select form-control required"
										data-url="/basedata/employees/-1/salesConsultant"  
										data-model="manage" data-labelValue="USER_ID" data-value="{[userInfo.userId]}"
										data-lableDesc="USER_NAME" >
									</select>
									<select id="inspector2" name="inspector"
										class="bs-select form-control required"
										data-url="/basedata/employees/-1/salesConsultant" data-fieldName="INSPECTOR" 
										data-model="manage" data-labelValue="USER_ID" 
										data-lableDesc="USER_NAME" >
									</select>
								</div>
							</div>
						</div>
						<div class="col-xs-4">
							<div class="form-group">
								<label class="control-label col-xs-4"><span style="color: red;">*</span>质损状态</label>
								<div class="col-xs-8">
									<select id="marStatus" name="marStatus" data-value="13061002"
										class="bs-select form-control required" data-fieldName="MAR_STATUS"
										 data-dictCode="1306">
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 详细信息 -->
			<div class="panel panel-default table-panel">
				<div class="panel-heading">
					<div class="pannel-name">车辆入库验收单详细信息</div>
					<div class="pannel-button">
						<div class="btn-group btn-group-sm">
							<a class="btn btn-outline" id="add" href="javascript:;" data-onclickEvent="true">
								<i class="fa fa-plus-square"></i> 新增
							</a>
						</div>
					</div>
				</div>
				<div class="panel-body">
					<table
						class="table table-striped table-bordered table-hover table-responsive"
						id="dms_tab"></table>
				</div>
			</div>
			<!-- 附件名称 -->
			<!-- <div class="panel panel-default table-panel">
				<div class="panel-heading">
					<div class="pannel-name">质损附件</div>
					<div class="pannel-button">
						<div class="btn-group btn-group-sm">
							<a id="add" data-url="" data-beforeShowEvent="true" class="btn btn-outline" data-toggle="modal"
								data-width="modal-lg"> <i class="fa fa-plus-square"></i> 新增
							</a>
						</div>
					</div>
				</div>
				<div class="panel-body">
					<table
						class="table table-striped table-bordered table-hover table-responsive"
						id="dms_table"></table>
				</div>
			</div> -->
		</div>
		<div class="modal-footer">
			<a data-url="/vehicleStock/stockIn/{[SE_NO]}/{[VIN]}" data-model="vehicle"
				data-method="POST" class="btn blue ajaxrest" data-callBack="true" 
				><i class="fa fa-save"></i>保存</a> <a
				data-dismiss="modal" class="btn blue"><i class="fa fa-undo"></i>取消</a>
		</div>
	</form>
</div>
<script type="text/javascript">
	$(document).one("onload.dms",function(event, container){
		 if($("#ins",container).val()==""){
			$("#inspector1").prop("class","bs-select form-control required");
			$("#inspector2").prop("class","bs-select form-control required hidden");
		}else{
			$("#inspector1").prop("class","bs-select form-control required hidden");
			$("#inspector2").prop("class","bs-select form-control required");
		} 
		
		new Datatable().initLocale({
			src : "dms_tab",
			container:container,
			url : dmsCommon.getDmsPath()["vehicle"]
			+ "/vehicleStock/stockIn/findInspectionInfo/"+$("#vin",container).val(),
			rowID : "ITEM_ID",
			selectItemName:"ITEM_ID",
			autoHeight : false,
			isQueryFirst : false,
			//checkboxHeader : true, //全选框
			undefinedText : "",
			columns : [ /* {checkbox : true,sortable : false
			}, */{title : "操作",operateFormat : [ 
						{type : "localDel",onBeforeEvent:function(value, row, index){
			            	if(row.ITEM_ID!=null&&row.ITEM_ID!=0){
			            		dmsCommon.ajaxRestRequest({
									url : dmsCommon.getDmsPath()["vehicle"] + "/vehicleStock/stockIn/"+row.ITEM_ID,
									type : 'DELETE',
									sucessCallBack : function(data) {
									}
								});
			            	}
			            },onAfterEvent:function(value, row, index){
			            	dmsCommon.tip({status:"success",msg:"删除成功！"});
			            }
			            /* ,isShow:function(value, row, index){
			            	   if($("#inspectionResult",container).val()=='13351002'){
	                    		   return false;
                   	   	}else{
	                    		   return true;
	                    	   } 
			            } */
			            }]}, 
			            {field : "ITEM_ID",inputField:"itemId",title : "编号",inputHiddenFormat : {hiddenField:"ITEM_ID"}},
			            {field : "MAR_POSITION",inputField:"marPosition",title : "质损部位",inputSelectFormat : {type:"dict",codeType:"1243"}},
			            {field : "MAR_DEGREE",inputField:"marDegree",title : "质损程度",inputSelectFormat : {type:"dict",codeType:"1244"}},
			            {field : "MAR_TYPE",inputField:"marType",title : "质损性质",inputSelectFormat : {type:"dict",codeType:"1336"}},
			            {field : "MAR_REMARK",inputField:"marRemark",inputTextFormat : {},title : "质损说明"}
				],
				onLoadSuccess : function(){
				}
		});
		
		//事件点击
		$("a[data-onclickEvent='true']",container).on("dms.click",function(event){
			$("#dms_tab",container).dmsTable().appendBlankRow();
		});
		
		//验收结果改变事件
		$("#inspectionResult",container).bindChange(function(obj){
			var index = $("#inspectionResult",container).val();
			if(index == '13351001'){//验收未通过
				$("#add", container).removeElementReadOnly();
				$("#marStatus", container).selectpicker('val',13061001);
			}else if(index == '13351002'){//验收通过
				$("#add", container).setElementReadOnly();
				$("#marStatus", container).selectpicker('val',13061002);
			}
		});
		
		//VIN值改变事件
		$("#vin",container).bindChange(function(obj){
			var index = $("#vin",container).val();
			if(index!=null){
				$("#dms_tab",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()["vehicle"]
					+ "/vehicleStock/stockIn/findInspectionInfo/"+$("#vin",container).val());
				$("#dms_tab",container).dmsTable().refreshTableWithForm();
			}
		});
		
		//回调函数
		$("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
			$("a[data-dismiss='modal']",container).click();
			$("#dms_table",getElementContext()).dmsTable().refreshTableWithForm();
		});
	});
</script>
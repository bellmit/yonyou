<div class="dms-search">
 <form class="form-horizontal">
   	<div class="panel panel-default">
   	   <div class="panel-body">
   	   		<div class="row">
			      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 ">
			         <div class="form-group">
			             <label class="control-label col-xs-4">品牌</label>
			             <div class="col-xs-8">
							<select id="brandId"
								class="bs-select form-control" name="brandId"
								data-url="/basedata/material/brand/90081002"
								data-model="manage" data-labelValue="BRAND_ID"
								data-lableDesc="BRAND_NAME">
							</select>								
						</div>
			         </div>
			      </div>
			      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 ">
			         <div class="form-group">
			             <label class="control-label col-xs-4">车系</label>
			             <div class="col-xs-8">
							<select id="seriesId" parent="brandId"
								class="bs-select form-control" name="seriesId"
								data-url="/basedata/material/series/90081002/{[brandId]}"
								data-model="manage" data-labelValue="SERIES_ID"
								data-lableDesc="SERIES_NAME">
							</select>									
						 </div>
			         </div>
			      </div>
			      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 ">
			         <div class="form-group">
			             <label class="control-label col-xs-4">车款</label>
			             <div class="col-xs-8">
							<select id="groupId" parent="seriesId"
								class="bs-select form-control" name="groupId"
								data-url="/basedata/material/group/90081002/{[seriesId]}"
								data-model="manage" data-labelValue="GROUP_ID"
								data-lableDesc="GROUP_NAME" >
							</select>									
						 </div>
			         </div>
			      </div>			      	   			
			      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 ">
			         <div class="form-group">
			             <label class="control-label col-xs-4">年款</label>
			             <div class="col-xs-8">
			                 <select id="modelId" parent="groupId"
										class="bs-select form-control" name="modelYear"
										data-url="/basedata/material/modelYear/90081002/{[groupId]}"
										data-model="manage" data-labelValue="MODEL_YEAR"
										data-lableDesc="MODEL_YEAR">
							 </select>
			             </div>
			         </div>
			      </div>
			      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 ">
			         <div class="form-group">
			             <label class="control-label col-xs-4">颜色</label>
			             <div class="col-xs-8">
			                 <select id="colorId" parent="modelId"
										class="bs-select form-control" name="colorCode"
										data-url="/basedata/material/color/90081002/{[groupId]}/{[modelId]}"
										data-model="manage" data-labelValue="COLOR_CODE"
										data-lableDesc="COLOR_NAME" >
							 </select>
			             </div>
			         </div>
			      </div>
			      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 ">
			         <div class="form-group">
			             <label class="control-label col-xs-4">内饰</label>
			             <div class="col-xs-8">
			                 <select id="trimCode" parent="colorId"
										class="bs-select form-control" name="trimCode"
										data-url="/basedata/material/trim/90081002/{[groupId]}/{[modelId]}/{[colorId]}"
										data-model="manage" data-labelValue="TRIM_CODE"
										data-lableDesc="TRIM_NAME" >
							 </select>
			             </div>
			         </div>
			      </div>			      	   			
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
								<label class="control-label col-xs-4">调出经销商</label>
								<div class="col-xs-8">
								     <div class="input-group">
										    <input id="outDealerCode" readonly name="outDealerCode"class="form-control" type="text" />
											<span class="input-group-btn">
												<button class="btn default btn-sm" type="button" data-url="vehicle/allotManage/vehicleAllotApprove/searchOutDealers.html"
													data-toggle="modal" data-width="modal-lg"> <i class="fa fa-list-alt"></i>
												</button>
												<button class="btn default input-clear" type="button">
	                                            	<i class="fa fa-close"></i>
	                                    		</button>
										   </span>
									   </div>
								</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
								<label class="control-label col-xs-4">调入经销商</label>
								<div class="col-xs-8">
								     <div class="input-group">
										    <input id="inDealerCode" readonly name="inDealerCode"class="form-control " type="text" />
											<span class="input-group-btn">
												<button class="btn default btn-sm" type="button" data-url="vehicle/allotManage/vehicleAllotApprove/searchInDealers.html"
													data-toggle="modal" data-width="modal-lg"> <i class="fa fa-list-alt"></i>
												</button>
												<button class="btn default input-clear" type="button">
	                                            	<i class="fa fa-close"></i>
	                                    		</button>
										   </span>
									   </div>
								</div>
						</div>
					</div>
			       	<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
			           <div class="form-group">
			               <label class="control-label col-xs-4 ">VIN</label>
			               <div class="col-xs-8">
			                   <input type="text"  class="form-control" id="vin" name="vin">
			               </div>
			           </div>
			       	</div>   	   			
   	   		</div>
			<div class="row ">
			    <div class="col-xs-12 " >
			      <div class="query-btn">
			                  <a href="javascript:;" class="btn blue" id="query"> <i class="fa fa-search"></i>查询</a>
			                  <a href="javascript:;" class="btn blue" id="clear"><i class="fa fa-undo"></i>重置</a>
			      </div>
			    </div>
			</div>
   	   </div>
   	</div>
   	<div class="panel  panel-default table-panel">
   	   <div class="panel-heading">
   			<div class="pannel-name" >车辆调拨审批信息</div>
	   </div>
	   <div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive"
				id="vehicleAllotApproveList"></table>
	   </div>
	</div>
 </form>
 <div class="row">
    <div class="col-md-2">
    	<label style="padding:20px;">审批意见</label>
    </div>
    <div class="col-md-6">
        <div class="row">
			<textarea id="opinion" name="opinion" cols="70" rows="3" ></textarea>
			<input type="hidden" id="checkboxsVal" name="ids"/>
        </div>
    </div>
    <div class="col-md-4">
    	<div style="margin:10px;">
    		<a  data-errorCallBack="true" data-onclickEvent="true" id="btnYes" data-info="saveBefore"  data-callBack="true"  class="btn blue" data-toggle="confirmation" data-model="vehicle" data-method="GET" ><i class="fa fa-save"></i>同意</a>
			<a  data-errorCallBack="true" data-onclickEvent="true" id="btnNo" data-info="saveBefore"  data-callBack="true"  class="btn blue" data-toggle="confirmation" data-model="vehicle" data-method="GET" ><i class="fa fa-save"></i>驳回</a>
        </div>
    </div>
</div>
</div>
<script type="text/javascript">
$(document).one("onload.dms",function(event,container){
 	new Datatable().initPagination({
		src:"vehicleAllotApproveList",
		container:container,
	    url : dmsCommon.getDmsPath()["vehicle"] + "/vehicleAllotMange/approve",
	    rowID:"TRANSFER_ID",
	    sortName:"CREATE_DATE",
	    sortOrder:"DESC",
		columns : [
			  {checkbox:true,sortable : false},
		      {field:"OUT_DEALER_NAME",title:"调出经销商"},
		      {field:"IN_DEALER_NAME",title:"调入经销商"},
		      {field:"VIN",title:"VIN"},
		      {field:"BRAND_NAME",title:"品牌"},
		      {field:"SERIES_NAME",title:"车系"},
		      {field:"MODEL_CODE",title:"CPOS"},
		      {field:"MODEL_YEAR",title:"年款"},
		      {field:"GROUP_NAME",title:"车款"},
		      {field:"COLOR_NAME",title:"颜色"},
		      {field:"TRIM_NAME",title:"内饰"},
		      {field:"CREATE_DATE",title:"调拨申请日期",dateFormat : {format : "YYYY-MM-DD HH:mm:ss"}},
		      {field:"TRANSFER_REASON",title:"调拨原因"}
		        ]
	});
 	
    $("a#btnYes[data-onclickEvent='true']", container).on("dms.onConfirm",function(event,returnResult){
    	var selectRow = $("#vehicleAllotApproveList",container).dmsTable().getSelections();
		if(!selectRow){
			dmsCommon.tip({status:"warning",msg:"请单击选择表格数据"});
			return ;
		}else{
    		var ids = "";
    		for(var i = 0; i < selectRow.length; i++){
    			ids = ids + selectRow[i].TRANSFER_ID + ",";
    		}
    		ids = ids.substring(0,ids.length -1);
    		var opinion = $("#opinion").val();
    		//同意
    		var result = 1;
    		var data = {ids:ids,opinion:opinion,result:result};
    		save(data);
		}
    });
 	
 	$("#btnNo[data-onclickEvent='true']", container).on("dms.onConfirm",function(event,returnResult){
    	var selectRow = $("#vehicleAllotApproveList",container).dmsTable().getSelections();
		if(!selectRow){
			dmsCommon.tip({status:"warning",msg:"请单击选择表格数据"});
			return ;
		}else{
    		var ids = "";
    		for(var i = 0; i < selectRow.length; i++){
    			ids = ids + selectRow[i].TRANSFER_ID + ",";
    		}
    		ids = ids.substring(0,ids.length -1);
    		var opinion = $("#opinion").val();
    		//驳回
    		var result = 0;
    		var data = {ids:ids,opinion:opinion,result:result};
    		save(data);
		}
 	});
 	
 	//保存方法
 	function save(data){
		dmsCommon.ajaxRestRequest({
			url:dmsCommon.getDmsPath()["vehicle"] + "/vehicleAllotMange/approve/checkStatus",
			type:"GET",
			dataType:"json",
			data:data,
			sucessCallBack : function(data) {
				if(data.res ==  "success"){
					$("#opinion",container).setDmsValue("");
					dmsCommon.tip({status:"success",msg:"操作成功！"});
					
				}else{
					dmsCommon.tip({status:"warning",msg:data.resMsg});
				}
				$("#query",container).click();
			},
			errorCallBack : function(data) {
				dmsCommon.tip({status:"error",msg:"操作失败！"});
			}
		});
 	}
});
</script>
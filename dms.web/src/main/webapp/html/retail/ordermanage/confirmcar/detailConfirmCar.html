<div class="dms-edit ajaxrest" data-url="/ordermanage/salesOrders/{[SO_NO_ID]}" data-model="retail">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row" >
					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">销售单号</label>
							<div class="col-xs-8">
								<input id="soNo" name="soNo" class="form-control" type="text" disabled="disabled" data-fieldName="SO_NO"/>
								<div data-tableSelect3="true">
								<input id="auditedManager" name="auditedManager" class="form-control" type="hidden"  data-fieldName="EMPLOYEE_NO"/>
								</div>
								<input id="vehicle_sale_audit" name="vehicle_sale_audit" class="form-control" type="hidden"  data-valueUrl="/basedata/BasicParameters/1020/vehicle_sale_audit"  data-ajaxSync="true" data-valueType="parameter"/>
								<input id="vehicle_finance_audit" name="vehicle_finance_audit" class="form-control" type="hidden"  data-valueUrl="/basedata/BasicParameters/1020/vehicle_finance_audit"  data-ajaxSync="true" data-valueType="parameter"/>
							</div>
						</div>
					</div>

					<div data-tableSelect="true">
					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">客户编号</label>
							<div class="col-xs-8 ">
								<div class="input-group">
									<input type="text" class="form-control" id="customerCode"
										disabled="disabled" name="customerNo"
										data-fieldName="POTENTIAL_CUSTOMER_NO" /> <input type="hidden"
										class="form-control" id="customerId" name="customerId"
										data-fieldName="PART_CUSTOMER_ID" /> <span
										class="input-group-btn">
										<button class="btn default btn-sm" type="button" disabled="disabled"
											data-url="retail/ordermanage/salesorder/selectPotentialGuest.html"
											data-toggle="modal" data-width="modal-lg">
											<i class="fa fa-list-alt"></i>
										</button>
										<button class="btn default input-clear" type="button" disabled="disabled">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">客户名称</label>
							<div class="col-xs-8">
								<input id="customerName" name="customerName"
									data-fieldName="CUSTOMER_NAME" class="form-control" type="text"
									disabled="disabled"  />
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">手机号</label>
							<div class="col-xs-8">
								<input id="mobile" name="mobile" class="form-control"
									type="text" disabled="disabled" data-fieldName="MOBILE" />
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-12 col-md-8">
						<div class="form-group">
							<label class="control-label col-xs-4 col-sm-2">联系地址</label>
							<div class="col-xs-8 col-sm-10">
								<input id="address" name="address" class="form-control" 
									type="text" disabled="disabled" data-fieldName="ADDRESS" />
							</div>
						</div>
					</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">开单日期</label>
							<div class="col-xs-8">
								<div class="input-group date date-picker">
									<input id="sheetCreateDate" name="sheetCreateDate" readonly disabled="disabled"
										class="form-control required" type="text" data-fieldName="SHEET_CREATE_DATE"/> <span
										class="input-group-btn">
										<button class="btn default date-set" type="button" disabled="disabled">
											<i class="fa fa-calendar"></i>
										</button>
                                              <button class="btn default date-reset" type="button" disabled="disabled">
                                                  <i class="fa fa-times"></i>
                                              </button>
									</span>
								</div>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group form-group-xs m-b-xs">
							<label class="control-label col-xs-4">开单人</label>
							<div class="col-xs-8">
								<select id="sheetCreatedBy" name="sheetCreatedBy" disabled="disabled"
									data-fieldName="SHEET_CREATED_BY" class="bs-select form-control required"
									data-url="/basedata/employees/employees/dict"
									data-model="manage" data-labelValue="EMPLOYEE_NO"
									data-lableDesc="EMPLOYEE_NAME" data-fieldName="SHEET_CREATED_BY">
								</select>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">签约日期</label>
							<div class="col-xs-8">
								<div class="input-group date date-picker">
									<input id="contractDate" name="contractDate" readonly disabled="disabled"
										class="form-control required" type="text" data-fieldName="CONTRACT_DATE" /> <span
										class="input-group-btn">
										<button class="btn default date-set" type="button" disabled="disabled">
											<i class="fa fa-calendar"></i>
										</button>
                                              <button class="btn default date-reset" type="button" disabled="disabled">
                                                  <i class="fa fa-times"></i>
                                              </button>
									</span>
								</div>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group form-group-xs m-b-xs">
							<label class="control-label col-xs-4">销售顾问</label>
							<div class="col-xs-8">
								<select id="consultant" name="consultant" disabled="disabled"
									class="bs-select form-control required"
									data-url="/basedata/employees/-1/salesConsultant"
									data-model="manage" data-labelValue="EMPLOYEE_NO"
									data-lableDesc="EMPLOYEE_NAME" data-fieldName="CONSULTANT">
								</select>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">合约单号</label>
							<div class="col-xs-8">
								<input id="contractNo" name="contractNo" class="form-control" disabled="disabled"
									type="text" maxlength="30"  data-fieldName="CONTRACT_NO"/>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">合约定金</label>
							<div class="col-xs-8">
								<input id="contractEarnest" name="contractEarnest" disabled="disabled"
									class="form-control" type="text" maxlength="12" data-fieldName="CONTRACT_EARNEST"/>
							</div>
						</div>
					</div>


					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">预交车时间</label>
							<div class="col-xs-8">
								<div class="input-group date date-picker">
									<input id="deliveringDate" name="deliveringDate" readonly disabled="disabled"
										class="form-control required" type="text"  data-fieldName="DELIVERING_DATE"/> <span
										class="input-group-btn">
										<button class="btn default date-set" type="button" disabled="disabled">
											<i class="fa fa-calendar"></i>
										</button>
										<button class="btn default date-reset" type="button" disabled="disabled">
											<i class="fa fa-times"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">支付方式</label>
							<div class="col-xs-8">
								<select class="bs-select form-control" id="payMode" disabled="disabled"
									name="payMode" data-dictCode="1405" data-fieldName="PAY_MODE">
								</select>
							</div>
						</div>
					</div>

					<div data-tableSelect2="true">
					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">VIN号</label>
							<div class="col-xs-8 ">
								<div class="input-group">
									<input type="text" class="form-control" id="vin" name="vin"
										data-fieldName="VIN" readonly data-isExcludeReadOnly="true"/>
									<input type="hidden" class="form-control" id="vsStockId" name="vsStockId"
										data-fieldName="VS_STOCK_ID" />
									<span class="input-group-btn">
										<button class="btn default btn-sm" type="button"
											data-url="retail/ordermanage/confirmcar/selectVIN.html"
											data-toggle="modal" data-width="modal-lg">
											<i class="fa fa-list-alt"></i>
										</button>
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">品牌</label>
							<div class="col-xs-8">
								<select id="brand" class="bs-select form-control" name="brand"
									data-url="/basedata/brandsdict" data-model="manage" data-ajaxSync = "true"
									data-labelValue="BRAND_CODE" data-lableDesc="BRAND_NAME"
									 data-fieldName="BRAND_CODE" disabled="disabled">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">车系</label>
							<div class="col-xs-8">
								<select id="seriess" parent="brand"
									class="bs-select form-control" name="series"
									data-url="/basedata/brandsdictC/{[brand]}/seriessdictC"
									data-model="manage" data-labelValue="SERIES_CODE" data-fieldName="SERIES_CODE"
									data-lableDesc="SERIES_NAME" disabled="disabled">
								</select>
							</div>
						</div>
					</div>


					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">车型</label>
							<div class="col-xs-8">
								<select id="models" parent="seriess"
									class="bs-select form-control" name="model"
									data-url="/basedata/brandsdictC/{[brand]}/seriessdictC/{[seriess]}/modelsdictC"
									data-model="manage" data-labelValue="MODEL_CODE" data-fieldName="MODEL_CODE"
									data-lableDesc="MODEL_NAME" disabled="disabled">
								</select>
							</div>
						</div>
					</div>


					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">配置</label>
							<div class="col-xs-8">
								<select id="confi" parent="models" class="bs-select form-control" name="confi"
									data-url="/basedata/brandsdictC/{[brand]}/seriessdictC/{[seriess]}/modelsdictC/{[models]}/packagesdictC"
									data-model="manage" data-labelValue="CONFIG_CODE" disabled="disabled"
									data-lableDesc="CONFIG_NAME"  data-fieldName="CONFIG_CODE">
								</select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group form-group-xs m-b-xs">
							<label class="control-label col-xs-4">颜色</label>
							<div class="col-xs-8">
								<select id="color"  disabled="disabled"
									class="bs-select form-control" name="color" data-fieldName="COLOR_CODE"
									data-url="/basedata/colors/colorinfo/dicts" data-model="repair"
									data-labelValue="COLOR_CODE" data-lableDesc="COLOR_NAME">
								</select>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">产品代码</label>
							<div class="col-xs-8 ">
								<div class="input-group">
									<input type="text" class="form-control required"
										id="productCode" name="productCode"
										data-fieldName="PRODUCT_CODE" readonly />
										<input type="hidden" disabled="disabled"
										class="form-control" id="productId" name="productId"
										data-fieldName="PRODUCT_ID" /> <span class="input-group-btn">
										<button class="btn default btn-sm" type="button" disabled="disabled"
											data-url="retail/ordermanage/salesorder/selectBrand.html"
											data-toggle="modal" data-width="modal-lg">
											<i class="fa fa-list-alt"></i>
										</button>
										<button class="btn default input-clear" type="button" disabled="disabled">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">产品名称</label>
							<div class="col-xs-8">
								<input id="productname" name="productname" data-fieldName="PRODUCT_NAME" 
									class="form-control" type="text" disabled="disabled" />
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">发动机号</label>
							<div class="col-xs-8">
								<input id="engineNo" name="engineNo" class="form-control"
									type="text" disabled="disabled" data-fieldName="ENGINE_NO" />
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4">
						<div class="form-group">
							<label class="control-label col-xs-4">合格证号</label>
							<div class="col-xs-8">
								<input id="certificateNo" name="certificateNo"
									class="form-control" type="text" disabled="disabled" data-fieldName="CERTIFICATE_NUMBER" />
							</div>
						</div>
					</div>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default table-panel">
			<div class="panel-body">
				<div class="tabbable-custom">
					<ul class="nav nav-tabs">
						<li class="active"><a href="#tab_decorationProject" data-toggle="tab">装潢项目</a></li>
						<li><a href="#tab_decorationMaterials" data-toggle="tab">装潢材料</a></li>
						<li><a href="#tab_serviceProject" data-toggle="tab">服务项目</a></li>
					</ul>
					<div class="tab-content">
						<div class="tab-pane fade in active" id="tab_decorationProject">
							<div class="panel panel-default table-panel">
								<div class="panel-heading">
									<div class="pannel-button">
										<div class="btn-group btn-group-sm">
										</div>
									</div>
								</div>
							</div>

							<div class="panel panel-default table-panel">
								<div class="panel-body">
									<table
										class="table table-striped table-bordered table-hover table-responsive"
										id="soDecrodateList">
									</table>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="tab_decorationMaterials">
							<div class="panel panel-default table-panel">
								<div class="panel-heading">
									<div class="pannel-button">
										<div class="btn-group btn-group-sm">
										</div>
									</div>
								</div>
							</div>
							<div class="panel panel-default table-panel">
								<div class="panel-body">
									<table
										class="table table-striped table-bordered table-hover table-responsive"
										id="soDecrodatePartList">
									</table>
								</div>
							</div>
						</div>
						<div class="tab-pane fade" id="tab_serviceProject">
							<div class="panel panel-default table-panel">
								<div class="panel-heading">
									<div class="pannel-button">
										<div class="btn-group btn-group-sm">
										</div>
									</div>
								</div>
							</div>
							<div class="panel panel-default table-panel">
								<div class="panel-body">
									<table
										class="table table-striped table-bordered table-hover table-responsive"
										id="soServicesList">
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row">
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车辆价格</label>
							<div class="col-xs-8">
								<input id="vehiclePrice" name="vehiclePrice" maxlength="12" data-autoValueDigits="2"
									class="form-control required" type="text"  data-fieldName="DIRECTIVE_PRICE" disabled="disabled"/>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">装潢金额</label>
							<div class="col-xs-8">
								<input id="upholsterSum" name="upholsterSum" class="form-control" data-autoValueDigits="2"
									type="text" disabled="disabled" data-fieldName="UPHOLSTER_SUM"/>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">赠送金额</label>
							<div class="col-xs-8">
								<input id="presentSum" name="presentSum" class="form-control" data-autoValueDigits="2"
									type="text" disabled="disabled" data-fieldName="PRESENT_SUM"/>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">服务项目金额</label>
							<div class="col-xs-8">
								<input id="serviceSum" name="serviceSum" class="form-control" data-autoValueDigits="2"
									type="text" disabled="disabled" data-fieldName="SERVICE_SUM" />
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">抵扣金额</label>
							<div class="col-xs-8">
								<input id="offsetAmount" name="offsetAmount" class="form-control" data-autoValueDigits="2"
									type="text" data-fieldName="OFFSET_AMOUNT" maxlength="12" disabled="disabled"/>
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">订单总额</label>
							<div class="col-xs-8">
								<input id="orderSum" name="orderSum" class="form-control" data-autoValueDigits="2"
									type="text" disabled="disabled" data-fieldName="ORDER_SUM" />
							</div>
						</div>
					</div>

					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">订单应收</label>
							<div class="col-xs-8">
								<input id="orderReceivableSum" name="orderReceivableSum" data-autoValueDigits="2"
									class="form-control" type="text" disabled="disabled"
									data-fieldName="ORDER_RECEIVABLE_SUM"   />
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="form-actions">
			<a data-url="/ordermanage/confirmcar/{[SO_NO_ID]}" data-model="retail" data-callBack="true" 
			   data-method="PUT" class="btn blue" data-toggle="confirmation" ><i class="fa fa-save"></i>保存 </a>
			<a data-goback="page" href="retail/ordermanage/confirmcar/searchConfirmCar.html" 
				class="btn blue ajaxify"><i class="fa fa-reply"> </i>返回</a>
		</div>
	</form>
</div>
<script type="text/javascript">
	$(document) .one( "onload.dms", function(event, container) {
			//金额计算
			 var calcTotalAmount = function(){
				};
		new Datatable() .initLocale({
			src : "soDecrodateList",
			rowID : "SO_DECRODATE_ID",
			container : container,
			url : dmsCommon.getDmsPath()["retail"]+ "/ordermanage/salesOrders/{[SO_NO_ID]}/decorationproject",
			columns : [
						{ field : "", title : "操作"},
						{ field : "LABOUR_CODE", inputField : "labourCode", title : "装潢项目代码", inputHiddenFormat : {} },
						{ field : "LABOUR_NAME", inputField : "labourName", title : "装潢项目名称", inputHiddenFormat : {} },
						{ field : "STD_LABOUR_HOUR", inputField : "stdLabourHour", title : "标准工时", inputHiddenFormat : {}, NumberFormat : {decimal : 2} },
						{ field : "LABOUR_PRICE", inputField : "labourPrice", title : "工时单价", inputHiddenFormat : {}},
						{ field : "DISCOUNT", inputField : "discount", title : "折扣率", inputHiddenFormat : {} },
						{ field : "AFTER_DISCOUNT_AMOUNT", inputField : "afterDiscountAmount", title : "实收金额", inputHiddenFormat : {}, numberFormat:{decimal : 2,autoValueFormat:{autoValue:"#stdLabourHour*#labourPrice*#discount",afterEvent:calcTotalAmount}} },
						{ field : "REMARK", inputField : "remark", title : "备注", inputHiddenFormat : {}} 
						]
						});
					
		new Datatable().initLocale({
			src : "soDecrodatePartList",
			rowID : "DECRODATE_PART_ID",
			container : container,
			url : dmsCommon.getDmsPath()["retail"]+ "/ordermanage/salesOrders/{[SO_NO_ID]}/deracotionmaterial",
			columns : [
						{ field : "", title : "操作" },
						{ field : "PART_CODE", inputField : "partNo", title : "配件代码", inputHiddenFormat : {} },
						{ field : "PART_NAME", inputField : "partName", title : "配件名称", inputHiddenFormat : {} },
						{ field : "STORAGE_NAME", inputField : "storageCode", title : "仓库名称", inputHiddenFormat : {hiddenField:"STORAGE_CODE"}},
						{ field : "STORAGE_POSITION_CODE", inputField : "storagePositionCode", title : "库位", inputHiddenFormat : {} },
						{ field : "PART_SEQUENCE", inputField : "partSequence", title : "序列号", inputHiddenFormat : {} },
						{ field : "SALES_PRICE", inputField : "partSalesPrice", title : "销售单价", inputHiddenFormat : {decimal : 2}},
						{ field : "PART_QUANTITY", inputField : "partQuantity", title : "数量", inputHiddenFormat : {}},
						{ field : "PART_SALES_AMOUNT", inputField : "partSalesAmount", title : "销售金额", inputHiddenFormat : {}, numberFormat:{decimal : 2,autoValueFormat:{autoValue:"#partSalesPrice*#partQuantity"}}},
						{ field : "DISCOUNT",  title : "折扣率"},
						{ field : "AFTER_DISCOUNT_AMOUNT",title : "实收金额"},
						{ field : "ACCOUNT_MODE", title : "结算方式"},
						{ field : "REMARK",title : "备注"}
						]
				});
		new Datatable().initLocale({
			src : "soServicesList",
			rowID : "SO_SERVICES_ID",
			container : container,
			url : dmsCommon.getDmsPath()["retail"]+ "/ordermanage/salesOrders/{[SO_NO_ID]}/serviceproject",
			columns : [
						{ field : "", title : "操作"},
						{ field : "SERVICE_CODE", title : "项目代码"},
						{ field : "SERVICE_NAME", title : "项目名称"},
						{ field : "SERVICE_TYPE", title : "服务类型"},
						{ field : "DIRECTIVE_PRICE", title : "销售指导价" },
						{ field : "DIRECTIVE_PRICE",  title : "实收金额"},
						{ field : "ACCOUNT_MODE",title : "结算方式"},
						{ field : "REMARK", title : "备注"}
						]
						});		
		
		//绑定事件
		$("a[data-onclickEvent='true']",container).on("dms.click",function(event){
			var saleaudit = $("#vehicle_sale_audit",container).val();
			var financeaudit = $("#vehicle_finance_audit",container).val();
			if(saleaudit==undefined&&financeaudit==undefined){
				$("#submitafter",container).attr("data-url","/ordermanage/salesOrders/{[SO_NO_ID]}/submit");
			}else{
				$("#submitafter",container).attr("data-url","retail/ordermanage/salesorder/selectVerifier.html");
			} 
			$("a[data-onclickEvent1='true']",container).click();
			});
		
		//绑定事件
		 $("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
			    $("a[data-onclickEvent3='true']",container).click();
		 });
	});
	
</script>

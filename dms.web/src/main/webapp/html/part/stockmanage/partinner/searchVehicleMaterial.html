<div class="dms-search" data-pageInitCallBack="true">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row" data-tableSelect="true">
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">工单号</label>
							<div class="col-xs-8">
								<div class="input-group">
									<input id="roNo" name="roNo" class="form-control required" data-fieldName="RO_NO" type="text" value=""/>
									<span class="input-group-btn">
										<button class="btn default btn-sm" type="button" data-info="roNo" data-url="repair/FeesSettlement/workOrder.html" 
											data-toggle="modal" data-width="modal-lg" data-callBack="true"> <i class="fa fa-list-alt"></i>
										</button>
										<button id="clear" class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车牌号</label>
								<div class="col-xs-8">
									<input id="license" name="license" class="form-control" disabled="disabled" data-fieldName="LICENSE" type="text"/>
								</div>
							</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">工单类型</label>
								<div class="col-xs-8">
									<select id="roType" name="roType" class="bs-select form-control noteach" data-dictCode="1253" data-fieldName="RO_TYPE">
									</select>
								</div>  
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">维修类型</label>
							<div class="col-xs-8 ">
								<select id="repairTypeCode" name="repairTypeCode" class="bs-select form-control"
									data-model="repair" data-url="/basedata/repairtypes/getRepairTypes/item" 
									data-labelValue="REPAIR_TYPE_CODE" data-lableDesc="REPAIR_TYPE_NAME" data-fieldName="REPAIR_TYPE_CODE"></select>
							</div>
							</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车型</label>
							<div class="col-xs-8 ">
								<select id="MODEL" class="bs-select form-control" name="MODEL"
										data-url="/basedata/intentionModel" data-model="manage"
										data-labelValue="MODEL_CODE" data-lableDesc="MODEL_NAME" data-fieldName="MODEL"></select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">客户经理</label>
							<div class="col-xs-8 ">
								<select class="bs-select form-control" id="customerManager" name="customerManager"
								data-url="/basedata/ownerWeChatBooking/findEmployees" data-model="repair" data-labelValue="EMPLOYEE_NO" 
								data-lableDesc="EMPLOYEE_NAME" data-fieldName="SERVICE_ADVISOR_ASS"></select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">开单日期</label>
							<div class="col-xs-8 ">
									<div class="input-group date date-picker">
										<input id="roCreateDate" name="roCreateDate" disabled="disabled" data-fieldName="RO_CREATE_DATE"
											class="form-control"
											type="text" value="" /> <span class="input-group-btn" >
											<button class="btn default date-set" type="button" disabled="disabled" >
												<i class="fa fa-calendar"></i>
											</button>
										</span>
									</div>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车主</label>
							<div class="col-xs-8 ">
								<input type="text" class="form-control" id="DELIVERER_PHONE" 
									disabled="disabled" name="delivererPhone" data-fieldName="OWNER_NAME">
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">指定技师</label>
							<div class="col-xs-8 ">
								<select class="bs-select form-control" id="customerManager" name="customerManager"
								data-url="/basedata/ownerWeChatBooking/findEmployees" data-model="repair" data-labelValue="EMPLOYEE_NO" 
								data-lableDesc="EMPLOYEE_NAME" data-fieldName="SERVICE_ADVISOR_ASS"></select>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default table-panel">
			<div class="panel-heading">
				<div class="pannel-name">车间借料信息</div>
				<div class="pannel-button">
					<div class="btn-group btn-group-sm">
					   <a id="addLendStuff" name="addLendStuff" data-url="part/stockmanage/partinner/addPartLendStuff.html" class="btn btn-outline" data-toggle="modal" data-width="modal-lg" disabled="disabled"> 
							<i class="fa fa-plus-square"></i> 新增
					   </a>				
					</div>
				</div>
			</div>
			<div class="panel-body">
				<table
					class="table table-striped table-bordered table-hover table-responsive"
					id="workshop_item"></table>
			</div>
			<div class="modal-footer">
				<a id="item" data-url="/stockmanage/salesparts" disabled="disabled" data-onclickEvent="true" data-method="POST" data-model="part" data-toggle="confirmation" data-callBack="true" data-beforeRequest="true" class="btn blue">
					<i class="fa fa-list-alt"></i>
					维修项目
				</a>
				<a id="out" data-onclickEvent="true" data-toggle="confirmation" data-callBack="true" data-toggle="confirmation" disabled="disabled" class="btn blue">
					<i class="fa fa-save"></i>
					出库
				</a>
				<a id="print" disabled="disabled" data-onclickEvent="true" data-toggle="confirmation" data-callBack="true" data-toggle="confirmation" class="btn blue">
					<i class="fa fa-print"></i>
					打印
				</a>
				<a id="cancel" disabled="disabled" data-onclickEvent="true" class="btn blue"><i class="fa fa-reply"></i>取消</a>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
$(document).one("onload.dms",function(event,container){
	new Datatable().initLocale({
		src : "workshop_item",
		container:container,
		rowID : "partNo",
		autoHeight:false,
		uniqueDataName:"storageName,partNo,storagePositionCode,partName",
		columns : [
				{checkbox:true,sortable : false},
				{field : "partNo",title : "操作",operateFormat : [
				       {type : "edit",url : "part/stockmanage/partinner/editPartOfVehicle.html",openWidth:"modal-lg"},
					   {type:"localDel",url:"/stockmanage/salesparts/{[SALES_PART_ID]}",model:"part",callBack:function(){					    	
						   $("#workshop_item",getElementContext()).dmsTable().refreshTableWithForm();
					    },isShow:function(value, row, index){
						   if(row.IS_FINISHED!="12781001"){
							   return true;
                    	   }else{
                    		   return false;
                    	   }      
					   }},
					   {type:"edit",url:"part/stockmanage/salespart/returnSalesItem.html",openWidth:"modal-lg",title:"退料",operateIcon:'<i class="fa fa-reply glyphicon-lg"></i>',
						   isShow:function(value, row, index){
							   if(row.ORDER_STATUS!="13031001" && row.IS_RED!="10041001"){
								   return true;
	                    	   }else{
	                    		   return false;
	                    	   }      
						   }   
					   }]},
				{field : "storageName",title : "仓库"},
			    {field : "STORAGE_CODE",visible:false,title : "仓库代码"},
			    {field : "Ro_No",visible:false,title : "工单号"},
				{field : "storagePositionCode",title : "库位代码"},
				{field : "partNo",title : "配件代码"},
				{field : "partName",title : "配件名称"},
				{field : "unitName",title : "计量单位"},
				{field : "canLendNum",title : "借出数量",numberFormat : {decimal:2}},
				{field : "customerManager",title : "借用人"}]
	});
	$("#roNo",container).bindChange(function(obj){
		var roNo=$("#roNo",container).val();
		if(roNo!=""){
			$("#workshop_item",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()["part"]+"/basedata/BookPart/"+roNo+"/queryPartWorkshopItem");
			$("#workshop_item",container).dmsTable().refreshTableWithForm();
			$("#clear",container).attr({"disabled":true});
			$("button[data-info='roNo']",container).attr({"disabled":true});
			$("#roNo",container).attr({"disabled":true});
			$('#addLendStuff',container).removeAttr('disabled');
			$('#item',container).removeAttr('disabled');
			$('#out',container).removeAttr('disabled');
			$('#print',container).removeAttr('disabled');
			$('#cancel',container).removeAttr('disabled');
		}
	});
	$("a[data-onclickEvent='true']",container).on("dms.click",function(){
		if($(this).attr('id')=='cancel'){
			dmsCommon.refreshPageByUrl("part/stockmanage/partinner/searchVehicleMaterial.html",container);//刷新页面
		}
	});
});
</script>

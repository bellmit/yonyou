<div class="dms-search">
		<div class="modal-header">
			<div class="modal-title">配件选择</div>
			<div class="modal-close">
				<a data-dismiss="modal" class="btn btn-lg"> <i
					class="fa fa-remove"></i></a>
			</div>
		</div>
		<div class="modal-body">
		<form class="form-horizontal">
			<div class="panel panel-default">
				<div class="panel-body">
					<div class="row">
	
						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="form-group">
								<label class="control-label col-xs-4 ">仓库名称</label>
								<div class="col-xs-8">
									<select id="storageCode" name="storageCode"
										class="bs-select form-control"
										data-url="/basedata/store/accessories/powerWarehouses" data-model="manage"
										data-valueUrl="/basedata/BasicParameters/1023/Repair_warehouse"  data-ajaxSync="true" data-valueType="parameter"
										data-labelValue="STORAGE_CODE" data-lableDesc="STORAGE_NAME"></select>
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="form-group">
								<label class="control-label col-xs-4">配件代码</label>
								<div class="col-xs-8">
									<input class="form-control" id="partCode" name="partCode"
										type="text">

								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4">
							<div class="form-group">
								<label class="control-label col-xs-4">配件名称</label>
								<div class="col-xs-8">
									<input class="form-control" id="partName" name="partName"
										type="text">
								</div>
							</div>
						</div>

					</div>
					<div class="row ">
						<div class="col-xs-12 ">
							<div class="query-btn">
								<a href="javascript:;" class="btn blue" data-validate = "false"> <i
									class="fa fa-search"></i>查询
								</a>
							</div>
						</div>
					</div>
					
				</div>
			</div>
			</form>
			<form class="form-horizontal">
			<div class="panel panel-default table-panel">
				<div class="panel-heading">
					<div class="pannel-name">配件信息</div>
				</div>
				<div class="panel-body">
					<table
						class="table table-striped table-bordered table-hover table-responsive"
						id="partInfoTable">
					</table>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-body" data-parentTable="partInfoTable">
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4">仓库名称</label>
								<div class="col-xs-8">
									<select id="STORAGE_CODE" name="STORAGE_CODE"
										class="bs-select form-control"
										data-url="/basedata/store/accessories/powerWarehouses" data-model="part"
										data-valueUrl="/basedata/BasicParameters/1023/Repair_warehouse"  data-ajaxSync="true" data-valueType="parameter"
										data-labelValue="STORAGE_CODE" data-lableDesc="STORAGE_NAME"
										data-fieldName="STORAGE_CODE">
									</select>
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">库位</label>
								<div class="col-xs-8">
									<input id="storagePositionCode" name="STORAGE_POSITION_CODE" 
										class="form-control" type="text" data-fieldName="STORAGE_POSITION_CODE" />
								</div>
							</div>
						</div>
						
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">配件代码</label>
								<div class="col-xs-8">
									<input id="PART_CODE" name="PART_CODE" disabled="disabled"
										class="form-control" type="text" data-fieldName="PART_CODE" />
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">配件名称</label>
								<div class="col-xs-8">
									<input id="PART_NAME" name="PART_NAME" disabled="disabled"
										class="form-control" type="text" data-fieldName="PART_NAME" />
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">含税单价</label>
								<div class="col-xs-8">
									<input id="PRICETAXED" name="PRICETAXED" class="form-control money"
										type="text" data-autoValueDigits="2" maxDigit="10"  data-fieldName="pricetaxed" />
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">含税金额</label>
								<div class="col-xs-8">
									<input id="TAXEDAMOUNT" name="TAXEDAMOUNT" class="form-control"
										type="text" data-autoValueDigits="2" data-fieldName="taxedamount"/>
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">数量</label>
								<div class="col-xs-8">
									<input id="INQUANTITY" name="INQUANTITY"
										class="form-control required decimal" maxDigit="6" maxPrecision="4" type="text" data-fieldName="canNumShow"/>
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">不含税单价</label>
								<div class="col-xs-8">
									<input id="PRICE" name="PRICE" class="form-control decimal" maxDigit="10" maxPrecision="2" type="text"
										data-autoValueDigits="2" data-fieldName="price" />
								</div>
							</div>
						</div>

						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 ">不含税金额</label>
								<div class="col-xs-8">
									<input id="AMOUNT" name="AMOUNT" class="form-control" type="text" data-autoValueDigits="2" data-fieldName="amount"  /> 
									<input id="priceTie" name="priceTie" type="hidden" class="form-control" value="0.17" /> 
									<input id="UNIT" name="UNIT" class="form-control" type="hidden" data-fieldName="UNIT" />
									<input id="COST_PRICE" name="COST_PRICE" class="form-control" type="hidden" data-fieldName="COST_PRICE" />
									<input id="FROMTYPE" name="FROMTYPE" class="form-control" type="hidden" value="13051002" />
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<label class="control-label col-xs-4 "></label>
								<div class="col-xs-8">
									<input id="isCheck" name="isCheck" type="checkbox"
										data-dictCode="1013" data-dictLabel="不含税单价"
										data-autoValueDigits="2" data-value ="10131001" />
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
			</form>
		</div>
		<div class="modal-footer center-block">
			<a class="btn blue" data-onclickEvent="true"
				data-beforeShowEvent="true"><i class="fa fa-save"></i>确定</a> <a
				data-dismiss="modal" class="btn blue"> <i class="fa fa-undo"></i>取消
			</a>
		</div>
</div>
<script type="text/javascript">
$(document).one("onload.dms",function(event,container){
	new Datatable().initPagination({
			src : "partInfoTable",
			container:container,
			rowID:"PART_ID",
			url : dmsCommon.getDmsPath()["part"] + "/basedata/partInfos/part/inWarehouseQry", 
			sortOrder : "asc",
			pageSize:5,
			isQueryFirst:false,
			autoHeight:false,
			columns : [ 
			            {field : "PART_CODE",inputField:"PART_CODE",title : "配件代码"},
			            {field : "PART_NAME",inputField:"PART_NAME",title : "配件名称"},
			            {field : "STORAGE_NAME",inputField:"storageName",title : "仓库名称"},
			            {field : "STORAGE_POSITION_CODE",inputField:"storagePositionCode",title : "库位"},
			            {field : "STOCK_QUANTITY",inputField:"stockQuantity",title : "库存数量",NumberFormat : {}},
			            {field : "PART_GROUP_CODE",inputField:"partGroupCode",title : "配件类别",codeFormat : {type : "dict",codeType : "1300"}},
			            {field : "TAX_LATEST_PRICE",inputField:"taxLatestPrice",title : "最新进货价",NumberFormat : {decimal : 2}},
			            {field : "COST_PRICE",inputField:"partCostPrice",title : "成本价",NumberFormat : {decimal : 2}},
			            {field : "PART_STATUS",inputField:"partStatus",title : "是否停用",codeFormat : {type : "dict",codeType : "1004"}}
			         ]
		});
		//事件点击
		$("a[data-onclickEvent='true']",container).on("dms.click",function(event){
			//执行校验
			var result = $("#INQUANTITY",container).validateElement();
			var resultPricetaxed= $("#PRICETAXED",container).validateElement();
			var resultPrice= $("#PRICE",container).validateElement();
			if(result==true&&resultPricetaxed==true&&resultPrice==true){
				var formJson = $("div[data-parentTable='partInfoTable']",container).serializeFormJson();
				$("#partBuyItemList",getElementContext()).dmsTable().appendRow(formJson);
			}
		});
		
		//变更公式
		var changeFormal = function(obj){
			var isChecked = $(obj).is(':checked');
			if(isChecked){
				$("#PRICE",container).bindAutoValueEvent("");
				$("#AMOUNT",container).bindAutoValueEvent("");	
				$("#TAXEDAMOUNT",container).bindAutoValueEvent("");
				$("#PRICETAXED",container).bindAutoValueEvent("");
				$("#AMOUNT",container).bindAutoValueEvent("#PRICE * #INQUANTITY");	
				$("#TAXEDAMOUNT",container).bindAutoValueEvent("#AMOUNT*(1+#priceTie)");
				$("#PRICETAXED",container).bindAutoValueEvent("#TAXEDAMOUNT/#INQUANTITY");
			}else{
				$("#PRICETAXED",container).bindAutoValueEvent("");
				$("#TAXEDAMOUNT",container).bindAutoValueEvent("");
				$("#AMOUNT",container).bindAutoValueEvent("");
				$("#PRICE",container).bindAutoValueEvent("");
				$("#TAXEDAMOUNT",container).bindAutoValueEvent("#INQUANTITY * #PRICETAXED");
				$("#AMOUNT",container).bindAutoValueEvent("#TAXEDAMOUNT/(1+#priceTie)");
				$("#PRICE",container).bindAutoValueEvent("#AMOUNT/#INQUANTITY");
			}
		};
		
		//执行初始化
		+function(){
			changeFormal($("[name='isCheck']",container));
		}(); 
		
		//绑定onchange 事件
		$("[name='isCheck']",container).bindChange(function(obj){
			changeFormal(obj);
		});
	});
</script>
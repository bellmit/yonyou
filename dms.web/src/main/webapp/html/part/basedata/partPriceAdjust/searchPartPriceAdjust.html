<div class="dms-search">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-heading">
				<div class="pannel-name">查询条件</div>
				<div class="pannel-tools">
					<a href="javascript:;" class=collapse> <i
						class="fa fa-chevron-down"></i></a>
				</div>
			</div>
			<div class="panel-body">
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-4">
					<div class="form-group">
						<label class="control-label col-xs-3">最新进价</label>
						<div class="form-group col-xs-9">
							<input type="text" class="col-xs-3" id="PRICE_LOW"
								name="PRICE_LOW"> <span
								class="form-group-addon col-xs-1">-</span> 
							<input type="text" class="col-xs-3" id="PRICE_HIGH"
								name="PRICE_HIGH">
						</div>
					</div>
				</div>
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-8">
					<div class="form-group">
						<label class="control-label col-xs-4">备注</label>
						<div class="col-xs-8">
							<input type="text" class="form-control"
								id="REMARK" name="REMARK">
						</div>
					</div>
				</div>
			</div>
				<div class="row ">
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group ">
							<label class="control-label col-xs-4  ">仓库</label>
							<div class="col-xs-8">
								<select id="STORAGE_CODE" name="STORAGE_CODE"
									class="bs-select form-control" data-labelValue="STORAGE_CODE"
									data-url="/partStocks/StockCode" data-model="part"
									 data-lableDesc="STORAGE_NAME">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">配件代码</label>
							<div class="col-xs-8 ">
								<input type="text" class="form-control" id="PART_NO"
									name="PART_CODE">
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">配件名称</label>
							<div class="col-xs-8">
								<input type="text" class="form-control" id="PART_NAME"
									name="PART_NAME">
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">配件类别</label>
							<div class="col-xs-8">
								<select id="PART_GROUP_CODE" name="PART_GROUP_CODE"
									class="bs-select form-control" data-dictCode="1136"></select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">基准价类型</label>
							<div class="col-xs-8">
								<select id="BASE_COST_TYPE" name="BASE_COST_TYPE" data-existsDefault="false"
									class="bs-select form-control" data-dictCode="1236" data-excludeItems="12361006"
									data-value="12361001"></select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">加价率小于</label>
							<div class="col-xs-8 ">
								<input type="text" class="form-control"
									id="RATE_END" name="RATE_END">
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">加价率大于</label>
							<div class="col-xs-8">
								<input type="text" class="form-control"
									id="RATE_BEGIN" name="RATE_BEGIN"> 
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">调整价类型</label>
							<div class="col-xs-8">
								<select id="IS_COST_TYPE" name="IS_COST_TYPE" data-existsDefault="false"
									class="bs-select form-control" data-dictCode="1236" data-excludeItems="12361001,12361003,12361005,12361006,12361008,12361009"
									data-value="12361002"></select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车型组集</label>
								<div class="col-xs-8">
									<div class="input-group" data-seledate='true'>
										<input id="partModelGroupCodeSet" name="partModelGroupCodeSet"
											data-fieldName="PART_MODEL_GROUP_CODE" readonly="readonly"
											class="form-control " type="text" />
										<div class="input-group-btn">
											<button class="btn default btn-sm" type="button" data-url="part/basedata/partinfo/partModelGroup.html"
												data-toggle="modal" data-info="license">
												<i class="fa fa-search" />
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<div class="col-xs-3"></div>
							<div class="col-xs-9">
								<input id="SALES_COST" name="SALES_COST" type="checkbox"
									data-dictCode="1057" data-dictLabel="现销售价＜成本价">
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-12 col-md-6 col-lg-3">
						<div class="form-group">
							<div class="col-xs-3"></div>
							<div class="col-xs-9">
								<input id="SALES_ADVICE" name="SALES_ADVICE" type="checkbox"
									data-dictCode="1057" data-dictLabel="现销售价＜建议销售价">
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<div class="col-xs-3"></div>
							<div class="col-xs-9">
								<input id="SALES_LIMIT" name="SALES_LIMIT" type="checkbox"
									data-dictCode="1057" data-dictLabel="销售限价<销售价">
							</div>
						</div>
					</div>
				</div>
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue"> <i
								class="fa fa-search"></i> 查询</a>
							<a href="javascript:;" class="btn blue"><i
								class="fa fa-undo"></i> 重置</a>
						</div>
					</div>
				</div>
		</div>
		<div class="panel panel-default table-panel">
			<div class="panel-heading">
				<div class="pannel-name">配件库存价格</div>
				<div class="pannel-button">
					<div class="btn-group btn-group-sm">
						<a class="btn btn-outline"
							data-url="part/basedata/partPriceAdjust/editPartPriceAdjustALL.html"
							data-toggle="modal" data-width="modal-sm"
							data-beforeShowEvent="true"> <i class="fa fa-plus-square"></i>批量修改</a> 
						<a href="part/basedata/partPriceAdjust/importPartAdjust.html"
							class="btn btn-outline ajaxify"> <i class="fa fa-upload" />导入</a> 
						<a data-url="/basedata/partPrice/export/excel" data-model="part"
							data-method="downLoad" data-toggle="confirmation"
							class="btn btn-outline "><i class="fa fa-download"></i>导出</a>
						<a data-url="/basedata/partPrice/export/excels" data-model="part"
							data-method="downLoad" data-toggle="confirmation"
							class="btn btn-outline " ><i class="fa fa-download"/>导入销售价模板下载</a>		
					</div>
				</div>
			</div>
			<div class="panel-body">
				<table
					class="table table-striped table-bordered table-hover table-responsive"
					id="dms_table"></table>
			</div>
			<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
				<div class="form-group">
					<div class="col-xs-12">
						<label class="control-label col-xs-12">加价率=(销售价-基准价)/基准价*100%</label>
					</div>
				</div>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
	$(document).one("onload.dms",function(event,container){
		new Datatable().initPagination({
			src : "dms_table",
			container:container,
			url : dmsCommon.getDmsPath()["part"] + "/basedata/partPrice",
			rowID : "PART_NO",
			sortName : "PART_NO", 
			checkboxHeader:true, 
			sortOrder : "asc",
			autoHeight:false,
			undefinedText : "",
			columns : [ 
				{checkbox:true},
			    {field : "PART_NO",title : "操作",operateFormat : [
                      {type:"edit",url:"part/basedata/partPriceAdjust/editPartPriceAdjust.html",openWidth:"modal-lg"}, //默认不支持双击操作
                   ]}, 
                {field : "STORAGE_NAME",title : "仓库名称"},
				{field : "STORAGE_POSITION_CODE",title : "库位"},
				{field : "PART_GROUP_CODE",title : "配件类别"},
				{field : "PART_NO",title : "配件代码",inputHiddenFormat : {hiddenField:"PART_NO"}},
				{field : "PART_NAME",title : "配件名称"}, 
				{field : "SALES_PRICE",title : "现销售价",numberFormat : {decimal:2}},
				{field : "INSURANCE_PRICE",title : "保险价",numberFormat : {decimal:2},inputHiddenFormat : {hiddenField:"INSURANCE_PRICE"}},
				{field : "NODE_PRICE",title : "网点价",numberFormat : {decimal:2},inputHiddenFormat : {hiddenField:"NODE_PRICE"}},
				{field : "LATEST_PRICE",title : "最新进货价",numberFormat : {decimal:2},inputHiddenFormat : {hiddenField:"LATEST_PRICE"}},
				{field : "LIMIT_PRICE",title : "销售限价",numberFormat : {decimal:2},inputHiddenFormat : {hiddenField:"LIMIT_PRICE"}}, 
				{field : "INSTRUCT_PRICE",title : "建议销售价",numberFormat : {decimal:2},inputHiddenFormat : {hiddenField:"INSTRUCT_PRICE"}}, 
				{field : "COST_PRICE",title : "成本价",numberFormat : {decimal:2},inputHiddenFormat : {hiddenField:"COST_PRICE"},isVisible:function(column){	
					   //是否显示成本价
			           if("{[userInfo.purchase.13131001]}"=="true"){
			        	   return true;
			           };
			           return false;
		        }},//配件成本单价(TT_PART_STOCK)
				{field : "CLAIM_PRICE",title : "索赔价",inputHiddenFormat : {hiddenField:"CLAIM_PRICE"},numberFormat : {decimal:2},isVisible:function(column){	
					   //是否显示成本价
			           if("{[userInfo.purchase.13131002]}"=="true"){
			        	   return true;
			           };
			           return false;
		        }},
		        {field : "PART_MODEL_GROUP_CODE_SET",title : "配件车型组集"},
				{field : "RATE",title : "加价率(%)",numberFormat : {decimal:2}}
			]
		});
	//弹出页面打开前执行函数
	$("a[data-beforeShowEvent='true']",container).on("beforeShow.dms",function(event,returnResult){
		var selectRow = $("#dms_table",container).dmsTable().getSelections();
		if(!selectRow){
			dmsCommon.tip({status:"warning",msg:"请单击选择父表格数据"});
			returnResult.status = false;
			return ;
		}
		for(var i = 0;i<selectRow.length;i++){
			if(!selectRow[i].LATEST_PRICE>0){
				dmsCommon.tip({status:"warning",msg:"最新进货价为0不做调整"});
				returnResult.status = false;
				return ;
			}	
		}
		returnResult.status = true;
	});
	});
</script>

<!-- add by zhengzengliang -->
<div class="dms-search" data-pageInitCallBack="true">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row ">
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-2">日期</label>
							<div class="col-xs-4">
								<select id="yearId" class="bs-select form-control "
									name="yearName" data-url="/forecastAudit/getYearList"
									data-model="manage" data-existsDefault = "false"
									data-labelValue="FORECAST_YEAR"
									data-lableDesc="FORECAST_YEAR"
									data-alwaysRefresh="true"  >
								</select>
							</div>
							<label class="control-label col-xs-1">年</label>
							<div class="col-xs-4">
								<select id="monthId" class="bs-select form-control "
									 parent="yearId"
									name="monthName" data-dictCode="9009"
									data-labelValue="FORECAST_MONTH"
									data-lableDesc="FORECAST_MONTH">
								</select>
							</div>
							<label class="control-label col-xs-1">月</label>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">任务编号</label>
							<div class="col-xs-8">
								<select id="taskCodeId"  name="taskCodeName" data-existsDefault = "false"
									parent="monthId" data-url="/forecastAudit/year/{[yearId]}/month/{[monthId]}/taskCode"
									class="bs-select form-control required" data-model="manage"
									 data-labelValue="TASK_ID"   data-fieldName="TASK_ID"
									data-lableDesc="TASK_ID" data-alwaysRefresh="true">
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue" data-onclickEvent="true"> <i
								class="fa fa-search" ></i> 查询
							</a> 
							<a href="javascript:;" class="btn blue"><i
								class="fa fa-undo"></i> 重置
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	<div class="panel panel-default table-panel">
		<div class="panel-heading">
			<div class="pannel-name" >生产订单审核明细</div>
			<div class="pannel-button">
				<div class="btn-group btn-group-sm">
					<a href="javascript:;" data-url="/forecastAudit/export/excel" 
						data-model="manage" data-method="downLoad" data-toggle="confirmation"
						class="btn btn-outline " ><i class="fa fa-download"></i>导出</a>
					<a href="salesPlanManage/forecastManage/importForecastAudit.html?taskCodeName={[taskCodeName]}" 
						class="btn btn-outline ajaxify"> <i class="fa fa-upload"></i>导入</a>
				</div>
			</div>
		</div>
		<div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive"
				id="forecast_audit_table"></table>
		</div>
	</div>
</div>

<script type="text/javascript">
    $(document).one("onload.dms",function(event,container){
		var flag = false;
    	
    	new Datatable().initPagination({
    		src : "forecast_audit_table",
    		container:container,
    		   url : dmsCommon.getDmsPath()["manage"] + "/forecastAudit/forecastAuditQuery",
    		   rowID : "TASK_ID",
    			columns : [ 
                   
                    {field : "BIG_AREA",title : "大区"},
                    {field : "SMALL_AREA",title : "小区"},
                    {field : "DEALER_CODE",title : "经销商代码"},
                    {field : "DEALER_NAME",title : "经销商名称"},
                    {field : "BRAND_NAME",title : "品牌"},
                    {field : "SERIES_NAME",title : "车系"},
                    {field : "MODEL_CODE",title : "CPOS"},
                    {field : "GROUP_NAME",title : "车款"},
                    {field : "MODEL_YEAR",title : "年款"},
                    {field : "COLOR_CODE",title : "颜色代码"},
                    {field : "COLOR_NAME",title : "颜色"},
                    {field : "TRIM_CODE",title : "内饰代码"},
                    {field : "TRIM_NAME",title : "内饰"},
                    {field : "REQUIRE_NUM",title : "需求数量"},
                    {field : "CONFIRM_NUM",title : "OTD确认数量"}
    			],
    			onLoadSuccess : function() {  	
    				$("#forecast_audit_table",container).dmsTable().bootstrapTable('resetView');
    				if(!flag){    					
    		    	 $("#yearId").trigger("change");
    		    	 var date=new Date();
    		    	 var month=date.getMonth()+1;
    		    	 if(month == 1){
    		    		 $("#monthId",container).setDmsValue(90091001);
    		    	 }else if(month == 2){
    		    		 $("#monthId",container).setDmsValue(90091002);
    		    	 }else if(month == 3){
    		    		 $("#monthId",container).setDmsValue(90091003);
    		    	 }else if(month == 4){
    		    		 $("#monthId",container).setDmsValue(90091004);
    		    	 }else if(month == 5){
    		    		 $("#monthId",container).setDmsValue(90091005);
    		    	 }else if(month == 6){
    		    		 $("#monthId",container).setDmsValue(90091006);
    		    	 }else if(month == 7){
    		    		 $("#monthId",container).setDmsValue(90091007);
    		    	 }else if(month == 8){
    		    		 $("#monthId",container).setDmsValue(90091008);
    		    	 }else if(month == 9){
    		    		 $("#monthId",container).setDmsValue(90091009);
    		    	 }else if(month == 10){
    		    		 $("#monthId",container).setDmsValue(90091010);
    		    	 }else if(month == 11){
    		    		 $("#monthId",container).setDmsValue(90091011);
    		    	 }else if(month == 12){
    		    		 $("#monthId",container).setDmsValue(90091012);
    		    	 } 
    		    	 flag = true;
    				}
    			}
    		});
    	
    	//绑定查询按钮回调
    	$("a[data-onclickEvent='true']",container).on("dms.click",function(event){
    	});
    	
    	// data-url="/forecastAudit/year/{[FORECAST_YEAR]}/month/{[FORECAST_MONTH]}/taskCode"
    	// data-model="manage"
    	//绑定onchange 事件
		$("[name='yearName']",container).bindChange(function(obj){
			$("#monthId",container).trigger("change");
		});
    	
		//绑定onchange 事件
		/* $("[name='monthName']",container).bindChange(function(obj){
			changeTaskCode();
			$("#yearId",container).trigger("change");
		}); */ 
		
		function changeTaskCode(){
			var yearId = $("#yearId",container).val();
			var monthId = $("#monthId",container).val();
			var url = "/forecastAudit/year/"+yearId+"/month/"+monthId+"/taskCode";
			$("#taskCodeId").attr("data-url",url);
		}
		
    	
    });

    
</script>

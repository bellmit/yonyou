<div class="dms-search" data-pageInitCallBack= "true">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="panel panel-default">
					<div class="panel-heading">
						<div class="pannel-name">查询条件</div>
						<div class="pannel-tools">
							<a href="javascript:;" class=collapse> <i
								class="fa fa-chevron-down"></i></a>
						</div>
					</div>
					<div class="panel-body">
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">经销商</label>
								<div class="col-xs-9">
									<select id="DEALER_CODE" class="bs-select form-control"
										name="DEALER_CODE"
										data-url="/stockManage/safeguard/findDealerInfo"
										data-value="{[userInfo.dealerCode]}" data-model="customer"
										data-labelValue="dealer_code"
										data-lableDesc="DEALER_SHORTNAME">
									</select>
								</div>
							</div>
						</div>
						<!-- /span -->
						
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">品牌</label>
								<div class="col-xs-9">
									<select id="brand" class="bs-select form-control"
										data-ajaxSync="true" name="brandCode"
										data-url="/basedata/brandsdict" data-model="manage"
										data-labelValue="BRAND_CODE" data-lableDesc="BRAND_NAME"
										data-alwaysRefresh="true">
									</select>
								</div>
							</div>
						</div>
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">车系</label>
								<div class="col-xs-9">
									<select id="series" class="bs-select form-control"
										name="seriesCode" data-url="/basedata/selectSeries"
										data-model="manage" data-labelValue="SERIES_CODE"
										data-lableDesc="SERIES_NAME" data-alwaysRefresh="true">
									</select>
								</div>
							</div>
						</div>
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

							<div class="form-group">
								<label class="control-label col-xs-3">销售日期</label>
								<div class="col-xs-9">
									<div class="input-group input-daterange" >
										<input type="text" class="form-control" readonly data-defaultDays="7"
											name="salesDateFrom" id="salesDateFrom"
											value="" /> <span class="input-group-addon">至</span> <input
											type="text" class="form-control" readonly
											name="salesDateTo" id="salesDateTo" value="" />
										<span class="input-group-btn">
											<button class="btn default input-clear" type="button">
												<i class="fa fa-close"></i>
											</button>
										</span>
									</div>
								</div>
							</div>
						</div>
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">车型</label>
								<div class="col-xs-9">
									<select id="model" class="bs-select form-control"
										name="modelCode" data-url="/basedata/selectModel"
										data-model="manage" data-labelValue="MODEL_CODE"
										data-lableDesc="MODEL_NAME" data-alwaysRefresh="true">
									</select>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">VIN</label>
								<div class="col-xs-9">
									<input type="hidden" id="vin2" /> <input type="text"
										class="form-control" id="vin" name="vin" />
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">提醒状态</label>
								<div class="col-xs-9">
									<select id="remindStatus" class="bs-select form-control" name="remindStatus"
										data-dictCode="1382">
									</select>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

							<div class="form-group">
								<label class="control-label col-xs-3">保险开始日</label>
								<div class="col-xs-9">
									<div class="input-group input-daterange" >
										<input type="text" class="form-control" readonly data-defaultDays="7"
											name="insuranceBeginDateFrom" id="insuranceBeginDateFrom" 
											value="" /> <span class="input-group-addon">至</span> <input
											type="text" class="form-control" readonly
											name="insuranceBeginDateTo" id="insuranceBeginDateTo" value="" />
										<span class="input-group-btn">
											<button class="btn default input-clear" type="button">
												<i class="fa fa-close"></i>
											</button>
										</span>
									</div>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">是否激活</label>
								<div class="col-xs-9">
									<select id="isValid" class="bs-select form-control" name="isValid"
										data-dictCode="1278">
									</select>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">车牌号</label>
								<div class="col-xs-9">
									<input type="text" class="form-control" id="license" name="license" />
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-3">定保专员</label>
								<div class="col-xs-9">
									<select id="maintainAdvisor" class="bs-select form-control"
										data-ajaxSync="true" name="maintainAdvisor"
										data-url="/customer/solicitude/dcrc" data-model="customer"
										data-labelValue="EMPLOYEE_NAME" data-lableDesc="EMPLOYEE_NAME"
										data-alwaysRefresh="true">
									</select>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

							<div class="form-group">
								<label class="control-label col-xs-3">保险结束日</label>
								<div class="col-xs-9">
									<div class="input-group input-daterange" >
										<input type="text" class="form-control" readonly data-defaultDays="7"
											name="insuranceEndDateFrom" id="insuranceEndDateFrom"
											value="" /> <span class="input-group-addon">至</span> <input
											type="text" class="form-control" readonly
											name="insuranceEndDateTo" id="insuranceEndDateTo" value="" />
										<span class="input-group-btn">
											<button class="btn default input-clear" type="button">
												<i class="fa fa-close"></i>
											</button>
										</span>
									</div>
								</div>
							</div>
						</div>
						<!--/span-->
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-3">车主地址</label>
							<div class="col-xs-9">
								<input type="text" class="form-control" id="contactorAddress" name="contactorAddress" />
							</div> 
						</div>
					</div>
					<!--/span-->
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-3">是否提醒回厂</label>
							<div class="col-xs-9">
								<select id="isReturnFactory" class="bs-select form-control" 
									name="isReturnFactory" data-dictCode="1278" disabled="disabled">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-3">险种</label>
							<div class="col-xs-9">
								<select id="insuranceTypeName" class="bs-select form-control"
									data-ajaxSync="true" name="insuranceTypeName"
									data-url="/customer/insurance/insuranceTypeName" data-model="customer"
									data-labelValue="INSURANCE_TYPE_NAME" data-lableDesc="INSURANCE_TYPE_NAME"
									data-alwaysRefresh="true">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

						<div class="form-group">
							<label class="control-label col-xs-3">提醒时间</label>
							<div class="col-xs-9">
								<div class="input-group input-daterange">
									<input type="text" class="form-control" readonly
										data-defaultDays="7" name="remindDateFrom" id="remindDateFrom"
										value="" /> <span class="input-group-addon">至</span> <input
										type="text" class="form-control" readonly name="remindDateTo"
										id="remindDateTo" value="" /> <span class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-3">DCRC专员</label>
							<div class="col-xs-9">
								<select id="dcrcAdvisor" class="bs-select form-control"
									data-ajaxSync="true" name="dcrcAdvisor"
									data-url="/customer/solicitude/dcrc" data-model="customer"
									data-labelValue="EMPLOYEE_NAME" data-lableDesc="EMPLOYEE_NAME"
									data-alwaysRefresh="true">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
				</div>
				<div class="row">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn btn-sm blue"> <i
								class="fa fa-search"></i> 查询
							</a> <a href="javascript:;" class="btn btn-sm blue"><i
								class="fa fa-undo"></i> 重置</a>
						</div>
					</div>
				</div>
			</div>
			<div class="panel panel-default table-panel">
				<div class="panel-heading">
					<div class="pannel-name">保险到期提醒</div>
					<div class="pannel-button">
						<div class="btn-group btn-group-sm">
							<!--/span-->
							<a id="editOwner" data-toggle="modal" data-beforeShowEvent="true"
								data-url="customer/insurance/updateOwner.html" data-width="modal-lg"
								data-callBack="true" class="btn btn-outline"><i class="fa fa-edit" />修改车主信息 
							</a>
							<!--/span-->		
							<a id="editVehicle" data-beforeShowEvent="true" class="btn btn-outline"
								data-url="customer/solicitude/updateVehicle.html" data-toggle="modal" data-width="modal-lg">
								<i class="fa fa-edit" />修改车辆信息 
							</a> 
							<!--/span-->
							<a id="remind" data-beforeShowEvent="true" class="btn btn-outline"
								data-url="customer/insurance/remind.html" data-toggle="modal" data-width="modal-md">
								<i class="fa fa-plus-square" />提醒 
							</a> 
							<!--/span-->
							<a id="remindRecord" data-toggle="modal" data-width="modal-lg" class="btn btn-outline"
								data-url="customer/insurance/remindRecord/remindRecord.html" data-beforeShowEvent="true">
								<i class="fa fa-search" />提醒记录
							</a>
							<!--/span-->
							<a id="addInsure" data-toggle="modal" data-width="modal-lg" class="btn btn-outline"
								data-url="customer/insurance/addInsure.html" data-beforeShowEvent="true">
								<i class=" fa fa-plus-square" />新增投保单
							</a>
							<!--/span-->
							<a id="appointmentPlan"  data-toggle="modal" data-width="modal-lg" class="btn btn-outline"
								data-url="customer/insurance/appointmentPlan/appointmentPlan.html" data-beforeShowEvent="true">
								<i class="fa fa-edit" />预约安排
							</a>
							<!--/span-->							
							<a id="maintainHistory" data-toggle="modal" data-width="modal-lg" class="btn btn-outline"
								data-url="customer/insurance/maintainHistory/maintainHistory.html" data-beforeShowEvent="true">
								<i class="fa fa-edit" />维修历史
							</a>
							<!--/span-->
							<a id="suggestMaintain" data-toggle="modal" data-width="modal-lg" data-beforeShowEvent="true"
								data-url="customer/insurance/suggestMaintain/suggestMaintain.html" class="btn btn-outline">
								<i class="fa fa-edit" />建议维修
							</a>
							<!--/span-->
							<a id="complainHistory" data-toggle="modal" data-width="modal-lg" data-beforeShowEvent="true"
								data-url="customer/insurance/complainHistory/complainHistory.html" class="btn btn-outline">
								<i class="fa fa-edit" />投诉历史
							</a>
							<!--/span-->
							<a href="javascript:;" data-url="/customer/insurance/export"
								data-model="customer" data-method="downLoad" id="excel" 
								data-toggle="confirmation" class="btn btn-outline "> <i
								class="fa fa-download"></i>导出
							</a>
						</div>
					</div>
				</div>
				<div class="panel-body">
					<table
						class="table table-striped table-bordered table-hover table-responsive"
						id="dms_insurance">
					</table>
				</div>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
	$(document).one("onload.dms", function(event, container) {
		
		new Datatable().initPagination({
			src : "dms_insurance",
			rowID : "LICENSE",
			container : container,
			url : dmsCommon.getDmsPath()["customer"] + "/customer/insurance",
			sortName : "OWNER_NAME",
			sortOrder : "desc",
			checkboxHeader:true, //全选框
			autoHeight : false,
			undefinedText : "",
			columns : [
            {checkbox : true,sortable:false},
	        {
				field : "dealer_shortname",
				title : "经销商"
			}, {
				field : "INSURANCE_TYPE_NAME",
				title : "险种"
			}, {
				field : "LICENSE",
				title : "车牌号"
			}, {
				field : "VIN",
				title : "VIN"
			}, {
				field : "BRAND",
				title : "品牌"
			}, {
				field : "SERIES",
				title : "车系"
			}, {
				field : "MODEL",
				title : "车型"
			}, {
				field : "OWNER_NAME",
				title : "车主"
			}, {
				field : "OWNER_NO",
				title : "车主编号"
			}, {
				field : "PHONE",
				title : "车主电话"
			}, {
				field : "MOBILE",
				title : "车主手机"
			}, {
				field : "ADDRESS",
				title : "车主地址"
			}, {
				field : "OWNER_PROPERTY",
				title : "车主性质",
				codeFormat : {
					type : "dict",
					codeType : "1190"
				}
			}, {
				field : "DELIVERER",
				title : "送修人"
			}, {
				field : "DELIVERER_MOBILE",
				title : "送修人手机"
			}, {
				field : "DELIVERER_PHONE",
				title : "送修人电话"
			}, {
				field : "CONTACTOR_NAME",
				title : "联系人",
			}, {
				field : "CONTACTOR_MOBILE",
				title : "联系人手机"
			}, {
				field : "CONTACTOR_PHONE",
				title : "联系人电话"
			}, {
				field : "CONTACTOR_ZIP_CODE",
				title : "联系人邮编"
			}, {
				field : "CONTACTOR_ADDRESS",
				title : "联系人详细地址"
			}, {
				field : "INSURATION_SHORT_NAME",
				title : "保修公司"
			}, {
				field : "INSURANCE_BEGIN_DATE",
				title : "保修开始日期",
				dateFormat : {
					format : "YYYY-MM-DD HH:mm:ss"
				}
			}, {
				field : "INSURANCE_END_DATE",
				title : "保修结束日期",
				dateFormat : {
					format : "YYYY-MM-DD HH:mm:ss"
				}
			},  {
				field : "REMINDER",
				title : "提醒人"
			}, {
				field : "REMIND_STATUS",
				title : "提醒状态",
				codeFormat : {
					type : "dict",
					codeType : "1382"
				}
			}, {
				field : "REMIND_FAIL_REASON",
				title : "提醒失败原因",
				codeFormat : {
					type : "dict",
					codeType : "1383"
				}
			}, {
				field : "REMIND_CONTENT",
				title : "提醒内容"
			}, {
				field : "REMIND_DATE",
				title : "提醒时间",
				dateFormat : {
					format : "YYYY-MM-DD HH:mm:ss"
				}
			}, {
				field : "CUSTOMER_FEEDBACK",
				title : "客户反馈"
			}, {
				field : "service_advisor_name",
				title : "客户经理"
			}, {
				field : "SALES_DATE",
				title : "销售日期",
				dateFormat : {
					format : "YYYY-MM-DD"
				}
			}, {
				field : "IS_VALID",
				title : "是否激活",
				codeFormat : {
					type : "dict",
					codeType : "1278"
				}
			}, {
				field : "IS_SELF_COMPANY_INSURANCE",
				title : "是否本公司投保",
				codeFormat : {
					type : "dict",
					codeType : "1278"
				}
			}, {
				field : "MAINTAIN_ADVISOR",
				title : "续保专员"
			}, {
				field : "DCRC_ADVISOR",
				title : "DCRC专员"
			}, {
				field : "DCRC_ADVISOR",
				title : "是否提醒回厂",
				codeFormat : {
					type : "dict",
					codeType : "1278"
				}
			}  ],
			/* onLoadSuccess : function() {
				var rownu = $("#dms_solicitude",container).dmsTable().getTableRows();
				if(rownu<=0){
					$("a[data-method='downLoad']",container).attr("disabled","true");
				}else{
					$("a[data-method='downLoad']",container).removeAttr("disabled");
				}
			} */
		});			
		
		 
		  $("a[data-beforeShowEvent='true']",container).on("beforeShow.dms",function(event,returnResult){
			 var selectRow = $("#dms_insurance",container).dmsTable().getSelections();
			 
			 if(!selectRow){
					dmsCommon.tip({status:"warning",msg:"请选择表格数据"});
					returnResult.status = false;
					return ;
				}
				$(this).data("pageData",{VIN:selectRow[0].VIN,
				LICENSE:selectRow[0].LICENSE,
				RO_CREATE_DATE:selectRow[0].RO_CREATE_DATE,
				OWNER_NO:selectRow[0].OWNER_NO,
				OWNER_NAME:selectRow[0].OWNER_NAME});//传递多个值
				/*alert(selectRow[0].VIN);
				alert(selectRow[0].OWNER_NO);
				alert(selectRow[0].LICENSE);
				alert(selectRow[0].RO_CREATE_DATE);*/
				returnResult.status = true;
			
			 var vins = '';
			 var ownerNos = '';
			 var nextMaintainMileages = '';
			 
			 var engineNos = '';
			 var licenses = '';
			 var addresss= '';
			 
			 for(var i = 0;i<selectRow.length;i++){
				 if(i==selectRow.length-1){
					 vins +=selectRow[i].VIN;
					 ownerNos +=selectRow[i].OWNER_NO;
					 nextMaintainMileages +=selectRow[i].NEXT_MAINTAIN_MILEAGES;
					 
					 engineNos +=selectRow[i].ENGINE_NO;
					 licenses +=selectRow[i].LICENSE;
					 addresss +=selectRow[i].ADDRESS;
					 
				 }else{
					 vins +=selectRow[i].VIN+',';
					 ownerNos +=selectRow[i].OWNER_NO+',';
					 nextMaintainMileages +=selectRow[i].NEXT_MAINTAIN_MILEAGES+',';
					 
					 engineNos +=selectRow[i].ENGINE_NO+',';
					 licenses +=selectRow[i].LICENSE+',';
					 addresss +=selectRow[i].ADDRESS+',';
				 }
			 }
			 
			 $("#vin2",container).val(vins);
			 /* $("#vin",container).removeClass("required"); */
			 $("#ownerNo2",container).val(ownerNos);
			 $("#ownerNo",container).removeClass("required");
			 $("#nextMaintainMileage2",container).val(nextMaintainMileages);
			 $("#nextMaintainMileage",container).removeClass("required");
			 
			 $("#license2",container).val(licenses);
			 $("#license",container).removeClass("required");
			 $("#engineNo2",container).val(engineNos);
			 $("#engineNo",container).removeClass("required");
			 $("#address2",container).val(addresss);
			 $("#address",container).removeClass("required");
			 returnResult.status = true; 
			 
		 }); 
	});
</script>
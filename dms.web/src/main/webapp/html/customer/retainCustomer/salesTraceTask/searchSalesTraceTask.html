<div class="dms-search">
	<form class="form-horizontal">
	<div class="panel panel-default">
	     <div class="panel-body">
			<div class="row"><!-- pull-left -->
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-4">品牌</label>
							<div class="col-xs-8">
								<select id="brand" class="bs-select form-control"
									name="brand" data-url="/basedata/brandsdict2"
									data-model="manage" data-labelValue="BRAND_CODE"
									data-lableDesc="BRAND_NAME">
								</select>
							</div>
						</div>
					</div>
<!-- 					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车系</label>
							<div class="col-xs-8">
								<select id="series" parent="brand"
									class="bs-select form-control" name="series"
									data-url="/basedata/brandsdict/{[brand]}/seriessdict"
									data-model="manage" data-labelValue="SERIES_CODE"
									data-lableDesc="SERIES_NAME">
								</select>
							</div>
						</div>
					</div> -->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车系</label>
							<div class="col-xs-8">
								<select id="series" 
									class="bs-select form-control" name="series"
									data-url="/basedata/selectSeries"
									data-model="manage" data-labelValue="SERIES_CODE"
									data-lableDesc="SERIES_NAME">

								</select>
							</div>
						</div>
					</div>
		<!-- 			<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车型</label>
							<div class="col-xs-8">
								<select id="model" parent="series"
									class="bs-select form-control" name="model"
									data-url="/basedata/brandsdict/{[brand]}/seriessdict/{[series]}/modelsdict"
									data-model="manage" data-labelValue="MODEL_CODE"
									data-lableDesc="MODEL_NAME" data-alwaysRefresh="true">
								</select>
							</div>
						</div>
					</div> -->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车型</label>
							<div class="col-xs-8">
								<select id="model" 
									class="bs-select form-control" name="model"
									data-url="/basedata/selectModel"
									data-model="manage" data-labelValue="MODEL_CODE"
									data-lableDesc="MODEL_NAME">

								</select>
							</div>
						</div>
					</div>
					
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-2">VIN</label>
						<div class="col-xs-10 ">
							<input type="text" class="form-control" id="vin" name="vin">
						</div>
					</div>
				</div>	
				
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-4">是否分配</label>
						<div class="col-xs-8"> 
							 <select id="ifdistribution"  name="ifdistribution" class="bs-select form-control" data-dictCode="1278" 
							 data-value="12781002"
							 ></select>
						</div>
					</div>
				</div>
				
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-4" >是否回访</label>
						<div class="col-xs-8"  > 
							 <select id="isDistribute"  name="isDistribute" class="bs-select form-control"   data-dictCode="1278" ></select>
						</div>
					</div>
				</div>
				
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">回访问卷</label>
							<div class="col-xs-8" >
								<select id="questionnaireCode"   disabled = "disabled"
									class="bs-select form-control" name="questionnaireName"
									data-url="/questionnaire"
									data-model="manage" data-labelValue="QUESTIONNAIRE_CODE"
									data-lableDesc="QUESTIONNAIRE_NAME"  >
								</select>
							</div>
						</div>
					</div>
					
					<div class="col-xs-12 col-sm-12 col-md-8 col-lg-3">					
						<div class="form-group">
							<label class="control-label col-xs-4 col-sm-2">开票日</label>
							<div class="col-xs-8 col-sm-10">
								 <div class="input-group input-daterange"  >
		                             <input type="text" class="form-control"   name="startDate" id="startDate" disabled = "disabled"> 
		                             <span class="input-group-addon">至</span>
		                             <input type="text" class="form-control"   name="endDate" id="endDate" disabled = "disabled"> 
		                             <span class="input-group-btn">
	                                         <button class="btn default input-clear" type="button">
	                                            <i class="fa fa-close"></i>
	                                        </button>
	                                 </span>		                       
		                        </div>
							</div>
						</div>
					</div>
					
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-4">客户编号</label>
						<div class="col-xs-8 ">
							<input type="text" class="form-control" id="customerCode" name="customerCode">
						</div>
					</div>
				</div>
				
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-4">客户名称</label>
						<div class="col-xs-8 ">
							<input type="text" class="form-control" id="customerName" name="customerName">
						</div>
					</div>
				</div>

				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-4">分配次数</label>
						<div class="col-xs-8 ">
							<input type="text" class="form-control" id="fpcs" name="fpcs">
						</div>
					</div>
				</div>
				
				<div class="col-xs-12 col-sm-12 col-md-8 col-lg-3">					
						<div class="form-group">
							<label class="control-label col-xs-4 col-sm-2">交车日</label>
							<div class="col-xs-8 col-sm-10">
								 <div class="input-group input-daterange"  >
		                             <input type="text" class="form-control"   name="confirmedDateBegin" id="confirmedDateBegin" disabled = "disabled">
		                             <span class="input-group-addon">至</span>
		                             <input type="text" class="form-control"   name="confirmedDateEnd" id="confirmedDateEnd" disabled = "disabled"> 
		                             <span class="input-group-btn">
	                                         <button class="btn default input-clear" type="button">
	                                            <i class="fa fa-close"></i>
	                                        </button>
	                                 </span>		                       
		                        </div>
							</div>
						</div>
					</div>
				
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
					<div class="form-group">
						<label class="control-label col-xs-4">回访次数</label>
						<div class="col-xs-8 ">
							<input type="text" class="form-control" id="hfcs" name="hfcs">
						</div>
					</div>
				</div>			
				  	
			</div>
			<div class="row ">
				<div class="col-xs-12 ">
					<div class="query-btn">
						<a href="javascript:;" class="btn blue  "> 
						<i class="fa fa-search">
						</i> 
						查询
						</a> 
						<a href="javascript:;" class="btn blue"><i class="fa fa-undo"></i> 重置</a>
					</div>
				</div>
		   </div>
		  </div>
		</div>
	</form>
	<div class="panel panel-default table-panel">
		<div class="panel-heading">
			<div class="pannel-name">销售回访任务分配列表</div>
			<div class="pannel-button">
				<div class="btn-group btn-group-sm">												
					<a href="javascript:;" data-url="/customerManage/salesTraceTask/export/excel" data-model="customer" data-method="downLoad" data-toggle="confirmation"
						class="btn btn-outline " ><i class="fa fa-download"></i>导出</a>
				
					<a class="btn btn-outline" data-url="customer/retainCustomer/salesTraceTask/butionTrack.html" id="butionTrack"
							data-toggle="modal"  data-width="modal-sm" data-beforeShowEvent="true"> <i class="fa fa-plus-square"></i> 分配
					</a> 
					
					</a> <a href=""
						class="btn  btn-outline btn-circle btn-sm dropdown-toggle" id="dropdown_menucoler"
						data-toggle="dropdown" data-hover="dropdown"
						data-close-others="true"> 说明 <span class="fa fa-angle-down">
					</span>
					</a>
					<ul class="dropdown-menu pull-left">
						<li><a href="javascript:;"> <span
								class="label label-sm label-black "> 成功或失败结束跟踪的客户也能进行分配</span>
						</a></li>
						<li><a href="javascript:;"> <span
								class="label label-sm label-black "> 是否分配选择"是"或者留空后，才可选择是否回访；选择否分配，则不能选择是否回访</span>
						</a></li>
						<li><a href="javascript:;"> <span
								class="label label-sm label-black "> 选择是回访表示回访过，选择否表示所有问卷都未回访过，只有当选择了是否回访后才可以选择回访问卷</span>
						</a></li>
						<li><a href="javascript:;"> <span
								class="label label-sm label-black "> 若选择是回访,选择的问卷表示做过此回访问卷，若选择否回访，选择的问卷表示没有做过过此问卷</span>
						</a></li>
					</ul>
					
<!-- 					<a href="javascript:;" id = "undo"
					
						class="btn btn-outline " ><i class="fa fa-undo"></i>取消</a> -->
					
					
<!-- 					<a class="btn btn"  id = "undo" href="javascript:;">
						<i class="fa fa-undo"></i>
						取消
					</a>	 -->
					
				</div>
			</div>

		</div>
		<div class="panel-body">
			<table
				class="table table-striped table-bordered table-hover table-responsive"
				id="dms_table"></table>
		</div>
	</div>
</div>
<script type="text/javascript">
$(document).one("onload.dms",function(event,container){
	new Datatable().initPagination({
		src : "dms_table",
		container:container,
		url : dmsCommon.getDmsPath()["customer"] + "/customerManage/salesTraceTask",
			rowID : "VIN",
			sortName : "VIN",
			sortOrder : "asc",
			autoHeight: false,
			undefinedText : "",
			
			columns : [ 
				 {checkbox:true,sortable : true},

				 {field : "fpcs",title : "分配次数"},
             	 {field : "hfcs",title : "回访次数"},
             	 {field : "IFDISTRIBUTION",title : "是否分配",codeFormat : {type:"dict",codeType:"1278"}},
		         {field : "BRAND_NAME",title : "品牌"},
		         {field : "SERIES_NAME",title : "车系"},
		         {field : "MODEL_NAME",title : "车型"},
		         {field : "VIN",title : "VIN"},
             	 {field : "SALES_DATE",title : "开票日期",dateFormat : {format:"YYYY-MM-DD"}},
             	 {field : "CUSTOMER_NO",title : "客户编号"},
             	 {field : "CUSTOMER_NAME",title : "客户名称"},
             	 {field : "GENDER",title : "性别",codeFormat : {type:"dict",codeType:"1006"}},
             	 {field : "PROVINCE",title : "省份",codeFormat : {type:"dict",codeType:"9001"}},
             	 {field : "CITY",title : "城市",codeFormat : {type:"dict",codeType:"9002"}},
             	 {field : "DISTRICT",title : "区县",codeFormat : {type:"dict",codeType:"9003"}},
             	 {field : "ADDRESS",title : "地址"},
             	 {field : "CONTACTOR_PHONE",title : "联系人电话"},
             	 {field : "CONTACTOR_MOBILE",title : "联系人手机"},	 
             	 {field : "CONFIRMED_DATE",title : "交车日期",dateFormat : {format:"YYYY-MM-DD"}},
              	 {field : "QUESTIONNAIRE_CODE",title : "问卷名称",visible:false},
                 {field : "TRANCER",title : "跟踪员",visible:false},      
              	 {field : "SO_NO",title : "SO_NO",visible : false},
		         {field : "BRAND_CODE",title : "BRAND_CODE",visible:false},
		         {field : "SERIES_CODE",title : "SERIES_CODE",visible:false},
		         {field : "MODEL_CODE",title : "MODEL_CODE",visible:false},
		         {field : "CUSTOMER_STATUS",title : "CUSTOMER_STATUS",visible:false},
		         {field : "CUSTOMER_TYPE",title : "CUSTOMER_TYPE",visible:false},
		         {field : "BUSINESS_TYPE",title : "BUSINESS_TYPE",visible:false}
			],
			onLoadSuccess : function() {
				var rownu = $("#dms_table",container).dmsTable().getTableRows();
				if(rownu<=0){
					$("a[data-method='downLoad']",container).attr("disabled","true");
				}else{
					$("a[data-method='downLoad']",container).removeAttr("disabled");
				}
			}
		});

	//弹出页面打开前执行函数
	$("a[data-beforeShowEvent='true']",container).on("beforeShow.dms",function(event,returnResult){
		var selectRow = $("#dms_table",container).dmsTable().getSelections();
	
		var falg=true;
		
		if(!selectRow){
			dmsCommon.tip({status:"warning",msg:"请选择表格数据1"});
			returnResult.status = false;
			return ;
		}	
		if(!falg){
				returnResult.status = false;
				return ;
		}
		returnResult.status = true;
	});
	
 	$("#ifdistribution",container).ready(function(){
     	if($("#ifdistribution",container).val() != '12781001'){
    		 $("#isDistribute",container).selectpicker('val','');
    		 $("#isDistribute",container).attr("disabled","disable");
    		
		}else if($("#ifdistribution",container).val() == '12781001'){
			$("#isDistribute",container).removeAttr("disabled");	
		}
     	if($("#isDistribute",container).val() != '12781001'){
   		 $("#questionnaireCode",container).attr("disabled","disable");
   		dmsDict.refreshSelectByUrl($("#questionnaireCode",container),{brand: ""});
		}else if($("#isDistribute",container).val() == '12781001'){
			$("#questionnaireCode",container).removeAttr("disabled");	
			dmsDict.refreshSelectByUrl($("#questionnaireCode",container),{brand: ""});	
		}
	});

		
	$("#ifdistribution",container).bindChange(function(obj){
     	if($("#ifdistribution",container).val() == '12781002'){
     		 $("#isDistribute",container).selectpicker('val','');
     		 $("#isDistribute",container).attr("disabled","disable");
     		$("#questionnaireCode",container).selectpicker('val','');
    		 $("#questionnaireCode",container).attr("disabled","disable");
		}else {
			$("#isDistribute",container).removeAttr("disabled");				
		}
	});
	
	$("#isDistribute",container).bindChange(function(obj){
/*      	if($("#isDistribute",container).val() != '12781001'){
     		 $("#questionnaireCode",container).selectpicker('val','');
     		 $("#questionnaireCode",container).attr("disabled","disable");
		}else if($("#isDistribute",container).val() == '12781001'){
			$("#questionnaireCode",container).removeAttr("disabled");	
			dmsDict.refreshSelectByUrl($("#questionnaireCode",container),{brand: ""});
		} */
     	if($("#isDistribute",container).val() =="12781001" || $("#isDistribute",container).val() =="12781002"){
     		$("#questionnaireCode",container).removeAttr("disabled");	
			dmsDict.refreshSelectByUrl($("#questionnaireCode",container),{brand: ""});
     	}else{
     		$("#questionnaireCode",container).selectpicker('val','');
    		 $("#questionnaireCode",container).attr("disabled","disable");
     	}

     	
     	
	});	
	
	
	
	$(function(){
		 $("#dropdown_menucoler").on("mouseenter mouseleave", function () {
			 $(this).dropdown('toggle');
		 });
	});
	
	
	$('#undo', container).on('click',function() {
	
		$('#dms_table').bootstrapTable('removeAll');
	});
	
	
});		
</script>



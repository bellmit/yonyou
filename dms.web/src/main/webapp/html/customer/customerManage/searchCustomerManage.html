<div class="dms-search">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="row">
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车主性质</label>
							<div class="col-xs-8">
								<select id="OWNER_PROPERTY" name="OWNER_PROPERTY" class="bs-select form-control"
									data-dictCode="1190" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">车主编号</label>
							<div class="col-xs-8">
								<input id="OWNER_NO" name="OWNER_NO" class="form-control"
									type="text" />
							</div>
						</div>
					</div><input type="hidden" id="vin" name="VIN"/>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">车主</label>
							<div class="col-xs-8">
								<input id="OWNER_NAME" name="OWNER_NAME" class="form-control"
									type="text" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车主拼音</label>
							<div class="col-xs-8">
								<input id="OWNER_SPELL" name="OWNER_SPELL" class="form-control"
									type="text" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">是否会员</label>
							<div class="col-xs-8">
								<select id="MEMBER_STATUS" name="MEMBER_STATUS" data-ajaxSync="true"
									class="bs-select form-control" data-dictCode="1278" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">电话号码</label>
							<div class="col-xs-8 ">
								<input type="text" class="form-control" id="PHONE"
									name="PHONE" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">手机号码</label>
							<div class="col-xs-8 ">
								<input type="text" class="form-control" id="MOBILE"
									name="MOBILE" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4 col-sm-4">建档日期</label>
							<div class="col-xs-8">
								<div class="input-group input-daterange" data-maxDays="30"
									data-opens="right">
									<input type="text" class="form-control" readonly name="BEGIN_TIME">
									<span class="input-group-addon">至</span> <input type="text"
										class="form-control" readonly name="END_TIME"> <span
										class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue" data-onclickEvent="true" id="owen">查询</a> 
							<a href="javascript:;" class="btn blue"><i
								class="fa fa-undo"></i>重置</a>
						</div>
					</div>
				</div>
			</div>
			<input type="hidden" id="a" name="a"/>
			<div class="panel panel-default table-panel">
				<div class="panel-heading">
					<div class="pannel-name">车主信息</div>
					<div class="pannel-button">
						<div class="btn-group btn-group-sm">
							<a class="btn btn-outline"
								data-url="customer/customerManage/addCustomerManage.html"
								data-toggle="modal" data-width="modal-lg"> <i
								class="fa fa-plus-square"></i> 新增</a> 
							<a data-onclickEvent="true" id="owenAll" disabled="disabled"
								class="btn btn-outline"> <i class="fa fa-search" />显示全部</a> 
							<a data-model="customer" id="ownexcel" data-url="/customerManage/customerManager/export/excel"
								data-method="downLoad" data-toggle="confirmation" data-beforeRequest="true"
								class="btn btn-outline "><i class="fa fa-upload"  />Excel</a>
						</div>
					</div>
				</div>
				<div class="panel-body">
					<table
						class="table table-striped table-bordered table-hover table-responsive"
						id="dms_table"></table>
				</div>
			</div>
			<div class="panel-body">
				<div class="row">
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">车牌号</label>
							<div class="col-xs-8">
								<input id="LICENSE" name="LICENSE" class="form-control"
									type="text" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">VIN</label>
							<div class="col-xs-8">
								<input id="VIN" name="VIN" class="form-control"
									type="text" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">发动机号</label>
							<div class="col-xs-8 ">
								<input type="text" class="form-control" id="ENGINE_NO"
									name="ENGINE_NO" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4">微信是否绑定</label>
							<div class="col-xs-8">
								<select id="IS_BINDING" name="IS_BINDING" data-ajaxSync="true"
									class="bs-select form-control" data-dictCode="1278" />
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-3">
						<div class="form-group">
							<label class="control-label col-xs-4 col-sm-4">建档日期</label>
							<div class="col-xs-8">
								<div class="input-group input-daterange" data-maxDays="30"
									data-opens="right">
									<input type="text" class="form-control" readonly name="BEGIN_TIMEs">
									<span class="input-group-addon">至</span> <input type="text"
										class="form-control" readonly name="END_TIMEs"> <span
										class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn blue" data-onclickEvent="true" id="lise">查询</a> 
							<a href="javascript:;" class="btn blue"><i
								class="fa fa-undo"></i>重置</a>
						</div>
					</div>
				</div>
			</div>
			<div class="panel panel-default table-panel">
				<div class="panel-heading">
					<div class="pannel-name">车辆信息</div>
					<div class="pannel-button">
						<div class="btn-group btn-group-sm">
							<a class="btn btn-outline" disabled="disabled" id="lesnew"
								data-url="customer/customerManage/addCustomerManageles.html" 
								data-toggle="modal" data-width="modal-lg"> <i
								class="fa fa-plus-square"></i> 新增</a> 
							<a data-onclickEvent="true" id="liseAll" disabled="disabled"
								class="btn btn-outline "> <i class="fa fa-search" />显示全部</a> 
							<a  data-model="customer" id="lesexcel" data-url="/customerManage/customerManager/export/excels"
								data-method="downLoad" data-toggle="confirmation" data-beforeRequest="true"
								class="btn btn-outline "><i class="fa fa-upload" />Excel</a> 
						</div>
					</div>
				</div>
				<div class="panel-body">
					<table
						class="table table-striped table-bordered table-hover table-responsive"
						id="dms_table1"></table>
				</div>
			</div>
		</div>

	</form>
</div>
<script type="text/javascript">
	$(document).one("onload.dms",function(event,container){
		new Datatable().initPagination({
			src : "dms_table",
			container:container,
			url : dmsCommon.getDmsPath()["customer"] + "",
			rowID : "",
			sortOrder : "asc",
			isQueryFirst : false,
			autoHeight: false,
			undefinedText : "",
			onClickRow:function(rowData,trElement){
				var owner = rowData.OWNER_NO
				$("#dms_table1",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/license/"+owner);
			},
			columns : [ 
				{radio:true,sortable : false},
			    {field : "",title : "操作",operateFormat : [
                       {type:"edit",url:"customer/customerManage/editOwner.html",openWidth:"modal-lg"},
                       {type:"detail",url:"customer/insurance/updateOwner.html",openWidth:"modal-lg",doubleClick:true}
                   ]
                },  
                {field:"OWNER_PROPERTY",title:"车主性质"},
    			{field:"OWNER_NO",title:"车主编号"},
    			{field:"OWNER_NAME",title:"车主"},
    			{field:"MEMBER_STATUS",title:"是否是会员",codeFormat : {type:"dict",codeType:"1278"}},
    			{field:"MOBILE",title:"手机"},
    			{field:"PHONE",title:"电话"},
    			{field:"ZIP_CODE",title:"邮编"},
    			{field:"ADDRESS",title:"地址"},
    			{field:"CONTACTOR_NAME",title:"联系人"},
    			{field:"CONTACTOR_MOBILE",title:"联系人手机"},
    			{field:"CONTACTOR_PHONE",title:"联系人电话"},
    			{field:"CREATED_BY",title:"创建人"},
    			{field:"CT_CODE",title:"证件类型"},
    			{field:"CERTIFICATE_NO",title:"证件号码"}
			],onLoadSuccess:function(rows){
				var owner = rows.rows[0].OWNER_NO
				if($("#a",container).val()=='1'){
					$("#dms_table1",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/license/"+owner);
				}
			}
		});
		new Datatable().initPagination({
			src : "dms_table1",
			container:container,
			url : dmsCommon.getDmsPath()["customer"] + "",
			rowID : "",
			sortOrder : "asc",
			autoHeight: false,
			isQueryFirst : false,
			undefinedText : "",
			onClickRow:function(rowData,trElement){
				var owner = rowData.OWNER_NO
				$("#dms_table",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/owen/"+owner);
			},
			columns : [ 
				{field : "",title : "操作",operateFormat : [
	                 {type:"edit",url:"customer/solicitude/updateVehicle.html",openWidth:"modal-lg"},
	                 {type:"detail",url:"customer/solicitude/updateVehicle.html",openWidth:"modal-lg",doubleClick:true},
	                 {type:"del",url:"/customerManage/customerManager/delect/{[VIN]}",model:"customer",callBack:function(response){
                  	   $("#dms_table1",getElementContext()).dmsTable().refreshTableWithForm();
                     }}
	                ]
	            },  
	    		{field:"OWNER_NO",title:"车主编号"},
	            {field:"LICENSE",title:"车牌号"},
	    		{field:"VIN",title:"VIN"},
	    		{field:"ENGINE_NO",title:"发动机"},
	    		{field:"BRAND",title:"品牌"},
	    		{field:"SERIES",title:"车系"},
	    		{field:"MODEL",title:"车型"},
	    		{field:"KEY_NUMBER",title:"钥匙号"},
	    		{field:"DELIVERER",title:"送修人"},
	    		{field:"DELIVERER_MOBILE",title:"送修人手机"},
	    		{field:"DELIVERER_PHONE",title:"送修人电话"},
	    		{field:"CONSULTANT",title:"销售顾问"},
	    		{field:"CREATE_BY",title:"创建人"},
	    		{field:"FOUND_DATE",title:"建档日期",dateFormat : {format:"YYYY-MM-DD"}},
	    		{field:"NO_VALID_REASON",title:"不激活原因"},
	    		{field:"IS_BINDING",title:"是否绑定微信",codeFormat : {type:"dict",codeType:"1278"}},
	    		{field:"BINDING_DATE",title:"微信绑定时间",dateFormat : {format:"YYYY-MM-DD"}},
	    		{field:"WX_UNBUNDLING_DATE",title:"微信解绑时间",dateFormat : {format:"YYYY-MM-DD"}},
	    		{field:"IS_WX_CONNECT",title:"是否微信首要联系方式",codeFormat : {type:"dict",codeType:"1278"}},
	    		{field:"MOBILE_PHONE",title:"微信首要联系方式"}
			],onLoadSuccess:function(rows){
				var owner = rows.rows[0].OWNER_NO
				if($("#a",container).val()=='2'){
					$("#dms_table",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/owen/"+owner);
				}
			}
		});
		
		$("a[data-beforeRequest='true']",container).on("beforeRequest.dms",function(event,returnResult){
			var selectRows = $("#dms_table1",container).dmsTable().getRowDataByIndex()
			own=selectRows[0].OWNER_NO
			if($("#a",container).val()=='1'){
				$("#ownexcel",container).attr("data-url","/customerManage/customerManager/export/excel")
				$("#lesexcel",container).attr("data-url","/customerManage/customerManager/export/excels/"+own)
			}
			if($("#a",container).val()=='2'){
				$("#ownexcel",container).attr("data-url","/customerManage/customerManager/export/excel/"+own)
				$("#lesexcel",container).attr("data-url","/customerManage/customerManager/export/excels")
			}
			returnResult.status = true;
		});
		$("a[data-onclickEvent='true']",container).on("dms.click",function(){
			var own="";
			if($(this).attr('id')=='owen'){
				$("#a",container).val("1")
				$('#owenAll').removeAttr("disabled");
				$('#liseAll').removeAttr("disabled");
				$('#lesnew').removeAttr("disabled");
				$("#dms_table",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/owen");
			}
			if($(this).attr('id')=='lise'){
				$("#a",container).val("2")
				$('#owenAll').removeAttr("disabled");
				$('#liseAll').removeAttr("disabled");
				$('#lesnew').removeAttr("disabled");
				$("#dms_table1",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/license");//通过url刷新表格
			}
			if($(this).attr('id')=='owenAll'){
				$("#dms_table",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/owen");
			}
			if($(this).attr('id')=='liseAll'){
				$("#dms_table1",container).dmsTable().refreshUrl(dmsCommon.getDmsPath()['customer']+"/customerManage/customerManager/license");
			}
			
		});
	});		
</script>       
<div class="dms-search" data-pageInitCallBack= "true">
	<form class="form-horizontal">
		<div class="panel panel-default">
			<div class="panel-body">

				<div class="panel panel-default">
					<div class="panel-heading">
						<div class="pannel-name">查询条件</div>
						<div class="pannel-tools">
							<a href="javascript:;" class=collapse> <i
								class="fa fa-chevron-down"></i></a>
						</div>
					</div>
					<div class="panel-body">
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">经销商</label>
								<div class="col-xs-8">
									<select id="DEALER_CODE" class="bs-select form-control"
										name="DEALER_CODE"
										data-url="/stockManage/safeguard/findDealerInfo"
										data-value="{[userInfo.dealerCode]}" data-model="customer"
										data-labelValue="dealer_code"
										data-lableDesc="DEALER_SHORTNAME">
									</select>
								</div>
							</div>
						</div>
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">品牌</label>
								<div class="col-xs-8">
									<select id="brand" class="bs-select form-control"
										data-ajaxSync="true" name="brandCode"
										data-url="/basedata/brandsdict" data-model="manage"
										data-labelValue="BRAND_CODE" data-lableDesc="BRAND_NAME"
										data-alwaysRefresh="true">
									</select>
								</div>
							</div>
						</div>
						<!-- /span -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车系</label>
								<div class="col-xs-8">
									<select id="series" class="bs-select form-control"
										name="seriesCode" data-url="/basedata/selectSeries"
										data-model="manage" data-labelValue="SERIES_CODE"
										data-lableDesc="SERIES_NAME" data-alwaysRefresh="true">
									</select>
								</div>
							</div>
						</div>
						<!-- /span -->
						<!-- data-defaultDays="7" -->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

							<div class="form-group">
								<label class="control-label col-xs-3">下次保养日</label>
								<div class="col-xs-9">
									<div class="input-group input-daterange" >
										<input type="text" class="form-control" readonly
											name="nextmaintainDate" id="nextmaintainDate"
											value="" /> <span class="input-group-addon">至</span> <input
											type="text" class="form-control" readonly
											name="nextmaintainDate" id="nextmaintainDate" value="" />
										<span class="input-group-btn">
											<button class="btn default input-clear" type="button">
												<i class="fa fa-close"></i>
											</button>
										</span>
									</div>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">车型</label>
								<div class="col-xs-8">
									<select id="model" class="bs-select form-control"
										name="modelCode" data-url="/basedata/selectModel"
										data-model="manage" data-labelValue="MODEL_CODE"
										data-lableDesc="MODEL_NAME" data-alwaysRefresh="true">
									</select>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">下次保养里程</label>
								<div class="col-xs-8">
									<div class="input-group">
										<input type="text" class="form-control digits"
											id="nextMaintainMileage" name="nextMaintainMileage" />
										<span class="input-group-addon">至</span> <input type="text"
											class="form-control digits" id="nextMaintainMileage"
											name="nextMaintainMileageTo" />
									</div>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">提醒方式</label>
								<div class="col-xs-8">
									<select id="remindWay" class="bs-select form-control"
										name="remindWay" data-dictCode="1128">
									</select>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

							<div class="form-group">
								<label class="control-label col-xs-3">销售日期</label>
								<div class="col-xs-9">
									<div class="input-group input-daterange">
										<input type="text" class="form-control" readonly
											name="salesDateFrom" id="salesDateFrom" value=""> <span
											class="input-group-addon">至</span> <input type="text"
											class="form-control" readonly name="salesDate" id="salesDate"
											value=""> <span class="input-group-btn">
											<button class="btn default input-clear" type="button">
												<i class="fa fa-close"></i>
											</button>
										</span>
									</div>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4 ">车牌号</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" id="license" name="license">
									<input type="hidden" class="form-control" id="license2" name="license">
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 hidden">
							<div class="form-group">
								<label class="control-label col-xs-4 ">发动机号</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" id="engineNo2" name="engineNo" >
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 hidden">
							<div class="form-group">
								<label class="control-label col-xs-4 ">地址</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" id="address2" name="address">
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4 ">车主地址</label>
								<div class="col-xs-8">
									<input type="text" class="form-control" id="address"
										name="address" />
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
							<div class="form-group">
								<label class="control-label col-xs-4">是否VIP客户</label>
								<div class="col-xs-8">
									<select id="vipNo" class="bs-select form-control" name="vipNo"
										data-dictCode="1278">
									</select>
								</div>
							</div>
						</div>
						<!--/span-->
						<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

							<div class="form-group">
								<label class="control-label col-xs-3">近一日提醒</label>
								<div class="col-xs-9">
									<div class="input-group input-daterange">
										<input type="text" class="form-control" readonly
											name="remindDateF" id="remindDateF" value=""> <span
											class="input-group-addon">至</span> <input type="text"
											class="form-control" readonly name="remindDateFTo"
											id="remindDateFTo" value=""> <span
											class="input-group-btn">
											<button class="btn default input-clear" type="button">
												<i class="fa fa-close"></i>
											</button>
										</span>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">VIN</label>
							<div class="col-xs-8">
								<input type="hidden" id="vin2" />
								<input type="text" class="form-control" id="vin" name="vin"/>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">车主</label>
							<div class="col-xs-8">
								<input type="text" class="form-control" id="ownerName"
									name="ownerName">
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3 hidden">
						<div class="form-group">
							<label class="control-label col-xs-4 ">车主编号</label>
							<div class="col-xs-8">
								<input type="text" class="form-control" id="ownerNo2"
									name="ownerNo">
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4 ">送修人</label>
							<div class="col-xs-8">
								<input type="text" class="form-control" id="deliverer"
									name="deliverer">
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

						<div class="form-group">
							<label class="control-label col-xs-3">上次维修日</label>
							<div class="col-xs-9">
								<div class="input-group input-daterange">
									<input type="text" class="form-control" readonly
										name="lastMaintainDate" id="lastMaintainDate" value="">
									<span class="input-group-addon">至</span> <input type="text"
										class="form-control" readonly name="lastMaintainDateTo"
										id="lastMaintainDateTo" value=""> <span
										class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">DCRC专员</label>
							<div class="col-xs-8">
								<select id="dcrcAdvisor" class="bs-select form-control"
									data-ajaxSync="true" name="dcrcAdvisor"
									data-url="/customer/solicitude/dcrc" data-model="customer"
									data-labelValue="EMPLOYEE_NAME" data-lableDesc="EMPLOYEE_NAME"
									data-alwaysRefresh="true">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">提醒状态</label>
							<div class="col-xs-8">
								<select id="remindStatus" class="bs-select form-control"
									name="remindStatus" data-dictCode="1382">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">是否激活</label>
							<div class="col-xs-8">
								<select id="iSValid" class="bs-select form-control"
									name="iSValid" data-dictCode="1278">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">

						<div class="form-group">
							<label class="control-label col-xs-3">优惠截止日</label>
							<div class="col-xs-9">
								<div class="input-group input-daterange">
									<input type="text" class="form-control" readonly
										name="discountExpireDateBegin" id="discountExpireDateBegin"
										value=""> <span class="input-group-addon">至</span> <input
										type="text" class="form-control" readonly
										name="discountExpireDateEnd" id="discountExpireDateEnd"
										value=""> <span class="input-group-btn">
										<button class="btn default input-clear" type="button">
											<i class="fa fa-close"></i>
										</button>
									</span>
								</div>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">续保专员</label>
							<div class="col-xs-8">
								<select id="insuranceAdvisor" class="bs-select form-control"
									data-ajaxSync="true" name="insuranceAdvisor"
									data-url="/customer/solicitude/dcrc" data-model="customer"
									data-labelValue="EMPLOYEE_NAME" data-lableDesc="EMPLOYEE_NAME"
									data-alwaysRefresh="true">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车主性质</label>
							<div class="col-xs-8">
								<select id="ownerProperty" class="bs-select form-control"
									name="ownerProperty" data-dictCode="1190">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">是否回厂</label>
							<div class="col-xs-8">
								<select id="isSuccessRemind " class="bs-select form-control"
									name="isSuccessRemind" data-dictCode="1278" disabled="disabled">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">到期未进厂客户</label>
							<div class="col-xs-8">
								<select id="isCheckRadio" class="bs-select form-control"
									name="isCheckRadio" data-dictCode="1278">
								</select>
							</div>
						</div>
					</div>
					<!--/span-->
				</div>
				<div class="row ">
					<div class="col-xs-12 ">
						<div class="query-btn">
							<a href="javascript:;" class="btn btn-sm blue"> <i
								class="fa fa-search"></i> 查询
							</a> <a href="javascript:;" class="btn btn-sm blue"><i
								class="fa fa-undo"></i> 重置</a>
						</div>
					</div>
				</div>
			</div>
			<div class="panel panel-default table-panel">
				<div class="panel-heading">
					<div class="pannel-name">定期保养提醒</div>
					<div class="pannel-button">
						<div class="btn-group btn-group-sm">
							<!--/span-->
							<a id="editOwner" data-toggle="modal" data-beforeShowEvent="true"
								data-url="customer/solicitude/updateOwner.html" data-width="modal-lg"
								data-callBack="true" class="btn btn-outline"><i class="fa fa-edit" />修改车主信息 
							</a>
							<!--/span-->		
							<a id="editVehicle" data-beforeShowEvent="true" class="btn btn-outline"
								data-url="customer/solicitude/updateVehicle.html" data-toggle="modal" data-width="modal-lg">
								<i class="fa fa-edit" />修改车辆信息 
							</a> 
							<!--/span-->
							<a id="remind" data-beforeShowEvent="true" class="btn btn-outline"
								data-url="customer/solicitude/remind.html" data-toggle="modal" data-width="modal-md">
								<i class="fa fa-plus-square" />提醒 
							</a> 
							<!--/span-->
							<a id="remindRecord" data-toggle="modal" data-width="modal-lg" class="btn btn-outline"
								data-url="customer/solicitude/remindRecord/remindRecord.html" data-beforeShowEvent="true">
								<i class="fa fa-search" />提醒记录
							</a>
							<!--/span-->
							<a id="appointmentPlan"  data-toggle="modal" data-width="modal-lg" class="btn btn-outline"
								data-url="customer/solicitude/appointmentPlan/appointmentPlan.html" data-beforeShowEvent="true">
								<i class="fa fa-edit" />预约安排
							</a>
							<!--/span-->							
							<a id="maintainHistory" data-toggle="modal" data-width="modal-lg" class="btn btn-outline"
								data-url="customer/solicitude/maintainHistory/maintainHistory.html" data-beforeShowEvent="true">
								<i class="fa fa-search" />维修历史
							</a>
							<!--/span-->
							<a id="suggestMaintain" data-toggle="modal" data-width="modal-lg" data-beforeShowEvent="true"
								data-url="customer/solicitude/suggestMaintain/suggestMaintain.html" class="btn btn-outline">
								<i class="fa fa-search" />建议维修
							</a>
							<!--/span-->
							<a id="complainHistory" data-toggle="modal" data-width="modal-lg" data-beforeShowEvent="true"
								data-url="customer/solicitude/complainHistory/complainHistory.html" class="btn btn-outline">
								<i class="fa fa-search" />投诉历史
							</a>
							<!--/span-->
							<a href="javascript:;" data-url="/customer/solicitude/export"
								data-model="customer" data-method="downLoad" id="excel" 
								data-toggle="confirmation" class="btn btn-outline "> <i
								class="fa fa-download"></i>导出
							</a>
						</div>
					</div>
				</div>
			</div>
			<div class="panel-body">
				<table
					class="table table-striped table-bordered table-hover table-responsive"
					id="dms_solicitude">
				</table>
			</div>
	</form>
</div>
<script type="text/javascript">
	$(document).one("onload.dms", function(event, container) {
		
		new Datatable().initPagination({
			src : "dms_solicitude",
			rowID : "VIN",
			container : container,
			url : dmsCommon.getDmsPath()["customer"] + "/customer/solicitude",
			sortName : "VIN",
			sortOrder : "asc",
			checkboxHeader:true, //全选框
			autoHeight : false,
			undefinedText : "",
			columns : [
            {checkbox : true,sortable:false},
	        {
				field : "dealer_shortname",
				title : "经销商"
			}, {
				field : "LICENSE",
				title : "车牌号"
			}, {
				field : "VIN",
				title : "VIN"
			}, {
				field : "IS_SUCCESS_REMIND",
				title : "是否回厂",
				codeFormat : {
					type : "dict",
					codeType : "1278"
				}
			}, {
				field : "BRAND",
				title : "品牌"
			}, {
				field : "SERIES",
				title : "车系"
			},  {
				field : "MODEL",
				title : "车型"
			}, {
				field : "OWNER_NO",
				title : "车主编号"
			}, {
				field : "OWNER_NAME",
				title : "车主"
			}, {
				field : "PHONE",
				title : "车主电话"
			}, {
				field : "MOBILE",
				title : "车主手机"
			}, {
				field : "ADDRESS",
				title : "车主地址"
			}, {
				field : "OWNER_PROPERTY",
				title : "车主性质",
				codeFormat : {
					type : "dict",
					codeType : "1190"
				}
			}, {
				field : "DELIVERER",
				title : "送修人"
			}, {
				field : "DELIVERER_MOBILE",
				title : "送修人手机"
			}, {
				field : "DELIVERER_PHONE",
				title : "送修人电话"
			}, {
				field : "CONTACTOR_NAME",
				title : "联系人",
			}, {
				field : "CONTACTOR_MOBILE",
				title : "联系人手机"
			}, {
				field : "CONTACTOR_PHONE",
				title : "联系人电话"
			}, {
				field : "CONTACTOR_ZIP_CODE",
				title : "联系人邮编"
			}, {
				field : "CONTACTOR_ADDRESS",
				title : "联系人详细地址"
			}, {
				field : "LAST_MAINTAIN_DATE",
				title : "上次维修日期",
				dateFormat : {
					format : "YYYY-MM-DD"
				}
			}, {
				field : "LAST_MAINTAIN_MILEAGE",
				title : "上次维修里程"
			}, {
				field : "NEXT_MAINTAIN_DATE",
				title : "预计下次保养日期",
				dateFormat : {
					format : "YYYY-MM-DD"
				}
			}, {
				field : "NEXT_MAINTAIN_MILEAGE",
				title : "下次保养里程",
			}, {
				field : "USER_NAME",
				title : "提醒人",inputHiddenFormat : {hiddenField:"SOLD_BY"}
			}, {
				field : "REMIND_CONTENT",
				title : "提醒内容"
			}, {
				field : "REMIND_STATUS",
				title : "提醒状态",
				codeFormat : {
					type : "dict",
					codeType : "1382"
				}
			}, {
				field : "REMIND_FAIL_REASON",
				title : "提醒失败原因",
				codeFormat : {
					type : "dict",
					codeType : "1383"
				}
			}, {
				field : "REMIND_DATE",
				title : "最后一次提醒时间",
				dateFormat : {
					format : "YYYY-MM-DD HH:mm:ss"
				}
			}, {
				field : "CUSTOMER_FEEDBACK",
				title : "客户反馈"
			}, {
				field : "service_advisor_name",
				title : "客户经理"
			}, {
				field : "SALES_DATE",
				title : "销售日期",
				dateFormat : {
					format : "YYYY-MM-DD"
				}
			}, {
				field : "IS_VALID",
				title : "是否激活",
				codeFormat : {
					type : "dict",
					codeType : "1278"
				}
			}, {
				field : "DISCOUNT_EXPIRE_DATE",
				title : "优惠截止日期",
				dateFormat : {
					format : "YYYY-MM-DD"
				}
			}, {
				field : "VIP_NO",
				title : "VIP编号"
			}, {
				field : "MAINTAIN_ADVISOR",
				title : "定保专员"
			}, {
				field : "LAST_MAINTENANCE_DATE",
				title : "上次保养日期"
			}, {
				field : "LAST_MAINTENANCE_MILEAGE",
				title : "上次保养里程"
			}, {
				field : "REMIND_WAY",
				title : "提醒方式",
				codeFormat : {
					type : "dict",
					codeType : "1128"
				}
			}, {
				field : "DCRC_ADVISOR",
				title : "DCRC专员"
			}, {
				field : "REMIND_DATE_S",
				title : "最近两次提醒时间",
				dateFormat : {
					format : "YYYY-MM-DD HH:mm:ss"
				}
			}, {
				field : "REMIND_DATE_T",
				title : "最近三次提醒时间",
				dateFormat : {
					format : "YYYY-MM-DD HH:mm:ss"
				}
			}, {
				field : "RO_CREATE_DATE",
				title : "上次维修时间",
				dateFormat : {
					format : "YYYY-MM-DD HH:mm:ss"
				}
			}, {
				field : "ENGINE_NO",
				title : "发动机号"
			}, {
				field : "RO_NO",
				title : "工单号"
			}, {
				field : "LICENSE",
				title : "车牌号",
				visible : false
			} ],
			/* onLoadSuccess : function() {
				var rownu = $("#dms_solicitude",container).dmsTable().getTableRows();
				if(rownu<=0){
					$("a[data-method='downLoad']",container).attr("disabled","true");
				}else{
					$("a[data-method='downLoad']",container).removeAttr("disabled");
				}
			} */
		});			
		
		 
		  $("a[data-beforeShowEvent='true']",container).on("beforeShow.dms",function(event,returnResult){
			 var selectRow = $("#dms_solicitude",container).dmsTable().getSelections();
			 
			 if(!selectRow){
					dmsCommon.tip({status:"warning",msg:"请选择表格数据"});
					returnResult.status = false;
					return ;
				}
				$(this).data("pageData",{VIN:selectRow[0].VIN,
				LICENSE:selectRow[0].LICENSE,
				RO_CREATE_DATE:selectRow[0].RO_CREATE_DATE,
				OWNER_NO:selectRow[0].OWNER_NO,
				OWNER_NAME:selectRow[0].OWNER_NAME});//传递多个值
				/* alert(selectRow[0].VIN);
				alert(selectRow[0].LICENSE);
				alert(selectRow[0].RO_CREATE_DATE); 
				alert(selectRow[0].OWNER_NAME);*/
				returnResult.status = true;
			
			 var vins = '';
			 var ownerNos = '';
			 var nextMaintainMileages = '';
			 
			 var engineNos = '';
			 var licenses = '';
			 var addresss= '';
			 
			 for(var i = 0;i<selectRow.length;i++){
				 if(i==selectRow.length-1){
					 vins +=selectRow[i].VIN;
					 ownerNos +=selectRow[i].OWNER_NO;
					 nextMaintainMileages +=selectRow[i].NEXT_MAINTAIN_MILEAGES;
					 
					 engineNos +=selectRow[i].ENGINE_NO;
					 licenses +=selectRow[i].LICENSE;
					 addresss +=selectRow[i].ADDRESS;
					 
				 }else{
					 vins +=selectRow[i].VIN+',';
					 ownerNos +=selectRow[i].OWNER_NO+',';
					 nextMaintainMileages +=selectRow[i].NEXT_MAINTAIN_MILEAGES+',';
					 
					 engineNos +=selectRow[i].ENGINE_NO+',';
					 licenses +=selectRow[i].LICENSE+',';
					 addresss +=selectRow[i].ADDRESS+',';
				 }
			 }
			 
			 $("#vin2",container).val(vins);
			 /* $("#vin",container).removeClass("required"); */
			 $("#ownerNo2",container).val(ownerNos);
			 $("#ownerNo",container).removeClass("required");
			 $("#nextMaintainMileage2",container).val(nextMaintainMileages);
			 $("#nextMaintainMileage",container).removeClass("required");
			 
			 $("#license2",container).val(licenses);
			 $("#license",container).removeClass("required");
			 $("#engineNo2",container).val(engineNos);
			 $("#engineNo",container).removeClass("required");
			 $("#address2",container).val(addresss);
			 $("#address",container).removeClass("required");
			 returnResult.status = true; 
			 
		 }); 
	});
</script>
<div class="dms-search">
	<form class="form-horizontal">
		<div class="modal-body">
			<div class="panel panel-default">
				<div class="panel-body">
					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-4 ">
						<div class="form-group">
							<label class="control-label col-xs-4">经销商</label>
							<div class="col-xs-8">
								<select id="DEALER_CODE" class="bs-select form-control"
									name="DEALER_CODE" data-url="/stockManage/safeguard/findDealerInfo"
									data-model="vehicle" data-labelValue="dealer_code" data-value="{[userInfo.dealerCode]}"
									data-lableDesc="DEALER_SHORTNAME" data-existsDefault="false">
								</select>
							</div>
							</div>
						</div>
					
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<input type="radio" name="radiobutton" value="Service" checked> 
								<label class="control-label col-xs-5 ">服务专员</label>
								<div class="col-xs-6">
									<select id="soldBy" name="Service"
										class="bs-select form-control"
										data-url="/basedata/employees/-1/salesConsultant"
										data-model="manage" data-labelValue="USER_ID"
										data-lableDesc="USER_NAME">
									</select>
								</div>
							</div>
						</div>
						
						<div class="col-xs-12 col-sm-6 col-md-4 ">
							<div class="form-group">
								<input type="radio" name="radiobutton" value="Technician"  > 
								<label class="control-label col-xs-5 ">指定技师</label>
								<div class="col-xs-6">
									<select id="soldBy" name="Technician"
										class="bs-select form-control"
										data-url="/basedata/employees/-1/salesConsultant"
										data-model="manage" data-labelValue="USER_ID"
										data-lableDesc="USER_NAME">
									</select>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-6">
							<div class="form-group">
							<label class="control-label ">开单日期</label>
							<div class="col-xs-6 ">
								<div class="input-group date datetime"  data-defaultNow = "true">
										<input id="roCreateDate" name="starttime" readonly
											class="form-control required"
											type="text" value="" />
										 <span class="input-group-addon"><span class="fa fa-calendar"></span></span>
					                    <span class="input-group-addon"><span class="fa fa-times"></span></span>
					                    <span class="input-group-addon">至</span> 
								</div>
								
								<div class="input-group date datetime" data-defaultNow = "true">
										<input id="endTimeSupposed" name="endtime" readonly
											class="form-control required"
											type="text" value="" />
										 <span class="input-group-addon"><span class="fa fa-calendar"></span></span>
					                    <span class="input-group-addon"><span class="fa fa-times"></span></span>
									</div>
							</div>
							</div>
						</div>
					</div>
						<div class="row ">
							<div class="col-xs-12 ">
								<div class="query-btn">
									<a href="javascript:;" class="btn blue"> <i
										class="fa fa-search"></i>查询
									</a> <a href="javascript:;" class="btn blue"><i
										class="fa fa-undo"></i>重置</a>
								</div>
							</div>
						</div>

				<div class="panel panel-default table-panel">
						<div class="panel-heading">
							<div class="pannel-name">预约汇总表</div>
							<div class="pannel-button">
								<a data-url="/stockManage/safeguard/export/excel" data-model="repair"
									data-method="downLoad" data-toggle="confirmation" id="export"
									class="btn btn-outline "><i class="fa fa-download"></i>导出
								</a>
							</div>
						</div>
						<div class="panel-body">
							<table
								class="table table-striped table-bordered table-hover table-responsive"
								id="dms_table"></table>
						</div>
					</div>
				</div>
				</div>
		</div>
	</form>
</div>


<script type="text/javascript">
	$(document).one("onload.dms",
			function(event, container) {
				new Datatable().initPagination({
					src : "dms_table",
					container : container,
					url : dmsCommon.getDmsPath()["repair"]	+ "/precontractSum/queryPreSum",
					rowID : "EMPLOYEE_NO",
					sortName : "EMPLOYEE_NO",
					/* selectItemName:"VIN", *///当需要默认排序时写，否则不写，默认情况下不写，sortOrder同样
					sortOrder : "asc",
					autoHeight : false,
					undefinedText : "",
					columns : [ 
					{field : "dealer_code",visible : false},
					{field : "dealer_shortname",title : "经销商"}, 
					{
						field : "EMPLOYEE_NO",
						title : "员工编号"
					}, {
						field : "EMPLOYEE_NAME",
						title : "服务专员"
					}, {
						field : "BOOKING_RATE",
						title : "预约比率"
					}, {
						field : "AVAILABILE_BOOKING_RATE",
						title : "有效预约比率"
					}, {
						field : "SUCESS_RATE",
						title : "成功率"
					}, 
					{
						field : "REPAIR_ORDER_COUNT",
						title : "总工单台次"
					}, {
						field : "PRECON_COUNT",
						title : "预约台次"
					}, {
						field : "IN_ON_TIME",
						title : "准时进厂台次"
					}, {
						field : "IN_BEFORE_TIME",
						title : "提前进厂台次"
				
					}, {
						field : "IN_AFTER_TIME",
						title : "延迟进厂台次"
					}, {
						field : "IN_CANCEL",
						title : "取消进厂台次"
					}, {
						field : "IN_NOT",
						title : "未进厂台次"
					},

					]
				});

				//保存前事件
				$('a[data-beforeRequest="true"]', container).on(
						'beforeRequest.dms',
						function(event, returnResult) {
							var vins = "";
							var text = $("#dms_table", container).dmsTable()
									.getSelections();
							if (text != null) {
								$(text).each(function(e) {
									vins += text[e].VIN + ';';
								});
								$("#vins", container).val(vins);
								returnResult.status = true;
							} else {
								dmsCommon.tip({
									status : "warning",
									msg : "请选择记录！"
								});
								returnResult.status = false;
								return;
							}
						});

				//新增页面的回调函数
				$("a[data-callBack='true']", container).on(
						"callBack.dms",
						function(event, response) {
							//关闭窗口
							$("a[data-dismiss='modal']", container).click();
							//刷新表格
							$("#dms_table", getElementContext()).dmsTable()
									.refreshTableWithForm();
						});
			});
</script>

<div class="dms-edit ajaxrest" data-url="/order/repair/{[RO_ID]}" data-model="repair"  data-pageInitCallBack="true">
	<form class="form-horizontal">
	    <input type="hidden" value="{[RO_ID]}" id="roId" name="roId">
	    <input type="hidden" id="parameter" data-valueUrl="/basedata/BasicParameters/1030/parts_receivePeople" data-valueType="parameter">
		<div class="panel panel-default">
			<!-- <div class="panel-heading">
				<div class="pannel-name">维修工单</div>
				<div class="pannel-tools">
					<a href="javascript:;" class="expand"> <i
						class="fa fa-chevron-down"></i></a>
				</div>
			</div> -->
			<div class="panel-body">
				<div class="row">
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">工单号</label>
							<div class="col-xs-8">
								<input id="roNo" name="roNo" disabled class="form-control" type="text" data-fieldName="ro_no"/>
							</div>
						</div>
					</div>
                    <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车主名称</label>
							<div class="col-xs-8">
							    <input id="ownerName" name="ownerName" disabled class="form-control" type="text" data-fieldName="owner_name"/>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">车牌号</label>
							<div class="col-xs-8">
								<input id="license" name="license" disabled class="form-control" type="text" data-fieldName="license"/>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">VIN号</label>
							<div class="col-xs-8">
								<input id="vin" name="vin" disabled class="form-control" type="text" data-fieldName="vin"/>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">工单类型</label>
							<div class="col-xs-8">
							<!-- <input id="repairTypeCode" name="repairTypeCode" disabled class="form-control" type="text" data-fieldName="roType"/> -->
								<select id="roType" name="roType" data-dictCode="1212" data-fieldName="ro_type" class="bs-select form-control"  >
							    </select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">维修类型</label>
							<div class="col-xs-8">
								<!-- <input id="repairTypeCode" name="repairTypeCode" disabled class="form-control" type="text" data-fieldName="repair_type_code"/> -->
							     <select id="repairTypeCode" name="repairTypeCode" data-url="/basedata/repairtypes/getRepairTypes/item" data-model="manage" data-labelValue="REPAIR_TYPE_CODE" data-lableDesc="REPAIR_TYPE_NAME" disabled class="bs-select form-control"  data-fieldName="repair_type_code">
							    </select>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">服务顾问</label>
							<div class="col-xs-8">
								<select id="serviceAdvisorAss" name="serviceAdvisorAss" disabled data-url="/basedata/employees/queryServiceAss/dicts" data-model="manage" data-labelValue="employee_no" data-lableDesc="employee_name" class="bs-select form-control" type="text" data-fieldName="service_advisor_ass">
								</select>
							    
							</div>
						</div>
					</div>
					
					<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
						<div class="form-group">
							<label class="control-label col-xs-4">开单日期</label>
							<div class="col-xs-8">
								<div class="input-group date date-picker">
									<input id="receiptDate" name="" readonly
										class="form-control"
										type="text" value="" data-fieldName="ro_create_date"/> <span class="input-group-btn">
										<button class="btn default date-set" type="button">
											<i class="fa fa-calendar"></i>
										</button>
                                              <button class="btn default date-reset" type="button">
                                                  <i class="fa fa-times"></i>
                                              </button>
									</span>

								</div>
							</div>
						</div>
					</div>

					
						
				</div>
			</div>
		</div>
		<div class="panel panel-default table-panel">
		<div class="panel-heading">
			<div class="pannel-name">维修工单明细</div>
			<div class="pannel-button">
				<div class="btn-group btn-group-sm">
				         <a class="btn btn-outline" data-url="repair/order/orderout/partInfoList.html"
						data-toggle="modal" data-beforeShowEvent="true" data-alert="partinfo"  data-width="modal-lg" > 
						<i class="fa fa-plus-square"></i> 添加</a>	
						<!-- <a class="btn btn-outline" data-url="/order/repair/{[RO_ID]}/roparts" data-method="PUT" data-model="repair" data-toggle="confirmation" data-callBack="true"> 
						<i class="fa fa-save"></i>保存</a>	
						<a class="btn btn-outline" id="finish" data-url="repair/order/orderout/receiver.html"
						data-toggle="modal" data-width="modal-md" data-beforeShowEvent="true" data-alert="partinfo"> 
						<i class="fa fa-save" ></i>入账</a>	 -->						
										
				</div>
			</div>
		</div>
		<div class="panel-body">
			<table class="table table-striped table-bordered table-hover table-responsive" id="roPartDtos">
			</table>
		</div>
	</div>
		
		<div class="modal-footer center-block">
						<div class="col-xs-12 ">
							<div class="query-btn">
								<a data-url="/order/repair/{[RO_ID]}/roparts" data-method="PUT" data-model="repair" data-toggle="confirmation" data-callBack="true" class="btn blue" >
									<i class="fa fa-save"></i> 保存
								</a>
								
								<a id="finish" data-alert="partinfo" data-url="repair/order/orderout/receiver.html"data-toggle="modal" data-beforeShowEvent="true" data-callBack="true" data-width="modal-sm"  data-ajaxrest1="returnList"  class="btn blue" > <i
								
									class="fa fa-save"></i>入账
								</a>
								<a id="finishUrl" data-url="/order/repair/{[RO_ID]}/orderstatus" data-model="repair" data-method="GET" data-callBack="true" data-ajaxrest1="returnList"  class="btn blue" data-toggle="confirmation"><i class="fa fa-save"></i>入账</a> 
								<a data-goback="page" href="repair/order/orderout/searchOrder.html" class="btn blue ajaxify"><i class="fa fa-reply">
								</i>返回</a>
							</div>
						</div>
				   </div>
	</form>
</div>

<script type="text/javascript">
	
	 $(document).one("onload.dms",function(event,container){
		 //维修领料时  是否需要制定领料人
		 $("div[data-pageInitCallBack='true']",container).on("callBack.dms",function(event,response){
			 var param= $("#parameter",container).val();
			 if("10131001"==param){
				 $("#finishUrl",container).hide();
				 $("#finish",container).show();
			 }else{
				 $("#finish",container).hide();
				 $("#finishUrl",container).show();
			 }
			 
		 });
		
		 new Datatable().initLocale({
			src : "roPartDtos",
			container:container,
			rowID:"item_id",
			url : dmsCommon.getDmsPath()["repair"] + "/order/repair/{[RO_ID]}/roparts",
			sortName : "item_id", 
			sortOrder : "asc",
			autoHeight:false,
			columns : [
			           {field : "",title : "操作",operateFormat : [ {type : "localDel", 
				        	  isShow:function(value, row, index){
							   if(row.isFinishedShow=="10041001"){
								   return false;
	                    	   }else{
	                    		   return true;
	                    	   }      
						      }  
			            }
			           ]},
			           {field : "isFinishedShow",title : "是否入账",inputField:"isFinished",inputHiddenFormat:{},codeFormat:{type:"dict",codeType:"1004"}},
			           {field : "partCodeShow",inputField:"partNo",inputHiddenFormat : {},title : "配件代码"}, 
			            {field : "partNameShow",inputField:"partName",inputHiddenFormat : {},title : "配件名称"},
			           {field : "storageCodeShow",inputField:"storageCode",inputHiddenFormat : {},title : "仓库名称",inputSelectFormat : {validate:{validateClass:"required dmsDisabled"},url:"/basedata/store/accessories/Warehouses",model:"part",labelValue:"STORAGE_CODE",lableDesc:"STORAGE_NAME"}}, 
			           {field : "storagePositionCodeShow",inputField:"storagePositionCode",inputHiddenFormat : {},title : "库位"}, 
			           /* {field : "unitShow",inputField:"unit",inputHiddenFormat : {},title : "计量单位"},  */
			           {field : "canNumShow",inputField:"partQuantity",inputHiddenFormat : {},title : "数量",numberFormat : {decimal : 4}},
			           {field : "chargePartitionCodeShow",inputField:"chargePartitionCode",inputHiddenFormat : {},title : "收费区分"}, 
			           
			           
			           {field : "salesPriceShow",inputField:"partSalesPrice",inputHiddenFormat : {},title : "单价"},   
			           {field : "salesAmountShow",inputField:"partSalesAmount",inputHiddenFormat : {},title : "金额"},
			           {field : "discountShow",inputField:"discount",inputHiddenFormat : {},title : "折扣率"},
			           {field : "afterAmountShow",inputField:"afterDiscountAmount",inputHiddenFormat : {},title : "折后金额"},   
			           {field : "batchNo",inputField:"batchNo",inputHiddenFormat : {},title : "流水号"},
			           {field : "ACTIVITY_CODE",inputField:"activityCode",title : "活动编号",inputHiddenFormat:{},inputSelectFormat:{type:"dict",codeType:"1229"}},
			           
			           {field : "",inputField:"",inputHiddenFormat : {},title : "项目代码"},   
			           {field : "",inputField:"",inputHiddenFormat : {},title : "项目名称"},
			           {field : "",inputField:"",inputHiddenFormat : {},title : "单位"},
			           {field : "RECEIVER",inputField:"receiver",inputHiddenFormat : {},title : "领料人",inputSelectFormat : {url:"/basedata/employees/10061005/employeesdict",model:"manage",labelValue:"EMPLOYEE_NO",lableDesc:"EMPLOYEE_NAME"}},   
			           {field : "costPriceShow",inputField:"partCostPrice",inputHiddenFormat : {},title : "成本单价"}, 
			           {field : "costAmountShow",inputField:"partCostAmount",inputHiddenFormat : {},title : "成本金额"}
			          ]
		});
		 
	     //绑定事件
		 $("a[data-callBack='true']",container).on("callBack.dms",function(event,response){

		 });
	     
		 $("a[data-ajaxrest1='returnList']",container).on("callBack.dms",function(event,response){
			 $("a[data-goback='page']",container).click();
		 });
		 //领用人下拉框选择事件
		  $("select[name='receiptor']",container).bindChange(function(obj){
				var empCode = $("select[name='receiptor']",container).val();
				dmsCommon.ajaxRestRequest({
					url : dmsCommon.getDmsPath()["manage"] + "/basedata/orgs/employee/"+empCode,
					type : 'GET',
					sucessCallBack : function(modelData) {

						$("input[name='orgName']",container).val(modelData.ORG_NAME);
					}
				});
		});
		 
		 $("a[data-alert='partinfo']",container).on("beforeShow.dms",function(event,returnResult){
				var roIdValue = $("#roId",getElementContext()).val();		
				var map={RO_ID:roIdValue}
				$(this).data("pageData",map);
				returnResult.status = true;
		 });
		 
		 /* $("a[data-callBack='true']",container).on("callBack.dms",function(event,response){
			 $("#dms_table",getElementContext()).dmsTable().refreshTableWithForm();
		 }); */
	}); 
	
	
</script>

